
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ethereum.github.io/consensus-specs/specs/phase0/beacon-chain/">
      
      
        <link rel="prev" href="../../..">
      
      
        <link rel="next" href="../deposit-contract/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Beacon Chain - Ethereum Consensus Specs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#phase-0-the-beacon-chain" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Ethereum Consensus Specs" class="md-header__button md-logo" aria-label="Ethereum Consensus Specs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ethereum Consensus Specs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Beacon Chain
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Specs

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../docs/new-feature/" class="md-tabs__link">
          
  
  
  Docs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../fork_choice/safe-block/" class="md-tabs__link">
          
  
  
  Fork choice

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../light-client/" class="md-tabs__link">
          
  
  
  Light client

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ssz/merkle-proofs/" class="md-tabs__link">
          
  
  
  Ssz

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../sync/optimistic/" class="md-tabs__link">
          
  
  
  Sync

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Ethereum Consensus Specs" class="md-nav__button md-logo" aria-label="Ethereum Consensus Specs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ethereum Consensus Specs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ethereum Proof-of-Stake Consensus Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Specs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Specs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Phase0
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Phase0
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notation" class="md-nav__link">
    <span class="md-ellipsis">
      Notation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-types" class="md-nav__link">
    <span class="md-ellipsis">
      Custom types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constants" class="md-nav__link">
    <span class="md-ellipsis">
      Constants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withdrawal-prefixes" class="md-nav__link">
    <span class="md-ellipsis">
      Withdrawal prefixes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-types" class="md-nav__link">
    <span class="md-ellipsis">
      Domain types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preset" class="md-nav__link">
    <span class="md-ellipsis">
      Preset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gwei-values" class="md-nav__link">
    <span class="md-ellipsis">
      Gwei values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Time parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-list-lengths" class="md-nav__link">
    <span class="md-ellipsis">
      State list lengths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewards-and-penalties" class="md-nav__link">
    <span class="md-ellipsis">
      Rewards and penalties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-operations-per-block" class="md-nav__link">
    <span class="md-ellipsis">
      Max operations per block
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genesis-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Time parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      Validator cycle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    <span class="md-ellipsis">
      Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Misc dependencies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misc dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fork" class="md-nav__link">
    <span class="md-ellipsis">
      Fork
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forkdata" class="md-nav__link">
    <span class="md-ellipsis">
      ForkData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Checkpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator" class="md-nav__link">
    <span class="md-ellipsis">
      Validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestationdata" class="md-nav__link">
    <span class="md-ellipsis">
      AttestationData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexedattestation" class="md-nav__link">
    <span class="md-ellipsis">
      IndexedAttestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pendingattestation" class="md-nav__link">
    <span class="md-ellipsis">
      PendingAttestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1data" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#historicalbatch" class="md-nav__link">
    <span class="md-ellipsis">
      HistoricalBatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#depositmessage" class="md-nav__link">
    <span class="md-ellipsis">
      DepositMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#depositdata" class="md-nav__link">
    <span class="md-ellipsis">
      DepositData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beaconblockheader" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconBlockHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signingdata" class="md-nav__link">
    <span class="md-ellipsis">
      SigningData
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposerslashing" class="md-nav__link">
    <span class="md-ellipsis">
      ProposerSlashing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attesterslashing" class="md-nav__link">
    <span class="md-ellipsis">
      AttesterSlashing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestation" class="md-nav__link">
    <span class="md-ellipsis">
      Attestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deposit" class="md-nav__link">
    <span class="md-ellipsis">
      Deposit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voluntaryexit" class="md-nav__link">
    <span class="md-ellipsis">
      VoluntaryExit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beaconblockbody" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconBlockBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconBlock
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-state" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon state
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beaconstate" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconState
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signed-envelopes" class="md-nav__link">
    <span class="md-ellipsis">
      Signed envelopes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Signed envelopes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signedvoluntaryexit" class="md-nav__link">
    <span class="md-ellipsis">
      SignedVoluntaryExit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signedbeaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      SignedBeaconBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signedbeaconblockheader" class="md-nav__link">
    <span class="md-ellipsis">
      SignedBeaconBlockHeader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Helper functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#math" class="md-nav__link">
    <span class="md-ellipsis">
      Math
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Math">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integer_squareroot" class="md-nav__link">
    <span class="md-ellipsis">
      integer_squareroot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xor" class="md-nav__link">
    <span class="md-ellipsis">
      xor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uint_to_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      uint_to_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bytes_to_uint64" class="md-nav__link">
    <span class="md-ellipsis">
      bytes_to_uint64
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saturating_sub" class="md-nav__link">
    <span class="md-ellipsis">
      saturating_sub
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crypto" class="md-nav__link">
    <span class="md-ellipsis">
      Crypto
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crypto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hash" class="md-nav__link">
    <span class="md-ellipsis">
      hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash_tree_root" class="md-nav__link">
    <span class="md-ellipsis">
      hash_tree_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bls-signatures" class="md-nav__link">
    <span class="md-ellipsis">
      BLS signatures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predicates" class="md-nav__link">
    <span class="md-ellipsis">
      Predicates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Predicates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#is_active_validator" class="md-nav__link">
    <span class="md-ellipsis">
      is_active_validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_eligible_for_activation_queue" class="md-nav__link">
    <span class="md-ellipsis">
      is_eligible_for_activation_queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_eligible_for_activation" class="md-nav__link">
    <span class="md-ellipsis">
      is_eligible_for_activation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_slashable_validator" class="md-nav__link">
    <span class="md-ellipsis">
      is_slashable_validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_slashable_attestation_data" class="md-nav__link">
    <span class="md-ellipsis">
      is_slashable_attestation_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_indexed_attestation" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_indexed_attestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_merkle_branch" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_merkle_branch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc_2" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compute_shuffled_index" class="md-nav__link">
    <span class="md-ellipsis">
      compute_shuffled_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_proposer_index" class="md-nav__link">
    <span class="md-ellipsis">
      compute_proposer_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_committee" class="md-nav__link">
    <span class="md-ellipsis">
      compute_committee
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_time_at_slot" class="md-nav__link">
    <span class="md-ellipsis">
      compute_time_at_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_epoch_at_slot" class="md-nav__link">
    <span class="md-ellipsis">
      compute_epoch_at_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_start_slot_at_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      compute_start_slot_at_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_activation_exit_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      compute_activation_exit_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_fork_data_root" class="md-nav__link">
    <span class="md-ellipsis">
      compute_fork_data_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_domain" class="md-nav__link">
    <span class="md-ellipsis">
      compute_domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_signing_root" class="md-nav__link">
    <span class="md-ellipsis">
      compute_signing_root
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-state-accessors" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon state accessors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon state accessors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_current_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      get_current_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_previous_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      get_previous_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_block_root" class="md-nav__link">
    <span class="md-ellipsis">
      get_block_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_block_root_at_slot" class="md-nav__link">
    <span class="md-ellipsis">
      get_block_root_at_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_randao_mix" class="md-nav__link">
    <span class="md-ellipsis">
      get_randao_mix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_active_validator_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_active_validator_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_validator_churn_limit" class="md-nav__link">
    <span class="md-ellipsis">
      get_validator_churn_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_seed" class="md-nav__link">
    <span class="md-ellipsis">
      get_seed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_committee_count_per_slot" class="md-nav__link">
    <span class="md-ellipsis">
      get_committee_count_per_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_beacon_committee" class="md-nav__link">
    <span class="md-ellipsis">
      get_beacon_committee
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_beacon_proposer_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_beacon_proposer_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_total_balance" class="md-nav__link">
    <span class="md-ellipsis">
      get_total_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_total_active_balance" class="md-nav__link">
    <span class="md-ellipsis">
      get_total_active_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_domain" class="md-nav__link">
    <span class="md-ellipsis">
      get_domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_indexed_attestation" class="md-nav__link">
    <span class="md-ellipsis">
      get_indexed_attestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_attesting_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_attesting_indices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-state-mutators" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon state mutators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon state mutators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#increase_balance" class="md-nav__link">
    <span class="md-ellipsis">
      increase_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decrease_balance" class="md-nav__link">
    <span class="md-ellipsis">
      decrease_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initiate_validator_exit" class="md-nav__link">
    <span class="md-ellipsis">
      initiate_validator_exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slash_validator" class="md-nav__link">
    <span class="md-ellipsis">
      slash_validator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genesis" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Genesis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genesis-state" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#genesis-block" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis block
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beacon-chain-state-transition-function" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon chain state transition function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon chain state transition function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epoch-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Epoch processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Epoch processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-functions_1" class="md-nav__link">
    <span class="md-ellipsis">
      Helper functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#justification-and-finalization" class="md-nav__link">
    <span class="md-ellipsis">
      Justification and finalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewards-and-penalties_1" class="md-nav__link">
    <span class="md-ellipsis">
      Rewards and penalties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rewards and penalties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Helpers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components-of-attestation-deltas" class="md-nav__link">
    <span class="md-ellipsis">
      Components of attestation deltas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_attestation_deltas" class="md-nav__link">
    <span class="md-ellipsis">
      get_attestation_deltas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process_rewards_and_penalties" class="md-nav__link">
    <span class="md-ellipsis">
      process_rewards_and_penalties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registry-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Registry updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1-data-votes-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1 data votes updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effective-balances-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Effective balances updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slashings-balances-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Slashings balances updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randao-mixes-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Randao mixes updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#historical-roots-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Historical roots updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#participation-records-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Participation records rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Block processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Block processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block-header" class="md-nav__link">
    <span class="md-ellipsis">
      Block header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randao" class="md-nav__link">
    <span class="md-ellipsis">
      RANDAO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1-data" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1 data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations" class="md-nav__link">
    <span class="md-ellipsis">
      Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposer-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attester-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Attester slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestations" class="md-nav__link">
    <span class="md-ellipsis">
      Attestations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deposits" class="md-nav__link">
    <span class="md-ellipsis">
      Deposits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voluntary-exits" class="md-nav__link">
    <span class="md-ellipsis">
      Voluntary exits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deposit-contract/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deposit Contract
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../weak-subjectivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Weak Subjectivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Altair
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Altair
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/bls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BLS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_2_6" id="__nav_2_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_6">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/full-node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Full Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/light-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bellatrix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Bellatrix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Capella
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Capella
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_6" >
        
          
          <label class="md-nav__link" for="__nav_2_4_6" id="__nav_2_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_6">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/full-node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Full Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deneb
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Deneb
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/polynomial-commitments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Polynomial Commitments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_7" >
        
          
          <label class="md-nav__link" for="__nav_2_5_7" id="__nav_2_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_7">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/full-node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Full Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Electra
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Electra
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/weak-subjectivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Weak Subjectivity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6_6" id="__nav_2_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6_6">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/light-client/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fulu
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Fulu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/das-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DAS Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/polynomial-commitments-sampling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Polynomial Commitments Sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gloas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Gloas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Builder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/new-feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to add a new feature proposal in consensus-specs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Procedure
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fork choice
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Fork choice
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fork_choice/safe-block/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice -- Safe Block
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fork Choice -- Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Fork Choice -- Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    phase0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bellatrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    capella
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    deneb
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Light client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../light-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/sync-protocol" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Altair
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/sync-protocol" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capella
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/sync-protocol" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deneb
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ssz
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ssz
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ssz/merkle-proofs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Merkle proof formats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ssz/simple-serialize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SimpleSerialize (SSZ)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sync
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Sync
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sync/optimistic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimistic Sync
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notation" class="md-nav__link">
    <span class="md-ellipsis">
      Notation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-types" class="md-nav__link">
    <span class="md-ellipsis">
      Custom types
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constants" class="md-nav__link">
    <span class="md-ellipsis">
      Constants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withdrawal-prefixes" class="md-nav__link">
    <span class="md-ellipsis">
      Withdrawal prefixes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-types" class="md-nav__link">
    <span class="md-ellipsis">
      Domain types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preset" class="md-nav__link">
    <span class="md-ellipsis">
      Preset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gwei-values" class="md-nav__link">
    <span class="md-ellipsis">
      Gwei values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Time parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-list-lengths" class="md-nav__link">
    <span class="md-ellipsis">
      State list lengths
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewards-and-penalties" class="md-nav__link">
    <span class="md-ellipsis">
      Rewards and penalties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max-operations-per-block" class="md-nav__link">
    <span class="md-ellipsis">
      Max operations per block
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genesis-settings" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis settings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Time parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      Validator cycle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    <span class="md-ellipsis">
      Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Misc dependencies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misc dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fork" class="md-nav__link">
    <span class="md-ellipsis">
      Fork
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forkdata" class="md-nav__link">
    <span class="md-ellipsis">
      ForkData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      Checkpoint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator" class="md-nav__link">
    <span class="md-ellipsis">
      Validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestationdata" class="md-nav__link">
    <span class="md-ellipsis">
      AttestationData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexedattestation" class="md-nav__link">
    <span class="md-ellipsis">
      IndexedAttestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pendingattestation" class="md-nav__link">
    <span class="md-ellipsis">
      PendingAttestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1data" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#historicalbatch" class="md-nav__link">
    <span class="md-ellipsis">
      HistoricalBatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#depositmessage" class="md-nav__link">
    <span class="md-ellipsis">
      DepositMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#depositdata" class="md-nav__link">
    <span class="md-ellipsis">
      DepositData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beaconblockheader" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconBlockHeader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signingdata" class="md-nav__link">
    <span class="md-ellipsis">
      SigningData
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposerslashing" class="md-nav__link">
    <span class="md-ellipsis">
      ProposerSlashing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attesterslashing" class="md-nav__link">
    <span class="md-ellipsis">
      AttesterSlashing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestation" class="md-nav__link">
    <span class="md-ellipsis">
      Attestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deposit" class="md-nav__link">
    <span class="md-ellipsis">
      Deposit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voluntaryexit" class="md-nav__link">
    <span class="md-ellipsis">
      VoluntaryExit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beaconblockbody" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconBlockBody
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconBlock
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-state" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon state
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon state">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beaconstate" class="md-nav__link">
    <span class="md-ellipsis">
      BeaconState
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signed-envelopes" class="md-nav__link">
    <span class="md-ellipsis">
      Signed envelopes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Signed envelopes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signedvoluntaryexit" class="md-nav__link">
    <span class="md-ellipsis">
      SignedVoluntaryExit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signedbeaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      SignedBeaconBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signedbeaconblockheader" class="md-nav__link">
    <span class="md-ellipsis">
      SignedBeaconBlockHeader
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Helper functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#math" class="md-nav__link">
    <span class="md-ellipsis">
      Math
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Math">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integer_squareroot" class="md-nav__link">
    <span class="md-ellipsis">
      integer_squareroot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xor" class="md-nav__link">
    <span class="md-ellipsis">
      xor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uint_to_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      uint_to_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bytes_to_uint64" class="md-nav__link">
    <span class="md-ellipsis">
      bytes_to_uint64
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saturating_sub" class="md-nav__link">
    <span class="md-ellipsis">
      saturating_sub
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crypto" class="md-nav__link">
    <span class="md-ellipsis">
      Crypto
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crypto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hash" class="md-nav__link">
    <span class="md-ellipsis">
      hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash_tree_root" class="md-nav__link">
    <span class="md-ellipsis">
      hash_tree_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bls-signatures" class="md-nav__link">
    <span class="md-ellipsis">
      BLS signatures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predicates" class="md-nav__link">
    <span class="md-ellipsis">
      Predicates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Predicates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#is_active_validator" class="md-nav__link">
    <span class="md-ellipsis">
      is_active_validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_eligible_for_activation_queue" class="md-nav__link">
    <span class="md-ellipsis">
      is_eligible_for_activation_queue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_eligible_for_activation" class="md-nav__link">
    <span class="md-ellipsis">
      is_eligible_for_activation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_slashable_validator" class="md-nav__link">
    <span class="md-ellipsis">
      is_slashable_validator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_slashable_attestation_data" class="md-nav__link">
    <span class="md-ellipsis">
      is_slashable_attestation_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_indexed_attestation" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_indexed_attestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_valid_merkle_branch" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_merkle_branch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc_2" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compute_shuffled_index" class="md-nav__link">
    <span class="md-ellipsis">
      compute_shuffled_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_proposer_index" class="md-nav__link">
    <span class="md-ellipsis">
      compute_proposer_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_committee" class="md-nav__link">
    <span class="md-ellipsis">
      compute_committee
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_time_at_slot" class="md-nav__link">
    <span class="md-ellipsis">
      compute_time_at_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_epoch_at_slot" class="md-nav__link">
    <span class="md-ellipsis">
      compute_epoch_at_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_start_slot_at_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      compute_start_slot_at_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_activation_exit_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      compute_activation_exit_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_fork_data_root" class="md-nav__link">
    <span class="md-ellipsis">
      compute_fork_data_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_domain" class="md-nav__link">
    <span class="md-ellipsis">
      compute_domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute_signing_root" class="md-nav__link">
    <span class="md-ellipsis">
      compute_signing_root
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-state-accessors" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon state accessors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon state accessors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_current_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      get_current_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_previous_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      get_previous_epoch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_block_root" class="md-nav__link">
    <span class="md-ellipsis">
      get_block_root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_block_root_at_slot" class="md-nav__link">
    <span class="md-ellipsis">
      get_block_root_at_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_randao_mix" class="md-nav__link">
    <span class="md-ellipsis">
      get_randao_mix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_active_validator_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_active_validator_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_validator_churn_limit" class="md-nav__link">
    <span class="md-ellipsis">
      get_validator_churn_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_seed" class="md-nav__link">
    <span class="md-ellipsis">
      get_seed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_committee_count_per_slot" class="md-nav__link">
    <span class="md-ellipsis">
      get_committee_count_per_slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_beacon_committee" class="md-nav__link">
    <span class="md-ellipsis">
      get_beacon_committee
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_beacon_proposer_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_beacon_proposer_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_total_balance" class="md-nav__link">
    <span class="md-ellipsis">
      get_total_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_total_active_balance" class="md-nav__link">
    <span class="md-ellipsis">
      get_total_active_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_domain" class="md-nav__link">
    <span class="md-ellipsis">
      get_domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_indexed_attestation" class="md-nav__link">
    <span class="md-ellipsis">
      get_indexed_attestation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_attesting_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_attesting_indices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beacon-state-mutators" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon state mutators
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon state mutators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#increase_balance" class="md-nav__link">
    <span class="md-ellipsis">
      increase_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decrease_balance" class="md-nav__link">
    <span class="md-ellipsis">
      decrease_balance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initiate_validator_exit" class="md-nav__link">
    <span class="md-ellipsis">
      initiate_validator_exit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slash_validator" class="md-nav__link">
    <span class="md-ellipsis">
      slash_validator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#genesis" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Genesis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#genesis-state" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis state
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#genesis-block" class="md-nav__link">
    <span class="md-ellipsis">
      Genesis block
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beacon-chain-state-transition-function" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon chain state transition function
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon chain state transition function">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#epoch-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Epoch processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Epoch processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-functions_1" class="md-nav__link">
    <span class="md-ellipsis">
      Helper functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#justification-and-finalization" class="md-nav__link">
    <span class="md-ellipsis">
      Justification and finalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewards-and-penalties_1" class="md-nav__link">
    <span class="md-ellipsis">
      Rewards and penalties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rewards and penalties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      Helpers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components-of-attestation-deltas" class="md-nav__link">
    <span class="md-ellipsis">
      Components of attestation deltas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_attestation_deltas" class="md-nav__link">
    <span class="md-ellipsis">
      get_attestation_deltas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process_rewards_and_penalties" class="md-nav__link">
    <span class="md-ellipsis">
      process_rewards_and_penalties
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registry-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Registry updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1-data-votes-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1 data votes updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effective-balances-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Effective balances updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slashings-balances-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Slashings balances updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randao-mixes-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Randao mixes updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#historical-roots-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Historical roots updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#participation-records-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Participation records rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Block processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Block processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block-header" class="md-nav__link">
    <span class="md-ellipsis">
      Block header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#randao" class="md-nav__link">
    <span class="md-ellipsis">
      RANDAO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1-data" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1 data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations" class="md-nav__link">
    <span class="md-ellipsis">
      Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposer-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attester-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Attester slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestations" class="md-nav__link">
    <span class="md-ellipsis">
      Attestations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deposits" class="md-nav__link">
    <span class="md-ellipsis">
      Deposits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voluntary-exits" class="md-nav__link">
    <span class="md-ellipsis">
      Voluntary exits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="phase-0-the-beacon-chain">Phase 0 -- The Beacon Chain<a class="headerlink" href="#phase-0-the-beacon-chain" title="Permanent link">&para;</a></h1>
<!-- mdformat-toc start --slug=github --no-anchors --maxlevel=6 --minlevel=2 -->

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#notation">Notation</a></li>
<li><a href="#custom-types">Custom types</a></li>
<li><a href="#constants">Constants</a></li>
<li><a href="#misc">Misc</a></li>
<li><a href="#withdrawal-prefixes">Withdrawal prefixes</a></li>
<li><a href="#domain-types">Domain types</a></li>
<li><a href="#preset">Preset</a></li>
<li><a href="#misc-1">Misc</a></li>
<li><a href="#gwei-values">Gwei values</a></li>
<li><a href="#time-parameters">Time parameters</a></li>
<li><a href="#state-list-lengths">State list lengths</a></li>
<li><a href="#rewards-and-penalties">Rewards and penalties</a></li>
<li><a href="#max-operations-per-block">Max operations per block</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#genesis-settings">Genesis settings</a></li>
<li><a href="#time-parameters-1">Time parameters</a></li>
<li><a href="#validator-cycle">Validator cycle</a></li>
<li><a href="#containers">Containers</a></li>
<li><a href="#misc-dependencies">Misc dependencies</a><ul>
<li><a href="#fork"><code>Fork</code></a></li>
<li><a href="#forkdata"><code>ForkData</code></a></li>
<li><a href="#checkpoint"><code>Checkpoint</code></a></li>
<li><a href="#validator"><code>Validator</code></a></li>
<li><a href="#attestationdata"><code>AttestationData</code></a></li>
<li><a href="#indexedattestation"><code>IndexedAttestation</code></a></li>
<li><a href="#pendingattestation"><code>PendingAttestation</code></a></li>
<li><a href="#eth1data"><code>Eth1Data</code></a></li>
<li><a href="#historicalbatch"><code>HistoricalBatch</code></a></li>
<li><a href="#depositmessage"><code>DepositMessage</code></a></li>
<li><a href="#depositdata"><code>DepositData</code></a></li>
<li><a href="#beaconblockheader"><code>BeaconBlockHeader</code></a></li>
<li><a href="#signingdata"><code>SigningData</code></a></li>
</ul>
</li>
<li><a href="#beacon-operations">Beacon operations</a><ul>
<li><a href="#proposerslashing"><code>ProposerSlashing</code></a></li>
<li><a href="#attesterslashing"><code>AttesterSlashing</code></a></li>
<li><a href="#attestation"><code>Attestation</code></a></li>
<li><a href="#deposit"><code>Deposit</code></a></li>
<li><a href="#voluntaryexit"><code>VoluntaryExit</code></a></li>
</ul>
</li>
<li><a href="#beacon-blocks">Beacon blocks</a><ul>
<li><a href="#beaconblockbody"><code>BeaconBlockBody</code></a></li>
<li><a href="#beaconblock"><code>BeaconBlock</code></a></li>
</ul>
</li>
<li><a href="#beacon-state">Beacon state</a><ul>
<li><a href="#beaconstate"><code>BeaconState</code></a></li>
</ul>
</li>
<li><a href="#signed-envelopes">Signed envelopes</a><ul>
<li><a href="#signedvoluntaryexit"><code>SignedVoluntaryExit</code></a></li>
<li><a href="#signedbeaconblock"><code>SignedBeaconBlock</code></a></li>
<li><a href="#signedbeaconblockheader"><code>SignedBeaconBlockHeader</code></a></li>
</ul>
</li>
<li><a href="#helper-functions">Helper functions</a></li>
<li><a href="#math">Math</a><ul>
<li><a href="#integer_squareroot"><code>integer_squareroot</code></a></li>
<li><a href="#xor"><code>xor</code></a></li>
<li><a href="#uint_to_bytes"><code>uint_to_bytes</code></a></li>
<li><a href="#bytes_to_uint64"><code>bytes_to_uint64</code></a></li>
<li><a href="#saturating_sub"><code>saturating_sub</code></a></li>
</ul>
</li>
<li><a href="#crypto">Crypto</a><ul>
<li><a href="#hash"><code>hash</code></a></li>
<li><a href="#hash_tree_root"><code>hash_tree_root</code></a></li>
<li><a href="#bls-signatures">BLS signatures</a></li>
</ul>
</li>
<li><a href="#predicates">Predicates</a><ul>
<li><a href="#is_active_validator"><code>is_active_validator</code></a></li>
<li><a href="#is_eligible_for_activation_queue"><code>is_eligible_for_activation_queue</code></a></li>
<li><a href="#is_eligible_for_activation"><code>is_eligible_for_activation</code></a></li>
<li><a href="#is_slashable_validator"><code>is_slashable_validator</code></a></li>
<li><a href="#is_slashable_attestation_data"><code>is_slashable_attestation_data</code></a></li>
<li><a href="#is_valid_indexed_attestation"><code>is_valid_indexed_attestation</code></a></li>
<li><a href="#is_valid_merkle_branch"><code>is_valid_merkle_branch</code></a></li>
</ul>
</li>
<li><a href="#misc-2">Misc</a><ul>
<li><a href="#compute_shuffled_index"><code>compute_shuffled_index</code></a></li>
<li><a href="#compute_proposer_index"><code>compute_proposer_index</code></a></li>
<li><a href="#compute_committee"><code>compute_committee</code></a></li>
<li><a href="#compute_time_at_slot"><code>compute_time_at_slot</code></a></li>
<li><a href="#compute_epoch_at_slot"><code>compute_epoch_at_slot</code></a></li>
<li><a href="#compute_start_slot_at_epoch"><code>compute_start_slot_at_epoch</code></a></li>
<li><a href="#compute_activation_exit_epoch"><code>compute_activation_exit_epoch</code></a></li>
<li><a href="#compute_fork_data_root"><code>compute_fork_data_root</code></a></li>
<li><a href="#compute_domain"><code>compute_domain</code></a></li>
<li><a href="#compute_signing_root"><code>compute_signing_root</code></a></li>
</ul>
</li>
<li><a href="#beacon-state-accessors">Beacon state accessors</a><ul>
<li><a href="#get_current_epoch"><code>get_current_epoch</code></a></li>
<li><a href="#get_previous_epoch"><code>get_previous_epoch</code></a></li>
<li><a href="#get_block_root"><code>get_block_root</code></a></li>
<li><a href="#get_block_root_at_slot"><code>get_block_root_at_slot</code></a></li>
<li><a href="#get_randao_mix"><code>get_randao_mix</code></a></li>
<li><a href="#get_active_validator_indices"><code>get_active_validator_indices</code></a></li>
<li><a href="#get_validator_churn_limit"><code>get_validator_churn_limit</code></a></li>
<li><a href="#get_seed"><code>get_seed</code></a></li>
<li><a href="#get_committee_count_per_slot"><code>get_committee_count_per_slot</code></a></li>
<li><a href="#get_beacon_committee"><code>get_beacon_committee</code></a></li>
<li><a href="#get_beacon_proposer_index"><code>get_beacon_proposer_index</code></a></li>
<li><a href="#get_total_balance"><code>get_total_balance</code></a></li>
<li><a href="#get_total_active_balance"><code>get_total_active_balance</code></a></li>
<li><a href="#get_domain"><code>get_domain</code></a></li>
<li><a href="#get_indexed_attestation"><code>get_indexed_attestation</code></a></li>
<li><a href="#get_attesting_indices"><code>get_attesting_indices</code></a></li>
</ul>
</li>
<li><a href="#beacon-state-mutators">Beacon state mutators</a><ul>
<li><a href="#increase_balance"><code>increase_balance</code></a></li>
<li><a href="#decrease_balance"><code>decrease_balance</code></a></li>
<li><a href="#initiate_validator_exit"><code>initiate_validator_exit</code></a></li>
<li><a href="#slash_validator"><code>slash_validator</code></a></li>
</ul>
</li>
<li><a href="#genesis">Genesis</a></li>
<li><a href="#genesis-state">Genesis state</a></li>
<li><a href="#genesis-block">Genesis block</a></li>
<li><a href="#beacon-chain-state-transition-function">Beacon chain state transition function</a></li>
<li><a href="#epoch-processing">Epoch processing</a><ul>
<li><a href="#helper-functions-1">Helper functions</a></li>
<li><a href="#justification-and-finalization">Justification and finalization</a></li>
<li><a href="#rewards-and-penalties-1">Rewards and penalties</a></li>
<li><a href="#helpers">Helpers</a></li>
<li><a href="#components-of-attestation-deltas">Components of attestation deltas</a></li>
<li><a href="#get_attestation_deltas"><code>get_attestation_deltas</code></a></li>
<li><a href="#process_rewards_and_penalties"><code>process_rewards_and_penalties</code></a></li>
<li><a href="#registry-updates">Registry updates</a></li>
<li><a href="#slashings">Slashings</a></li>
<li><a href="#eth1-data-votes-updates">Eth1 data votes updates</a></li>
<li><a href="#effective-balances-updates">Effective balances updates</a></li>
<li><a href="#slashings-balances-updates">Slashings balances updates</a></li>
<li><a href="#randao-mixes-updates">Randao mixes updates</a></li>
<li><a href="#historical-roots-updates">Historical roots updates</a></li>
<li><a href="#participation-records-rotation">Participation records rotation</a></li>
</ul>
</li>
<li><a href="#block-processing">Block processing</a><ul>
<li><a href="#block-header">Block header</a></li>
<li><a href="#randao">RANDAO</a></li>
<li><a href="#eth1-data">Eth1 data</a></li>
<li><a href="#operations">Operations</a></li>
<li><a href="#proposer-slashings">Proposer slashings</a></li>
<li><a href="#attester-slashings">Attester slashings</a></li>
<li><a href="#attestations">Attestations</a></li>
<li><a href="#deposits">Deposits</a></li>
<li><a href="#voluntary-exits">Voluntary exits</a></li>
</ul>
</li>
</ul>
<!-- mdformat-toc end -->

<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This document represents the specification for Phase 0 -- The Beacon Chain.</p>
<p>At the core of Ethereum proof-of-stake is a system chain called the "beacon
chain". The beacon chain stores and manages the registry of validators. In the
initial deployment phases of proof-of-stake, the only mechanism to become a
validator is to make a one-way ETH transaction to a deposit contract on the
Ethereum proof-of-work chain. Activation as a validator happens when deposit
receipts are processed by the beacon chain, the activation balance is reached,
and a queuing process is completed. Exit is either voluntary or done forcibly as
a penalty for misbehavior. The primary source of load on the beacon chain is
"attestations". Attestations are simultaneously availability votes for a shard
block (in a later upgrade) and proof-of-stake votes for a beacon block (Phase
0).</p>
<h2 id="notation">Notation<a class="headerlink" href="#notation" title="Permanent link">&para;</a></h2>
<p>Code snippets appearing in <code>this style</code> are to be interpreted as Python 3 code.</p>
<h2 id="custom-types">Custom types<a class="headerlink" href="#custom-types" title="Permanent link">&para;</a></h2>
<p>We define the following Python custom types for type hinting and readability:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>SSZ equivalent</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Slot</code></td>
<td><code>uint64</code></td>
<td>a slot number</td>
</tr>
<tr>
<td><code>Epoch</code></td>
<td><code>uint64</code></td>
<td>an epoch number</td>
</tr>
<tr>
<td><code>CommitteeIndex</code></td>
<td><code>uint64</code></td>
<td>a committee index at a slot</td>
</tr>
<tr>
<td><code>ValidatorIndex</code></td>
<td><code>uint64</code></td>
<td>a validator registry index</td>
</tr>
<tr>
<td><code>Gwei</code></td>
<td><code>uint64</code></td>
<td>an amount in Gwei</td>
</tr>
<tr>
<td><code>Root</code></td>
<td><code>Bytes32</code></td>
<td>a Merkle root</td>
</tr>
<tr>
<td><code>Hash32</code></td>
<td><code>Bytes32</code></td>
<td>a 256-bit hash</td>
</tr>
<tr>
<td><code>Version</code></td>
<td><code>Bytes4</code></td>
<td>a fork version number</td>
</tr>
<tr>
<td><code>DomainType</code></td>
<td><code>Bytes4</code></td>
<td>a domain type</td>
</tr>
<tr>
<td><code>ForkDigest</code></td>
<td><code>Bytes4</code></td>
<td>a digest of the current fork data</td>
</tr>
<tr>
<td><code>Domain</code></td>
<td><code>Bytes32</code></td>
<td>a signature domain</td>
</tr>
<tr>
<td><code>BLSPubkey</code></td>
<td><code>Bytes48</code></td>
<td>a BLS12-381 public key</td>
</tr>
<tr>
<td><code>BLSSignature</code></td>
<td><code>Bytes96</code></td>
<td>a BLS12-381 signature</td>
</tr>
</tbody>
</table>
<h2 id="constants">Constants<a class="headerlink" href="#constants" title="Permanent link">&para;</a></h2>
<p>The following values are (non-configurable) constants used throughout the
specification.</p>
<h3 id="misc">Misc<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>UINT64_MAX</code></td>
<td><code>uint64(2**64 - 1)</code></td>
</tr>
<tr>
<td><code>UINT64_MAX_SQRT</code></td>
<td><code>uint64(4294967295)</code></td>
</tr>
<tr>
<td><code>GENESIS_SLOT</code></td>
<td><code>Slot(0)</code></td>
</tr>
<tr>
<td><code>GENESIS_EPOCH</code></td>
<td><code>Epoch(0)</code></td>
</tr>
<tr>
<td><code>FAR_FUTURE_EPOCH</code></td>
<td><code>Epoch(2**64 - 1)</code></td>
</tr>
<tr>
<td><code>BASE_REWARDS_PER_EPOCH</code></td>
<td><code>uint64(4)</code></td>
</tr>
<tr>
<td><code>DEPOSIT_CONTRACT_TREE_DEPTH</code></td>
<td><code>uint64(2**5)</code> (= 32)</td>
</tr>
<tr>
<td><code>JUSTIFICATION_BITS_LENGTH</code></td>
<td><code>uint64(4)</code></td>
</tr>
<tr>
<td><code>ENDIANNESS</code></td>
<td><code>'little'</code></td>
</tr>
</tbody>
</table>
<h3 id="withdrawal-prefixes">Withdrawal prefixes<a class="headerlink" href="#withdrawal-prefixes" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BLS_WITHDRAWAL_PREFIX</code></td>
<td><code>Bytes1('0x00')</code></td>
</tr>
<tr>
<td><code>ETH1_ADDRESS_WITHDRAWAL_PREFIX</code></td>
<td><code>Bytes1('0x01')</code></td>
</tr>
</tbody>
</table>
<h3 id="domain-types">Domain types<a class="headerlink" href="#domain-types" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DOMAIN_BEACON_PROPOSER</code></td>
<td><code>DomainType('0x00000000')</code></td>
</tr>
<tr>
<td><code>DOMAIN_BEACON_ATTESTER</code></td>
<td><code>DomainType('0x01000000')</code></td>
</tr>
<tr>
<td><code>DOMAIN_RANDAO</code></td>
<td><code>DomainType('0x02000000')</code></td>
</tr>
<tr>
<td><code>DOMAIN_DEPOSIT</code></td>
<td><code>DomainType('0x03000000')</code></td>
</tr>
<tr>
<td><code>DOMAIN_VOLUNTARY_EXIT</code></td>
<td><code>DomainType('0x04000000')</code></td>
</tr>
<tr>
<td><code>DOMAIN_SELECTION_PROOF</code></td>
<td><code>DomainType('0x05000000')</code></td>
</tr>
<tr>
<td><code>DOMAIN_AGGREGATE_AND_PROOF</code></td>
<td><code>DomainType('0x06000000')</code></td>
</tr>
<tr>
<td><code>DOMAIN_APPLICATION_MASK</code></td>
<td><code>DomainType('0x00000001')</code></td>
</tr>
</tbody>
</table>
<p><em>Note</em>: <code>DOMAIN_APPLICATION_MASK</code> reserves the rest of the bitspace in
<code>DomainType</code> for application usage. This means for some <code>DomainType</code>
<code>DOMAIN_SOME_APPLICATION</code>, <code>DOMAIN_SOME_APPLICATION &amp; DOMAIN_APPLICATION_MASK</code>
<strong>MUST</strong> be non-zero. This expression for any other <code>DomainType</code> in the
consensus specs <strong>MUST</strong> be zero.</p>
<h2 id="preset">Preset<a class="headerlink" href="#preset" title="Permanent link">&para;</a></h2>
<p><em>Note</em>: The below configuration is bundled as a preset: a bundle of
configuration variables which are expected to differ between different modes of
operation, e.g. testing, but not generally between different networks.
Additional preset configurations can be found in the <a href="../../configs"><code>configs</code></a>
directory.</p>
<h3 id="misc_1">Misc<a class="headerlink" href="#misc_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MAX_COMMITTEES_PER_SLOT</code></td>
<td><code>uint64(2**6)</code> (= 64)</td>
</tr>
<tr>
<td><code>TARGET_COMMITTEE_SIZE</code></td>
<td><code>uint64(2**7)</code> (= 128)</td>
</tr>
<tr>
<td><code>MAX_VALIDATORS_PER_COMMITTEE</code></td>
<td><code>uint64(2**11)</code> (= 2,048)</td>
</tr>
<tr>
<td><code>SHUFFLE_ROUND_COUNT</code></td>
<td><code>uint64(90)</code></td>
</tr>
<tr>
<td><code>HYSTERESIS_QUOTIENT</code></td>
<td><code>uint64(4)</code></td>
</tr>
<tr>
<td><code>HYSTERESIS_DOWNWARD_MULTIPLIER</code></td>
<td><code>uint64(1)</code></td>
</tr>
<tr>
<td><code>HYSTERESIS_UPWARD_MULTIPLIER</code></td>
<td><code>uint64(5)</code></td>
</tr>
</tbody>
</table>
<ul>
<li>For the safety of committees, <code>TARGET_COMMITTEE_SIZE</code> exceeds
  <a href="http://web.archive.org/web/20190504131341/https://vitalik.ca/files/Ithaca201807_Sharding.pdf">the recommended minimum committee size of 111</a>;
  with sufficient active validators (at least
  <code>SLOTS_PER_EPOCH * TARGET_COMMITTEE_SIZE</code>), the shuffling algorithm ensures
  committee sizes of at least <code>TARGET_COMMITTEE_SIZE</code>. (Unbiasable randomness
  with a Verifiable Delay Function (VDF) will improve committee robustness and
  lower the safe minimum committee size.)</li>
</ul>
<h3 id="gwei-values">Gwei values<a class="headerlink" href="#gwei-values" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MIN_DEPOSIT_AMOUNT</code></td>
<td><code>Gwei(2**0 * 10**9)</code> (= 1,000,000,000)</td>
</tr>
<tr>
<td><code>MAX_EFFECTIVE_BALANCE</code></td>
<td><code>Gwei(2**5 * 10**9)</code> (= 32,000,000,000)</td>
</tr>
<tr>
<td><code>EFFECTIVE_BALANCE_INCREMENT</code></td>
<td><code>Gwei(2**0 * 10**9)</code> (= 1,000,000,000)</td>
</tr>
</tbody>
</table>
<h3 id="time-parameters">Time parameters<a class="headerlink" href="#time-parameters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th style="text-align: center;">Unit</th>
<th style="text-align: center;">Duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MIN_ATTESTATION_INCLUSION_DELAY</code></td>
<td><code>uint64(2**0)</code> (= 1)</td>
<td style="text-align: center;">slots</td>
<td style="text-align: center;">12 seconds</td>
</tr>
<tr>
<td><code>SLOTS_PER_EPOCH</code></td>
<td><code>uint64(2**5)</code> (= 32)</td>
<td style="text-align: center;">slots</td>
<td style="text-align: center;">6.4 minutes</td>
</tr>
<tr>
<td><code>MIN_SEED_LOOKAHEAD</code></td>
<td><code>uint64(2**0)</code> (= 1)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">6.4 minutes</td>
</tr>
<tr>
<td><code>MAX_SEED_LOOKAHEAD</code></td>
<td><code>uint64(2**2)</code> (= 4)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">25.6 minutes</td>
</tr>
<tr>
<td><code>MIN_EPOCHS_TO_INACTIVITY_PENALTY</code></td>
<td><code>uint64(2**2)</code> (= 4)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">25.6 minutes</td>
</tr>
<tr>
<td><code>EPOCHS_PER_ETH1_VOTING_PERIOD</code></td>
<td><code>uint64(2**6)</code> (= 64)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">~6.8 hours</td>
</tr>
<tr>
<td><code>SLOTS_PER_HISTORICAL_ROOT</code></td>
<td><code>uint64(2**13)</code> (= 8,192)</td>
<td style="text-align: center;">slots</td>
<td style="text-align: center;">~27 hours</td>
</tr>
</tbody>
</table>
<h3 id="state-list-lengths">State list lengths<a class="headerlink" href="#state-list-lengths" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th style="text-align: center;">Unit</th>
<th style="text-align: center;">Duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>EPOCHS_PER_HISTORICAL_VECTOR</code></td>
<td><code>uint64(2**16)</code> (= 65,536)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">~0.8 years</td>
</tr>
<tr>
<td><code>EPOCHS_PER_SLASHINGS_VECTOR</code></td>
<td><code>uint64(2**13)</code> (= 8,192)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">~36 days</td>
</tr>
<tr>
<td><code>HISTORICAL_ROOTS_LIMIT</code></td>
<td><code>uint64(2**24)</code> (= 16,777,216)</td>
<td style="text-align: center;">historical roots</td>
<td style="text-align: center;">~52,262 years</td>
</tr>
<tr>
<td><code>VALIDATOR_REGISTRY_LIMIT</code></td>
<td><code>uint64(2**40)</code> (= 1,099,511,627,776)</td>
<td style="text-align: center;">validators</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<h3 id="rewards-and-penalties">Rewards and penalties<a class="headerlink" href="#rewards-and-penalties" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BASE_REWARD_FACTOR</code></td>
<td><code>uint64(2**6)</code> (= 64)</td>
</tr>
<tr>
<td><code>WHISTLEBLOWER_REWARD_QUOTIENT</code></td>
<td><code>uint64(2**9)</code> (= 512)</td>
</tr>
<tr>
<td><code>PROPOSER_REWARD_QUOTIENT</code></td>
<td><code>uint64(2**3)</code> (= 8)</td>
</tr>
<tr>
<td><code>INACTIVITY_PENALTY_QUOTIENT</code></td>
<td><code>uint64(2**26)</code> (= 67,108,864)</td>
</tr>
<tr>
<td><code>MIN_SLASHING_PENALTY_QUOTIENT</code></td>
<td><code>uint64(2**7)</code> (= 128)</td>
</tr>
<tr>
<td><code>PROPORTIONAL_SLASHING_MULTIPLIER</code></td>
<td><code>uint64(1)</code></td>
</tr>
</tbody>
</table>
<ul>
<li>The <code>INACTIVITY_PENALTY_QUOTIENT</code> equals <code>INVERSE_SQRT_E_DROP_TIME**2</code> where
  <code>INVERSE_SQRT_E_DROP_TIME := 2**13</code> epochs (about 36 days) is the time it
  takes the inactivity penalty to reduce the balance of non-participating
  validators to about <code>1/sqrt(e) ~= 60.6%</code>. Indeed, the balance retained by
  offline validators after <code>n</code> epochs is about
  <code>(1 - 1/INACTIVITY_PENALTY_QUOTIENT)**(n**2/2)</code>; so after
  <code>INVERSE_SQRT_E_DROP_TIME</code> epochs, it is roughly
  <code>(1 - 1/INACTIVITY_PENALTY_QUOTIENT)**(INACTIVITY_PENALTY_QUOTIENT/2) ~= 1/sqrt(e)</code>.
  Note this value will be upgraded to <code>2**24</code> after Phase 0 mainnet stabilizes
  to provide a faster recovery in the event of an inactivity leak.</li>
</ul>
<ul>
<li>The <code>PROPORTIONAL_SLASHING_MULTIPLIER</code> is set to <code>1</code> at initial mainnet
  launch, resulting in one-third of the minimum accountable safety margin in the
  event of a finality attack. After Phase 0 mainnet stabilizes, this value will
  be upgraded to <code>3</code> to provide the maximal minimum accountable safety margin.</li>
</ul>
<h3 id="max-operations-per-block">Max operations per block<a class="headerlink" href="#max-operations-per-block" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MAX_PROPOSER_SLASHINGS</code></td>
<td><code>2**4</code> (= 16)</td>
</tr>
<tr>
<td><code>MAX_ATTESTER_SLASHINGS</code></td>
<td><code>2**1</code> (= 2)</td>
</tr>
<tr>
<td><code>MAX_ATTESTATIONS</code></td>
<td><code>2**7</code> (= 128)</td>
</tr>
<tr>
<td><code>MAX_DEPOSITS</code></td>
<td><code>2**4</code> (= 16)</td>
</tr>
<tr>
<td><code>MAX_VOLUNTARY_EXITS</code></td>
<td><code>2**4</code> (= 16)</td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p><em>Note</em>: The default mainnet configuration values are included here for
illustrative purposes. Defaults for this more dynamic type of configuration are
available with the presets in the <a href="../../configs"><code>configs</code></a> directory. Testnets
and other types of chain instances may use a different configuration.</p>
<h3 id="genesis-settings">Genesis settings<a class="headerlink" href="#genesis-settings" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MIN_GENESIS_ACTIVE_VALIDATOR_COUNT</code></td>
<td><code>uint64(2**14)</code> (= 16,384)</td>
</tr>
<tr>
<td><code>MIN_GENESIS_TIME</code></td>
<td><code>uint64(1606824000)</code> (Dec 1, 2020, 12pm UTC)</td>
</tr>
<tr>
<td><code>GENESIS_FORK_VERSION</code></td>
<td><code>Version('0x00000000')</code></td>
</tr>
<tr>
<td><code>GENESIS_DELAY</code></td>
<td><code>uint64(604800)</code> (7 days)</td>
</tr>
</tbody>
</table>
<h3 id="time-parameters_1">Time parameters<a class="headerlink" href="#time-parameters_1" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th style="text-align: center;">Unit</th>
<th style="text-align: center;">Duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SECONDS_PER_SLOT</code> <em>deprecated</em></td>
<td><code>uint64(12)</code></td>
<td style="text-align: center;">seconds</td>
<td style="text-align: center;">12 seconds</td>
</tr>
<tr>
<td><code>SLOT_DURATION_MS</code></td>
<td><code>uint64(12000)</code></td>
<td style="text-align: center;">milliseconds</td>
<td style="text-align: center;">12 seconds</td>
</tr>
<tr>
<td><code>SECONDS_PER_ETH1_BLOCK</code></td>
<td><code>uint64(14)</code></td>
<td style="text-align: center;">seconds</td>
<td style="text-align: center;">14 seconds</td>
</tr>
<tr>
<td><code>MIN_VALIDATOR_WITHDRAWABILITY_DELAY</code></td>
<td><code>uint64(2**8)</code> (= 256)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">~27 hours</td>
</tr>
<tr>
<td><code>SHARD_COMMITTEE_PERIOD</code></td>
<td><code>uint64(2**8)</code> (= 256)</td>
<td style="text-align: center;">epochs</td>
<td style="text-align: center;">~27 hours</td>
</tr>
<tr>
<td><code>ETH1_FOLLOW_DISTANCE</code></td>
<td><code>uint64(2**11)</code> (= 2,048)</td>
<td style="text-align: center;">Eth1 blocks</td>
<td style="text-align: center;">~8 hours</td>
</tr>
</tbody>
</table>
<h3 id="validator-cycle">Validator cycle<a class="headerlink" href="#validator-cycle" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>EJECTION_BALANCE</code></td>
<td><code>Gwei(2**4 * 10**9)</code> (= 16,000,000,000)</td>
</tr>
<tr>
<td><code>MIN_PER_EPOCH_CHURN_LIMIT</code></td>
<td><code>uint64(2**2)</code> (= 4)</td>
</tr>
<tr>
<td><code>CHURN_LIMIT_QUOTIENT</code></td>
<td><code>uint64(2**16)</code> (= 65,536)</td>
</tr>
</tbody>
</table>
<h2 id="containers">Containers<a class="headerlink" href="#containers" title="Permanent link">&para;</a></h2>
<p>The following types are <a href="../../../ssz/simple-serialize/">SimpleSerialize (SSZ)</a>
containers.</p>
<p><em>Note</em>: The definitions are ordered topologically to facilitate execution of the
spec.</p>
<p><em>Note</em>: Fields missing in container instantiations default to their zero value.</p>
<h3 id="misc-dependencies">Misc dependencies<a class="headerlink" href="#misc-dependencies" title="Permanent link">&para;</a></h3>
<h4 id="fork"><code>Fork</code><a class="headerlink" href="#fork" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Fork</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span style="color: #F8F8F2">previous_version:</span> <span style="color: #F8F8F2">Version</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span style="color: #F8F8F2">current_version:</span> <span style="color: #F8F8F2">Version</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch</span>
</code></pre></div></td></tr></table></div>
<h4 id="forkdata"><code>ForkData</code><a class="headerlink" href="#forkdata" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-1-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-1-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-1-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">ForkData</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span style="color: #F8F8F2">current_version:</span> <span style="color: #F8F8F2">Version</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span style="color: #F8F8F2">genesis_validators_root:</span> <span style="color: #F8F8F2">Root</span>
</code></pre></div></td></tr></table></div>
<h4 id="checkpoint"><code>Checkpoint</code><a class="headerlink" href="#checkpoint" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-2-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-2-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Checkpoint</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span style="color: #F8F8F2">root:</span> <span style="color: #F8F8F2">Root</span>
</code></pre></div></td></tr></table></div>
<h4 id="validator"><code>Validator</code><a class="headerlink" href="#validator" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Validator</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span style="color: #F8F8F2">pubkey:</span> <span style="color: #F8F8F2">BLSPubkey</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span style="color: #F8F8F2">withdrawal_credentials:</span> <span style="color: #F8F8F2">Bytes32</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span style="color: #F8F8F2">effective_balance:</span> <span style="color: #F8F8F2">Gwei</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span style="color: #F8F8F2">slashed:</span> <span style="color: #F8F8F2">boolean</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span style="color: #F8F8F2">activation_eligibility_epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>    <span style="color: #F8F8F2">activation_epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>    <span style="color: #F8F8F2">exit_epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span style="color: #F8F8F2">withdrawable_epoch:</span> <span style="color: #F8F8F2">Epoch</span>
</code></pre></div></td></tr></table></div>
<h4 id="attestationdata"><code>AttestationData</code><a class="headerlink" href="#attestationdata" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">AttestationData</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>    <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">CommitteeIndex</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span style="color: #F8F8F2">beacon_block_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span style="color: #F8F8F2">source:</span> <span style="color: #F8F8F2">Checkpoint</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span style="color: #F8F8F2">target:</span> <span style="color: #F8F8F2">Checkpoint</span>
</code></pre></div></td></tr></table></div>
<h4 id="indexedattestation"><code>IndexedAttestation</code><a class="headerlink" href="#indexedattestation" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-5-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-5-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-5-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">IndexedAttestation</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span style="color: #F8F8F2">attesting_indices:</span> <span style="color: #F8F8F2">List[ValidatorIndex,</span> <span style="color: #F8F8F2">MAX_VALIDATORS_PER_COMMITTEE]</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>    <span style="color: #F8F8F2">data:</span> <span style="color: #F8F8F2">AttestationData</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h4 id="pendingattestation"><code>PendingAttestation</code><a class="headerlink" href="#pendingattestation" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">PendingAttestation</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span style="color: #F8F8F2">aggregation_bits:</span> <span style="color: #F8F8F2">Bitlist[MAX_VALIDATORS_PER_COMMITTEE]</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span style="color: #F8F8F2">data:</span> <span style="color: #F8F8F2">AttestationData</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span style="color: #F8F8F2">inclusion_delay:</span> <span style="color: #F8F8F2">Slot</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>    <span style="color: #F8F8F2">proposer_index:</span> <span style="color: #F8F8F2">ValidatorIndex</span>
</code></pre></div></td></tr></table></div>
<h4 id="eth1data"><code>Eth1Data</code><a class="headerlink" href="#eth1data" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Eth1Data</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span style="color: #F8F8F2">deposit_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span style="color: #F8F8F2">deposit_count:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span style="color: #F8F8F2">block_hash:</span> <span style="color: #F8F8F2">Hash32</span>
</code></pre></div></td></tr></table></div>
<h4 id="historicalbatch"><code>HistoricalBatch</code><a class="headerlink" href="#historicalbatch" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">HistoricalBatch</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span style="color: #F8F8F2">block_roots:</span> <span style="color: #F8F8F2">Vector[Root,</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT]</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>    <span style="color: #F8F8F2">state_roots:</span> <span style="color: #F8F8F2">Vector[Root,</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT]</span>
</code></pre></div></td></tr></table></div>
<h4 id="depositmessage"><code>DepositMessage</code><a class="headerlink" href="#depositmessage" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">DepositMessage</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span style="color: #F8F8F2">pubkey:</span> <span style="color: #F8F8F2">BLSPubkey</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>    <span style="color: #F8F8F2">withdrawal_credentials:</span> <span style="color: #F8F8F2">Bytes32</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>    <span style="color: #F8F8F2">amount:</span> <span style="color: #F8F8F2">Gwei</span>
</code></pre></div></td></tr></table></div>
<h4 id="depositdata"><code>DepositData</code><a class="headerlink" href="#depositdata" title="Permanent link">&para;</a></h4>
<p><em>Note</em>: <code>signature</code> is over <code>DepositMessage</code>.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">DepositData</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span style="color: #F8F8F2">pubkey:</span> <span style="color: #F8F8F2">BLSPubkey</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span style="color: #F8F8F2">withdrawal_credentials:</span> <span style="color: #F8F8F2">Bytes32</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span style="color: #F8F8F2">amount:</span> <span style="color: #F8F8F2">Gwei</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h4 id="beaconblockheader"><code>BeaconBlockHeader</code><a class="headerlink" href="#beaconblockheader" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">BeaconBlockHeader</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>    <span style="color: #F8F8F2">proposer_index:</span> <span style="color: #F8F8F2">ValidatorIndex</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>    <span style="color: #F8F8F2">parent_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>    <span style="color: #F8F8F2">state_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>    <span style="color: #F8F8F2">body_root:</span> <span style="color: #F8F8F2">Root</span>
</code></pre></div></td></tr></table></div>
<h4 id="signingdata"><code>SigningData</code><a class="headerlink" href="#signingdata" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">SigningData</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>    <span style="color: #F8F8F2">object_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>    <span style="color: #F8F8F2">domain:</span> <span style="color: #F8F8F2">Domain</span>
</code></pre></div></td></tr></table></div>
<h3 id="beacon-operations">Beacon operations<a class="headerlink" href="#beacon-operations" title="Permanent link">&para;</a></h3>
<h4 id="proposerslashing"><code>ProposerSlashing</code><a class="headerlink" href="#proposerslashing" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">ProposerSlashing</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span style="color: #F8F8F2">signed_header_1:</span> <span style="color: #F8F8F2">SignedBeaconBlockHeader</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span style="color: #F8F8F2">signed_header_2:</span> <span style="color: #F8F8F2">SignedBeaconBlockHeader</span>
</code></pre></div></td></tr></table></div>
<h4 id="attesterslashing"><code>AttesterSlashing</code><a class="headerlink" href="#attesterslashing" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-14-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-14-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-14-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">AttesterSlashing</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span style="color: #F8F8F2">attestation_1:</span> <span style="color: #F8F8F2">IndexedAttestation</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>    <span style="color: #F8F8F2">attestation_2:</span> <span style="color: #F8F8F2">IndexedAttestation</span>
</code></pre></div></td></tr></table></div>
<h4 id="attestation"><code>Attestation</code><a class="headerlink" href="#attestation" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Attestation</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>    <span style="color: #F8F8F2">aggregation_bits:</span> <span style="color: #F8F8F2">Bitlist[MAX_VALIDATORS_PER_COMMITTEE]</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>    <span style="color: #F8F8F2">data:</span> <span style="color: #F8F8F2">AttestationData</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h4 id="deposit"><code>Deposit</code><a class="headerlink" href="#deposit" title="Permanent link">&para;</a></h4>
<p><em>Note</em>: <code>proof</code> is the Merkle path to the deposit root.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-16-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-16-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-16-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Deposit</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>    <span style="color: #F8F8F2">proof:</span> <span style="color: #F8F8F2">Vector[Bytes32,</span> <span style="color: #F8F8F2">DEPOSIT_CONTRACT_TREE_DEPTH</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>    <span style="color: #F8F8F2">data:</span> <span style="color: #F8F8F2">DepositData</span>
</code></pre></div></td></tr></table></div>
<h4 id="voluntaryexit"><code>VoluntaryExit</code><a class="headerlink" href="#voluntaryexit" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">VoluntaryExit</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>    <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>    <span style="color: #F8F8F2">validator_index:</span> <span style="color: #F8F8F2">ValidatorIndex</span>
</code></pre></div></td></tr></table></div>
<h3 id="beacon-blocks">Beacon blocks<a class="headerlink" href="#beacon-blocks" title="Permanent link">&para;</a></h3>
<h4 id="beaconblockbody"><code>BeaconBlockBody</code><a class="headerlink" href="#beaconblockbody" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">BeaconBlockBody</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>    <span style="color: #F8F8F2">randao_reveal:</span> <span style="color: #F8F8F2">BLSSignature</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>    <span style="color: #F8F8F2">eth1_data:</span> <span style="color: #F8F8F2">Eth1Data</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>    <span style="color: #F8F8F2">graffiti:</span> <span style="color: #F8F8F2">Bytes32</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>    <span style="color: #F8F8F2">proposer_slashings:</span> <span style="color: #F8F8F2">List[ProposerSlashing,</span> <span style="color: #F8F8F2">MAX_PROPOSER_SLASHINGS]</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>    <span style="color: #F8F8F2">attester_slashings:</span> <span style="color: #F8F8F2">List[AttesterSlashing,</span> <span style="color: #F8F8F2">MAX_ATTESTER_SLASHINGS]</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>    <span style="color: #F8F8F2">attestations:</span> <span style="color: #F8F8F2">List[Attestation,</span> <span style="color: #F8F8F2">MAX_ATTESTATIONS]</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>    <span style="color: #F8F8F2">deposits:</span> <span style="color: #F8F8F2">List[Deposit,</span> <span style="color: #F8F8F2">MAX_DEPOSITS]</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>    <span style="color: #F8F8F2">voluntary_exits:</span> <span style="color: #F8F8F2">List[SignedVoluntaryExit,</span> <span style="color: #F8F8F2">MAX_VOLUNTARY_EXITS]</span>
</code></pre></div></td></tr></table></div>
<h4 id="beaconblock"><code>BeaconBlock</code><a class="headerlink" href="#beaconblock" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-19-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-19-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-19-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-19-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-19-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-19-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">BeaconBlock</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>    <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>    <span style="color: #F8F8F2">proposer_index:</span> <span style="color: #F8F8F2">ValidatorIndex</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>    <span style="color: #F8F8F2">parent_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>    <span style="color: #F8F8F2">state_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span style="color: #F8F8F2">body:</span> <span style="color: #F8F8F2">BeaconBlockBody</span>
</code></pre></div></td></tr></table></div>
<h3 id="beacon-state">Beacon state<a class="headerlink" href="#beacon-state" title="Permanent link">&para;</a></h3>
<h4 id="beaconstate"><code>BeaconState</code><a class="headerlink" href="#beaconstate" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-20-22">22</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">BeaconState</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>    <span style="color: #F8F8F2">genesis_time:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>    <span style="color: #F8F8F2">genesis_validators_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>    <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>    <span style="color: #F8F8F2">fork:</span> <span style="color: #F8F8F2">Fork</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>    <span style="color: #F8F8F2">latest_block_header:</span> <span style="color: #F8F8F2">BeaconBlockHeader</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>    <span style="color: #F8F8F2">block_roots:</span> <span style="color: #F8F8F2">Vector[Root,</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT]</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span style="color: #F8F8F2">state_roots:</span> <span style="color: #F8F8F2">Vector[Root,</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT]</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>    <span style="color: #F8F8F2">historical_roots:</span> <span style="color: #F8F8F2">List[Root,</span> <span style="color: #F8F8F2">HISTORICAL_ROOTS_LIMIT]</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>    <span style="color: #F8F8F2">eth1_data:</span> <span style="color: #F8F8F2">Eth1Data</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>    <span style="color: #F8F8F2">eth1_data_votes:</span> <span style="color: #F8F8F2">List[Eth1Data,</span> <span style="color: #F8F8F2">EPOCHS_PER_ETH1_VOTING_PERIOD</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH]</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>    <span style="color: #F8F8F2">eth1_deposit_index:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>    <span style="color: #F8F8F2">validators:</span> <span style="color: #F8F8F2">List[Validator,</span> <span style="color: #F8F8F2">VALIDATOR_REGISTRY_LIMIT]</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>    <span style="color: #F8F8F2">balances:</span> <span style="color: #F8F8F2">List[Gwei,</span> <span style="color: #F8F8F2">VALIDATOR_REGISTRY_LIMIT]</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>    <span style="color: #F8F8F2">randao_mixes:</span> <span style="color: #F8F8F2">Vector[Bytes32,</span> <span style="color: #F8F8F2">EPOCHS_PER_HISTORICAL_VECTOR]</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>    <span style="color: #F8F8F2">slashings:</span> <span style="color: #F8F8F2">Vector[Gwei,</span> <span style="color: #F8F8F2">EPOCHS_PER_SLASHINGS_VECTOR]</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>    <span style="color: #F8F8F2">previous_epoch_attestations:</span> <span style="color: #F8F8F2">List[PendingAttestation,</span> <span style="color: #F8F8F2">MAX_ATTESTATIONS</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH]</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>    <span style="color: #F8F8F2">current_epoch_attestations:</span> <span style="color: #F8F8F2">List[PendingAttestation,</span> <span style="color: #F8F8F2">MAX_ATTESTATIONS</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH]</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>    <span style="color: #F8F8F2">justification_bits:</span> <span style="color: #F8F8F2">Bitvector[JUSTIFICATION_BITS_LENGTH]</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a>    <span style="color: #F8F8F2">previous_justified_checkpoint:</span> <span style="color: #F8F8F2">Checkpoint</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>    <span style="color: #F8F8F2">current_justified_checkpoint:</span> <span style="color: #F8F8F2">Checkpoint</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>    <span style="color: #F8F8F2">finalized_checkpoint:</span> <span style="color: #F8F8F2">Checkpoint</span>
</code></pre></div></td></tr></table></div>
<h3 id="signed-envelopes">Signed envelopes<a class="headerlink" href="#signed-envelopes" title="Permanent link">&para;</a></h3>
<h4 id="signedvoluntaryexit"><code>SignedVoluntaryExit</code><a class="headerlink" href="#signedvoluntaryexit" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-21-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-21-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-21-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">SignedVoluntaryExit</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>    <span style="color: #F8F8F2">message:</span> <span style="color: #F8F8F2">VoluntaryExit</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h4 id="signedbeaconblock"><code>SignedBeaconBlock</code><a class="headerlink" href="#signedbeaconblock" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-22-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-22-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-22-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">SignedBeaconBlock</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>    <span style="color: #F8F8F2">message:</span> <span style="color: #F8F8F2">BeaconBlock</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h4 id="signedbeaconblockheader"><code>SignedBeaconBlockHeader</code><a class="headerlink" href="#signedbeaconblockheader" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-23-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-23-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-23-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">SignedBeaconBlockHeader</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>    <span style="color: #F8F8F2">message:</span> <span style="color: #F8F8F2">BeaconBlockHeader</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h2 id="helper-functions">Helper functions<a class="headerlink" href="#helper-functions" title="Permanent link">&para;</a></h2>
<p><em>Note</em>: The definitions below are for specification purposes and are not
necessarily optimal implementations.</p>
<h3 id="math">Math<a class="headerlink" href="#math" title="Permanent link">&para;</a></h3>
<h4 id="integer_squareroot"><code>integer_squareroot</code><a class="headerlink" href="#integer_squareroot" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-24-12">12</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">integer_squareroot</span><span style="color: #F8F8F2">(n:</span> <span style="color: #F8F8F2">uint64)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span style="color: #E6DB74">    Return the largest integer ``x`` such that ``x**2 &lt;= n``.</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">n</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">UINT64_MAX:</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>        <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">UINT64_MAX_SQRT</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>    <span style="color: #F8F8F2">x</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">n</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>    <span style="color: #F8F8F2">y</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(x</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">//</span> <span style="color: #AE81FF">2</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>    <span style="color: #66D9EF">while</span> <span style="color: #F8F8F2">y</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">x:</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>        <span style="color: #F8F8F2">x</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">y</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>        <span style="color: #F8F8F2">y</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(x</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">n</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">x)</span> <span style="color: #FF4689">//</span> <span style="color: #AE81FF">2</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">x</span>
</code></pre></div></td></tr></table></div>
<h4 id="xor"><code>xor</code><a class="headerlink" href="#xor" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-25-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-25-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-25-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-25-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-25-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">xor</span><span style="color: #F8F8F2">(bytes_1:</span> <span style="color: #F8F8F2">Bytes32,</span> <span style="color: #F8F8F2">bytes_2:</span> <span style="color: #F8F8F2">Bytes32)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Bytes32:</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span style="color: #E6DB74">    Return the exclusive-or of two 32-byte strings.</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Bytes32(a</span> <span style="color: #FF4689">^</span> <span style="color: #F8F8F2">b</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">a,</span> <span style="color: #F8F8F2">b</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">zip(bytes_1,</span> <span style="color: #F8F8F2">bytes_2))</span>
</code></pre></div></td></tr></table></div>
<h4 id="uint_to_bytes"><code>uint_to_bytes</code><a class="headerlink" href="#uint_to_bytes" title="Permanent link">&para;</a></h4>
<p><code>def uint_to_bytes(n: uint) -&gt; bytes</code> is a function for serializing the <code>uint</code>
type object to bytes in <code>ENDIANNESS</code>-endian. The expected length of the output
is the byte-length of the <code>uint</code> type.</p>
<h4 id="bytes_to_uint64"><code>bytes_to_uint64</code><a class="headerlink" href="#bytes_to_uint64" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-26-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-26-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-26-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-26-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-26-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">bytes_to_uint64</span><span style="color: #F8F8F2">(data:</span> <span style="color: #F8F8F2">bytes)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span style="color: #E6DB74">    Return the integer deserialization of ``data`` interpreted as ``ENDIANNESS``-endian.</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">uint64(int</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">from_bytes(data,</span> <span style="color: #F8F8F2">ENDIANNESS))</span>
</code></pre></div></td></tr></table></div>
<h4 id="saturating_sub"><code>saturating_sub</code><a class="headerlink" href="#saturating_sub" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-27-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-27-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-27-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-27-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-27-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">saturating_sub</span><span style="color: #F8F8F2">(a:</span> <span style="color: #F8F8F2">int,</span> <span style="color: #F8F8F2">b:</span> <span style="color: #F8F8F2">int)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">int:</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span style="color: #E6DB74">    Computes a - b, saturating at numeric bounds.</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">a</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">b</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">a</span> <span style="color: #FF4689">&gt;</span> <span style="color: #F8F8F2">b</span> <span style="color: #66D9EF">else</span> <span style="color: #AE81FF">0</span>
</code></pre></div></td></tr></table></div>
<h3 id="crypto">Crypto<a class="headerlink" href="#crypto" title="Permanent link">&para;</a></h3>
<h4 id="hash"><code>hash</code><a class="headerlink" href="#hash" title="Permanent link">&para;</a></h4>
<p><code>def hash(data: bytes) -&gt; Bytes32</code> is SHA256.</p>
<h4 id="hash_tree_root"><code>hash_tree_root</code><a class="headerlink" href="#hash_tree_root" title="Permanent link">&para;</a></h4>
<p><code>def hash_tree_root(object: SSZSerializable) -&gt; Root</code> is a function for hashing
objects into a single root by utilizing a hash tree structure, as defined in the
<a href="../../../ssz/simple-serialize/#merkleization">SSZ spec</a>.</p>
<h4 id="bls-signatures">BLS signatures<a class="headerlink" href="#bls-signatures" title="Permanent link">&para;</a></h4>
<p>The
<a href="https://tools.ietf.org/html/draft-irtf-cfrg-bls-signature-04">IETF BLS signature draft standard v4</a>
with ciphersuite <code>BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_POP_</code> defines the
following functions:</p>
<ul>
<li><code>def Sign(privkey: int, message: Bytes) -&gt; BLSSignature</code></li>
<li><code>def Verify(pubkey: BLSPubkey, message: Bytes, signature: BLSSignature) -&gt; bool</code></li>
<li><code>def Aggregate(signatures: Sequence[BLSSignature]) -&gt; BLSSignature</code></li>
<li><code>def FastAggregateVerify(pubkeys: Sequence[BLSPubkey], message: Bytes, signature: BLSSignature) -&gt; bool</code></li>
<li><code>def AggregateVerify(pubkeys: Sequence[BLSPubkey], messages: Sequence[Bytes], signature: BLSSignature) -&gt; bool</code></li>
<li><code>def KeyValidate(pubkey: BLSPubkey) -&gt; bool</code></li>
</ul>
<p>The above functions are accessed through the <code>bls</code> module, e.g. <code>bls.Verify</code>.</p>
<h3 id="predicates">Predicates<a class="headerlink" href="#predicates" title="Permanent link">&para;</a></h3>
<h4 id="is_active_validator"><code>is_active_validator</code><a class="headerlink" href="#is_active_validator" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-28-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-28-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-28-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-28-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-28-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_active_validator</span><span style="color: #F8F8F2">(validator:</span> <span style="color: #F8F8F2">Validator,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span style="color: #E6DB74">    Check if ``validator`` is active.</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_epoch</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span>
</code></pre></div></td></tr></table></div>
<h4 id="is_eligible_for_activation_queue"><code>is_eligible_for_activation_queue</code><a class="headerlink" href="#is_eligible_for_activation_queue" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-29-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_eligible_for_activation_queue</span><span style="color: #F8F8F2">(validator:</span> <span style="color: #F8F8F2">Validator)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span style="color: #E6DB74">    Check if ``validator`` is eligible to be placed into the activation queue.</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a>        <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_eligibility_epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">FAR_FUTURE_EPOCH</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a>        <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">MAX_EFFECTIVE_BALANCE</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="is_eligible_for_activation"><code>is_eligible_for_activation</code><a class="headerlink" href="#is_eligible_for_activation" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-30-10">10</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_eligible_for_activation</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">validator:</span> <span style="color: #F8F8F2">Validator)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span style="color: #E6DB74">    Check if ``validator`` is eligible for activation.</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a>        <span style="color: #959077"># Placement in queue is finalized</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a>        <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_eligibility_epoch</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">finalized_checkpoint</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>        <span style="color: #959077"># Has not yet been activated</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>        <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">FAR_FUTURE_EPOCH</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="is_slashable_validator"><code>is_slashable_validator</code><a class="headerlink" href="#is_slashable_validator" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-31-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-31-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-31-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-31-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-31-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-31-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-31-7">7</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_slashable_validator</span><span style="color: #F8F8F2">(validator:</span> <span style="color: #F8F8F2">Validator,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span style="color: #E6DB74">    Check if ``validator`` is slashable.</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">(</span><span style="color: #FF4689">not</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashed)</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a>        <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_epoch</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">withdrawable_epoch</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="is_slashable_attestation_data"><code>is_slashable_attestation_data</code><a class="headerlink" href="#is_slashable_attestation_data" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-32-11">11</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_slashable_attestation_data</span><span style="color: #F8F8F2">(data_1:</span> <span style="color: #F8F8F2">AttestationData,</span> <span style="color: #F8F8F2">data_2:</span> <span style="color: #F8F8F2">AttestationData)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span style="color: #E6DB74">    Check if ``data_1`` and ``data_2`` are slashable according to Casper FFG rules.</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>        <span style="color: #959077"># Double vote</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>        <span style="color: #F8F8F2">(data_1</span> <span style="color: #FF4689">!=</span> <span style="color: #F8F8F2">data_2</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">data_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">data_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>        <span style="color: #FF4689">or</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>        <span style="color: #959077"># Surround vote</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>        <span style="color: #F8F8F2">(data_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">source</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">data_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">source</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">data_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">data_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="is_valid_indexed_attestation"><code>is_valid_indexed_attestation</code><a class="headerlink" href="#is_valid_indexed_attestation" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-33-15">15</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_valid_indexed_attestation</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">indexed_attestation:</span> <span style="color: #F8F8F2">IndexedAttestation</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span style="color: #E6DB74">    Check if ``indexed_attestation`` is not empty, has sorted and unique indices and has a valid aggregate signature.</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>    <span style="color: #959077"># Verify indices are sorted and unique</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a>    <span style="color: #F8F8F2">indices</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">indexed_attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">attesting_indices</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">len(indices)</span> <span style="color: #FF4689">==</span> <span style="color: #AE81FF">0</span> <span style="color: #FF4689">or</span> <span style="color: #FF4689">not</span> <span style="color: #F8F8F2">indices</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">sorted(set(indices)):</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>        <span style="color: #66D9EF">return</span> <span style="color: #66D9EF">False</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>    <span style="color: #959077"># Verify aggregate signature</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>    <span style="color: #F8F8F2">pubkeys</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[i]</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">pubkey</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">i</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">indices]</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a>    <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_BEACON_ATTESTER,</span> <span style="color: #F8F8F2">indexed_attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(indexed_attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">FastAggregateVerify(pubkeys,</span> <span style="color: #F8F8F2">signing_root,</span> <span style="color: #F8F8F2">indexed_attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signature)</span>
</code></pre></div></td></tr></table></div>
<h4 id="is_valid_merkle_branch"><code>is_valid_merkle_branch</code><a class="headerlink" href="#is_valid_merkle_branch" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-34-13">13</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_valid_merkle_branch</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>    <span style="color: #F8F8F2">leaf:</span> <span style="color: #F8F8F2">Bytes32,</span> <span style="color: #F8F8F2">branch:</span> <span style="color: #F8F8F2">Sequence[Bytes32],</span> <span style="color: #F8F8F2">depth:</span> <span style="color: #F8F8F2">uint64,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">uint64,</span> <span style="color: #F8F8F2">root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span style="color: #E6DB74">    Check if ``leaf`` at ``index`` verifies against the Merkle ``root`` and ``branch``.</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>    <span style="color: #F8F8F2">value</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">leaf</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">i</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(depth):</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">(</span><span style="color: #AE81FF">2</span><span style="color: #FF4689">**</span><span style="color: #F8F8F2">i)</span> <span style="color: #FF4689">%</span> <span style="color: #AE81FF">2</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a>            <span style="color: #F8F8F2">value</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash(branch[i]</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">value)</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a>        <span style="color: #66D9EF">else</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a>            <span style="color: #F8F8F2">value</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash(value</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">branch[i])</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">value</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">root</span>
</code></pre></div></td></tr></table></div>
<h3 id="misc_2">Misc<a class="headerlink" href="#misc_2" title="Permanent link">&para;</a></h3>
<h4 id="compute_shuffled_index"><code>compute_shuffled_index</code><a class="headerlink" href="#compute_shuffled_index" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-35-20">20</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_shuffled_index</span><span style="color: #F8F8F2">(index:</span> <span style="color: #F8F8F2">uint64,</span> <span style="color: #F8F8F2">index_count:</span> <span style="color: #F8F8F2">uint64,</span> <span style="color: #F8F8F2">seed:</span> <span style="color: #F8F8F2">Bytes32)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span style="color: #E6DB74">    Return the shuffled index corresponding to ``seed`` (and ``index_count``).</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">index_count</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>    <span style="color: #959077"># Swap or not (https://link.springer.com/content/pdf/10.1007%2F978-3-642-32009-5_1.pdf)</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>    <span style="color: #959077"># See the &#39;generalized domain&#39; algorithm on page 3</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">current_round</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(SHUFFLE_ROUND_COUNT):</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a>        <span style="color: #F8F8F2">pivot</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">bytes_to_uint64(hash(seed</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">uint_to_bytes(uint8(current_round)))[</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span><span style="color: #AE81FF">8</span><span style="color: #F8F8F2">])</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">index_count</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>        <span style="color: #F8F8F2">flip</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(pivot</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">index_count</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">index)</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">index_count</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>        <span style="color: #F8F8F2">position</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">max(index,</span> <span style="color: #F8F8F2">flip)</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>        <span style="color: #F8F8F2">source</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash(</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a>            <span style="color: #F8F8F2">seed</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">uint_to_bytes(uint8(current_round))</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">uint_to_bytes(uint32(position</span> <span style="color: #FF4689">//</span> <span style="color: #AE81FF">256</span><span style="color: #F8F8F2">))</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a>        <span style="color: #F8F8F2">byte</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">uint8(source[(position</span> <span style="color: #FF4689">%</span> <span style="color: #AE81FF">256</span><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">//</span> <span style="color: #AE81FF">8</span><span style="color: #F8F8F2">])</span>
<a id="__codelineno-35-17" name="__codelineno-35-17"></a>        <span style="color: #F8F8F2">bit</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(byte</span> <span style="color: #FF4689">&gt;&gt;</span> <span style="color: #F8F8F2">(position</span> <span style="color: #FF4689">%</span> <span style="color: #AE81FF">8</span><span style="color: #F8F8F2">))</span> <span style="color: #FF4689">%</span> <span style="color: #AE81FF">2</span>
<a id="__codelineno-35-18" name="__codelineno-35-18"></a>        <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">flip</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">bit</span> <span style="color: #66D9EF">else</span> <span style="color: #F8F8F2">index</span>
<a id="__codelineno-35-19" name="__codelineno-35-19"></a>
<a id="__codelineno-35-20" name="__codelineno-35-20"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">index</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_proposer_index"><code>compute_proposer_index</code><a class="headerlink" href="#compute_proposer_index" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-36-17">17</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_proposer_index</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">indices:</span> <span style="color: #F8F8F2">Sequence[ValidatorIndex],</span> <span style="color: #F8F8F2">seed:</span> <span style="color: #F8F8F2">Bytes32</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">ValidatorIndex:</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span style="color: #E6DB74">    Return from ``indices`` a random index sampled by effective balance.</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">len(indices)</span> <span style="color: #FF4689">&gt;</span> <span style="color: #AE81FF">0</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>    <span style="color: #F8F8F2">MAX_RANDOM_BYTE</span> <span style="color: #FF4689">=</span> <span style="color: #AE81FF">2</span><span style="color: #FF4689">**</span><span style="color: #AE81FF">8</span> <span style="color: #FF4689">-</span> <span style="color: #AE81FF">1</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>    <span style="color: #F8F8F2">i</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">uint64(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a>    <span style="color: #F8F8F2">total</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">uint64(len(indices))</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a>    <span style="color: #66D9EF">while</span> <span style="color: #66D9EF">True</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>        <span style="color: #F8F8F2">candidate_index</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">indices[compute_shuffled_index(i</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">total,</span> <span style="color: #F8F8F2">total,</span> <span style="color: #F8F8F2">seed)]</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>        <span style="color: #F8F8F2">random_byte</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash(seed</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">uint_to_bytes(uint64(i</span> <span style="color: #FF4689">//</span> <span style="color: #AE81FF">32</span><span style="color: #F8F8F2">)))[i</span> <span style="color: #FF4689">%</span> <span style="color: #AE81FF">32</span><span style="color: #F8F8F2">]</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a>        <span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[candidate_index]</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">MAX_RANDOM_BYTE</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">MAX_EFFECTIVE_BALANCE</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">random_byte:</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>            <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">candidate_index</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a>        <span style="color: #F8F8F2">i</span> <span style="color: #FF4689">+=</span> <span style="color: #AE81FF">1</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_committee"><code>compute_committee</code><a class="headerlink" href="#compute_committee" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-37-12">12</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_committee</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>    <span style="color: #F8F8F2">indices:</span> <span style="color: #F8F8F2">Sequence[ValidatorIndex],</span> <span style="color: #F8F8F2">seed:</span> <span style="color: #F8F8F2">Bytes32,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">uint64,</span> <span style="color: #F8F8F2">count:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Sequence[ValidatorIndex]:</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span style="color: #E6DB74">    Return the committee corresponding to ``indices``, ``seed``, ``index``, and committee ``count``.</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>    <span style="color: #F8F8F2">start</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(len(indices)</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">index)</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">count</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a>    <span style="color: #F8F8F2">end</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(len(indices)</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">uint64(index</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">))</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">count</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a>        <span style="color: #F8F8F2">indices[compute_shuffled_index(uint64(i),</span> <span style="color: #F8F8F2">uint64(len(indices)),</span> <span style="color: #F8F8F2">seed)]</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">i</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(start,</span> <span style="color: #F8F8F2">end)</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a>    <span style="color: #F8F8F2">]</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_time_at_slot"><code>compute_time_at_slot</code><a class="headerlink" href="#compute_time_at_slot" title="Permanent link">&para;</a></h4>
<p><em>Note</em>: This function is unsafe with respect to overflows and underflows.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-38-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-38-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-38-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_time_at_slot</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>    <span style="color: #F8F8F2">slots_since_genesis</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">GENESIS_SLOT</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">uint64(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">genesis_time</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">slots_since_genesis</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SECONDS_PER_SLOT)</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_epoch_at_slot"><code>compute_epoch_at_slot</code><a class="headerlink" href="#compute_epoch_at_slot" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-39-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-39-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-39-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-39-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-39-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_epoch_at_slot</span><span style="color: #F8F8F2">(slot:</span> <span style="color: #F8F8F2">Slot)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Epoch:</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span style="color: #E6DB74">    Return the epoch number at ``slot``.</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Epoch(slot</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH)</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_start_slot_at_epoch"><code>compute_start_slot_at_epoch</code><a class="headerlink" href="#compute_start_slot_at_epoch" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-40-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-40-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-40-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-40-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-40-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_start_slot_at_epoch</span><span style="color: #F8F8F2">(epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Slot:</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span style="color: #E6DB74">    Return the start slot of ``epoch``.</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Slot(epoch</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH)</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_activation_exit_epoch"><code>compute_activation_exit_epoch</code><a class="headerlink" href="#compute_activation_exit_epoch" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-41-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-41-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-41-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-41-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-41-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_activation_exit_epoch</span><span style="color: #F8F8F2">(epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Epoch:</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span style="color: #E6DB74">    Return the epoch during which validator activations and exits initiated in ``epoch`` take effect.</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Epoch(epoch</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">MAX_SEED_LOOKAHEAD)</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_fork_data_root"><code>compute_fork_data_root</code><a class="headerlink" href="#compute_fork_data_root" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-42-11">11</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_fork_data_root</span><span style="color: #F8F8F2">(current_version:</span> <span style="color: #F8F8F2">Version,</span> <span style="color: #F8F8F2">genesis_validators_root:</span> <span style="color: #F8F8F2">Root)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Root:</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span style="color: #E6DB74">    Return the 32-byte fork data root for the ``current_version`` and ``genesis_validators_root``.</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span style="color: #E6DB74">    This is used primarily in signature domains to avoid collisions across forks/chains.</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">hash_tree_root(</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a>        <span style="color: #F8F8F2">ForkData(</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a>            <span style="color: #F8F8F2">current_version</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">current_version,</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a>            <span style="color: #F8F8F2">genesis_validators_root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">genesis_validators_root,</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_domain"><code>compute_domain</code><a class="headerlink" href="#compute_domain" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-43-12">12</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_domain</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>    <span style="color: #F8F8F2">domain_type:</span> <span style="color: #F8F8F2">DomainType,</span> <span style="color: #F8F8F2">fork_version:</span> <span style="color: #F8F8F2">Version</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">,</span> <span style="color: #F8F8F2">genesis_validators_root:</span> <span style="color: #F8F8F2">Root</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">None</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Domain:</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span style="color: #E6DB74">    Return the domain for the ``domain_type`` and ``fork_version``.</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">fork_version</span> <span style="color: #FF4689">is</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a>        <span style="color: #F8F8F2">fork_version</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">GENESIS_FORK_VERSION</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">genesis_validators_root</span> <span style="color: #FF4689">is</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a>        <span style="color: #F8F8F2">genesis_validators_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Root()</span>  <span style="color: #959077"># all bytes zero by default</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a>    <span style="color: #F8F8F2">fork_data_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_fork_data_root(fork_version,</span> <span style="color: #F8F8F2">genesis_validators_root)</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Domain(domain_type</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">fork_data_root[:</span><span style="color: #AE81FF">28</span><span style="color: #F8F8F2">])</span>
</code></pre></div></td></tr></table></div>
<h4 id="compute_signing_root"><code>compute_signing_root</code><a class="headerlink" href="#compute_signing_root" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-44-10">10</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_signing_root</span><span style="color: #F8F8F2">(ssz_object:</span> <span style="color: #F8F8F2">SSZObject,</span> <span style="color: #F8F8F2">domain:</span> <span style="color: #F8F8F2">Domain)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Root:</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span style="color: #E6DB74">    Return the signing root for the corresponding signing data.</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">hash_tree_root(</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a>        <span style="color: #F8F8F2">SigningData(</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a>            <span style="color: #F8F8F2">object_root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">hash_tree_root(ssz_object),</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a>            <span style="color: #F8F8F2">domain</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">domain,</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="beacon-state-accessors">Beacon state accessors<a class="headerlink" href="#beacon-state-accessors" title="Permanent link">&para;</a></h3>
<h4 id="get_current_epoch"><code>get_current_epoch</code><a class="headerlink" href="#get_current_epoch" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-45-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-45-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-45-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-45-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-45-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_current_epoch</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Epoch:</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span style="color: #E6DB74">    Return the current epoch.</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">compute_epoch_at_slot(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_previous_epoch"><code>get_previous_epoch</code><a class="headerlink" href="#get_previous_epoch" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-46-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-46-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-46-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-46-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-46-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-46-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_previous_epoch</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Epoch:</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;`</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span style="color: #E6DB74">    Return the previous epoch (unless the current epoch is ``GENESIS_EPOCH``).</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>    <span style="color: #F8F8F2">current_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">GENESIS_EPOCH</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">current_epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">GENESIS_EPOCH</span> <span style="color: #66D9EF">else</span> <span style="color: #F8F8F2">Epoch(current_epoch</span> <span style="color: #FF4689">-</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_block_root"><code>get_block_root</code><a class="headerlink" href="#get_block_root" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-47-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-47-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-47-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-47-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-47-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_block_root</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Root:</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span style="color: #E6DB74">    Return the block root at the start of a recent ``epoch``.</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_block_root_at_slot(state,</span> <span style="color: #F8F8F2">compute_start_slot_at_epoch(epoch))</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_block_root_at_slot"><code>get_block_root_at_slot</code><a class="headerlink" href="#get_block_root_at_slot" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-48-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-48-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-48-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-48-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-48-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-48-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_block_root_at_slot</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Root:</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span style="color: #E6DB74">    Return the block root at a recent ``slot``.</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">block_roots[slot</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT]</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_randao_mix"><code>get_randao_mix</code><a class="headerlink" href="#get_randao_mix" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-49-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-49-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-49-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-49-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-49-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_randao_mix</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Bytes32:</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span style="color: #E6DB74">    Return the randao mix at a recent ``epoch``.</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">randao_mixes[epoch</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EPOCHS_PER_HISTORICAL_VECTOR]</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_active_validator_indices"><code>get_active_validator_indices</code><a class="headerlink" href="#get_active_validator_indices" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-50-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-50-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-50-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-50-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-50-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-50-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-50-7">7</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_active_validator_indices</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Sequence[ValidatorIndex]:</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span style="color: #E6DB74">    Return the sequence of active validator indices at ``epoch``.</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a>        <span style="color: #F8F8F2">ValidatorIndex(i)</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">i,</span> <span style="color: #F8F8F2">v</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators)</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">is_active_validator(v,</span> <span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a>    <span style="color: #F8F8F2">]</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_validator_churn_limit"><code>get_validator_churn_limit</code><a class="headerlink" href="#get_validator_churn_limit" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-51-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_validator_churn_limit</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span style="color: #E6DB74">    Return the validator churn limit for the current epoch.</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>    <span style="color: #F8F8F2">active_validator_indices</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_active_validator_indices(state,</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">max(</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>        <span style="color: #F8F8F2">MIN_PER_EPOCH_CHURN_LIMIT,</span> <span style="color: #F8F8F2">uint64(len(active_validator_indices))</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">CHURN_LIMIT_QUOTIENT</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_seed"><code>get_seed</code><a class="headerlink" href="#get_seed" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-52-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_seed</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch,</span> <span style="color: #F8F8F2">domain_type:</span> <span style="color: #F8F8F2">DomainType)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Bytes32:</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span style="color: #E6DB74">    Return the seed at ``epoch``.</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a>    <span style="color: #F8F8F2">mix</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_randao_mix(</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">Epoch(epoch</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">EPOCHS_PER_HISTORICAL_VECTOR</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">MIN_SEED_LOOKAHEAD</span> <span style="color: #FF4689">-</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a>    <span style="color: #F8F8F2">)</span>  <span style="color: #959077"># Avoid underflow</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">hash(domain_type</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">uint_to_bytes(epoch)</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">mix)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_committee_count_per_slot"><code>get_committee_count_per_slot</code><a class="headerlink" href="#get_committee_count_per_slot" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-53-13">13</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_committee_count_per_slot</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span style="color: #E6DB74">    Return the number of committees in each slot for the given ``epoch``.</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">max(</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a>        <span style="color: #F8F8F2">uint64(</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">),</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>        <span style="color: #F8F8F2">min(</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a>            <span style="color: #F8F8F2">MAX_COMMITTEES_PER_SLOT,</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a>            <span style="color: #F8F8F2">uint64(len(get_active_validator_indices(state,</span> <span style="color: #F8F8F2">epoch)))</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a>            <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a>            <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">TARGET_COMMITTEE_SIZE,</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a>        <span style="color: #F8F8F2">),</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_beacon_committee"><code>get_beacon_committee</code><a class="headerlink" href="#get_beacon_committee" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-54-14">14</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_beacon_committee</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">CommitteeIndex</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Sequence[ValidatorIndex]:</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span style="color: #E6DB74">    Return the beacon committee at ``slot`` for ``index``.</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a>    <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_epoch_at_slot(slot)</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a>    <span style="color: #F8F8F2">committees_per_slot</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_committee_count_per_slot(state,</span> <span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">compute_committee(</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a>        <span style="color: #F8F8F2">indices</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">get_active_validator_indices(state,</span> <span style="color: #F8F8F2">epoch),</span>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a>        <span style="color: #F8F8F2">seed</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">get_seed(state,</span> <span style="color: #F8F8F2">epoch,</span> <span style="color: #F8F8F2">DOMAIN_BEACON_ATTESTER),</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a>        <span style="color: #F8F8F2">index</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">(slot</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH)</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">committees_per_slot</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">index,</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a>        <span style="color: #F8F8F2">count</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">committees_per_slot</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH,</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_beacon_proposer_index"><code>get_beacon_proposer_index</code><a class="headerlink" href="#get_beacon_proposer_index" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-55-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_beacon_proposer_index</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">ValidatorIndex:</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span style="color: #E6DB74">    Return the beacon proposer index at the current slot.</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a>    <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a>    <span style="color: #F8F8F2">seed</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash(get_seed(state,</span> <span style="color: #F8F8F2">epoch,</span> <span style="color: #F8F8F2">DOMAIN_BEACON_PROPOSER)</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">uint_to_bytes(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot))</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a>    <span style="color: #F8F8F2">indices</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_active_validator_indices(state,</span> <span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">compute_proposer_index(state,</span> <span style="color: #F8F8F2">indices,</span> <span style="color: #F8F8F2">seed)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_total_balance"><code>get_total_balance</code><a class="headerlink" href="#get_total_balance" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-56-12">12</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_total_balance</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">indices:</span> <span style="color: #F8F8F2">Set[ValidatorIndex])</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Gwei:</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span style="color: #E6DB74">    Return the combined effective balance of the ``indices``.</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span style="color: #E6DB74">    ``EFFECTIVE_BALANCE_INCREMENT`` Gwei minimum to avoid divisions by zero.</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><span style="color: #E6DB74">    Math safe up to ~10B ETH, after which this overflows uint64.</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Gwei(</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a>        <span style="color: #F8F8F2">max(</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a>            <span style="color: #F8F8F2">EFFECTIVE_BALANCE_INCREMENT,</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a>            <span style="color: #F8F8F2">sum([state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index]</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">indices]),</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_total_active_balance"><code>get_total_active_balance</code><a class="headerlink" href="#get_total_active_balance" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-57-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_total_active_balance</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Gwei:</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span style="color: #E6DB74">    Return the combined effective balance of the active validators.</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span style="color: #E6DB74">    Note: ``get_total_balance`` returns ``EFFECTIVE_BALANCE_INCREMENT`` Gwei minimum to avoid divisions by zero.</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_total_balance(</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">set(get_active_validator_indices(state,</span> <span style="color: #F8F8F2">get_current_epoch(state)))</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_domain"><code>get_domain</code><a class="headerlink" href="#get_domain" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-58-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_domain</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">domain_type:</span> <span style="color: #F8F8F2">DomainType,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Domain:</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span style="color: #E6DB74">    Return the signature domain (fork version concatenated with domain type) of a message.</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>    <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">is</span> <span style="color: #66D9EF">None</span> <span style="color: #66D9EF">else</span> <span style="color: #F8F8F2">epoch</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>    <span style="color: #F8F8F2">fork_version</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">fork</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">previous_version</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">fork</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #66D9EF">else</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">fork</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_version</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">compute_domain(domain_type,</span> <span style="color: #F8F8F2">fork_version,</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">genesis_validators_root)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_indexed_attestation"><code>get_indexed_attestation</code><a class="headerlink" href="#get_indexed_attestation" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-59-11">11</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_indexed_attestation</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attestation:</span> <span style="color: #F8F8F2">Attestation)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">IndexedAttestation:</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span style="color: #E6DB74">    Return the indexed attestation corresponding to ``attestation``.</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a>    <span style="color: #F8F8F2">attesting_indices</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_attesting_indices(state,</span> <span style="color: #F8F8F2">attestation)</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">IndexedAttestation(</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>        <span style="color: #F8F8F2">attesting_indices</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">sorted(attesting_indices),</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a>        <span style="color: #F8F8F2">data</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data,</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>        <span style="color: #F8F8F2">signature</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signature,</span>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="get_attesting_indices"><code>get_attesting_indices</code><a class="headerlink" href="#get_attesting_indices" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-60-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-60-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-60-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-60-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-60-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-60-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_attesting_indices</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attestation:</span> <span style="color: #F8F8F2">Attestation)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Set[ValidatorIndex]:</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span style="color: #E6DB74">    Return the set of attesting indices corresponding to ``data`` and ``bits``.</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a>    <span style="color: #F8F8F2">committee</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_beacon_committee(state,</span> <span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot,</span> <span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">index)</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">set(index</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">i,</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(committee)</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">aggregation_bits[i])</span>
</code></pre></div></td></tr></table></div>
<h3 id="beacon-state-mutators">Beacon state mutators<a class="headerlink" href="#beacon-state-mutators" title="Permanent link">&para;</a></h3>
<h4 id="increase_balance"><code>increase_balance</code><a class="headerlink" href="#increase_balance" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-61-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-61-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-61-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-61-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-61-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">increase_balance</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">ValidatorIndex,</span> <span style="color: #F8F8F2">delta:</span> <span style="color: #F8F8F2">Gwei)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span style="color: #E6DB74">    Increase the validator balance at index ``index`` by ``delta``.</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">balances[index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">delta</span>
</code></pre></div></td></tr></table></div>
<h4 id="decrease_balance"><code>decrease_balance</code><a class="headerlink" href="#decrease_balance" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-62-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-62-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-62-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-62-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-62-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">decrease_balance</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">ValidatorIndex,</span> <span style="color: #F8F8F2">delta:</span> <span style="color: #F8F8F2">Gwei)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><span style="color: #E6DB74">    Decrease the validator balance at index ``index`` by ``delta``, with underflow protection.</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">balances[index]</span> <span style="color: #FF4689">=</span> <span style="color: #AE81FF">0</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">delta</span> <span style="color: #FF4689">&gt;</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">balances[index]</span> <span style="color: #66D9EF">else</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">balances[index]</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">delta</span>
</code></pre></div></td></tr></table></div>
<h4 id="initiate_validator_exit"><code>initiate_validator_exit</code><a class="headerlink" href="#initiate_validator_exit" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-63-19">19</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">initiate_validator_exit</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">ValidatorIndex)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span style="color: #E6DB74">    Initiate the exit of the validator with index ``index``.</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a>    <span style="color: #959077"># Return if validator already initiated exit</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a>    <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index]</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span> <span style="color: #FF4689">!=</span> <span style="color: #F8F8F2">FAR_FUTURE_EPOCH:</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a>        <span style="color: #66D9EF">return</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a>    <span style="color: #959077"># Compute exit queue epoch</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a>    <span style="color: #F8F8F2">exit_epochs</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[v</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">v</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">v</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span> <span style="color: #FF4689">!=</span> <span style="color: #F8F8F2">FAR_FUTURE_EPOCH]</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a>    <span style="color: #F8F8F2">exit_queue_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">max(exit_epochs</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">[compute_activation_exit_epoch(get_current_epoch(state))])</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a>    <span style="color: #F8F8F2">exit_queue_churn</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">len([v</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">v</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">v</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">exit_queue_epoch])</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">exit_queue_churn</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">get_validator_churn_limit(state):</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a>        <span style="color: #F8F8F2">exit_queue_epoch</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">Epoch(</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a>    <span style="color: #959077"># Set validator exit epoch and withdrawable epoch</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a>    <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">exit_queue_epoch</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a>    <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">withdrawable_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Epoch(validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">MIN_VALIDATOR_WITHDRAWABILITY_DELAY)</span>
</code></pre></div></td></tr></table></div>
<h4 id="slash_validator"><code>slash_validator</code><a class="headerlink" href="#slash_validator" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-24">24</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-25">25</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-64-26">26</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">slash_validator</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">slashed_index:</span> <span style="color: #F8F8F2">ValidatorIndex,</span> <span style="color: #F8F8F2">whistleblower_index:</span> <span style="color: #F8F8F2">ValidatorIndex</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">None</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><span style="color: #E6DB74">    Slash the validator with index ``slashed_index``.</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a>    <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a>    <span style="color: #F8F8F2">initiate_validator_exit(state,</span> <span style="color: #F8F8F2">slashed_index)</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a>    <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[slashed_index]</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a>    <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashed</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">True</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a>    <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">withdrawable_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">max(</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a>        <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">withdrawable_epoch,</span> <span style="color: #F8F8F2">Epoch(epoch</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">EPOCHS_PER_SLASHINGS_VECTOR)</span>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashings[epoch</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EPOCHS_PER_SLASHINGS_VECTOR]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a>    <span style="color: #F8F8F2">decrease_balance(</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">slashed_index,</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">MIN_SLASHING_PENALTY_QUOTIENT</span>
<a id="__codelineno-64-17" name="__codelineno-64-17"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-64-18" name="__codelineno-64-18"></a>
<a id="__codelineno-64-19" name="__codelineno-64-19"></a>    <span style="color: #959077"># Apply proposer and whistleblower rewards</span>
<a id="__codelineno-64-20" name="__codelineno-64-20"></a>    <span style="color: #F8F8F2">proposer_index</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_beacon_proposer_index(state)</span>
<a id="__codelineno-64-21" name="__codelineno-64-21"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">whistleblower_index</span> <span style="color: #FF4689">is</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-64-22" name="__codelineno-64-22"></a>        <span style="color: #F8F8F2">whistleblower_index</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">proposer_index</span>
<a id="__codelineno-64-23" name="__codelineno-64-23"></a>    <span style="color: #F8F8F2">whistleblower_reward</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Gwei(validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">WHISTLEBLOWER_REWARD_QUOTIENT)</span>
<a id="__codelineno-64-24" name="__codelineno-64-24"></a>    <span style="color: #F8F8F2">proposer_reward</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Gwei(whistleblower_reward</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">PROPOSER_REWARD_QUOTIENT)</span>
<a id="__codelineno-64-25" name="__codelineno-64-25"></a>    <span style="color: #F8F8F2">increase_balance(state,</span> <span style="color: #F8F8F2">proposer_index,</span> <span style="color: #F8F8F2">proposer_reward)</span>
<a id="__codelineno-64-26" name="__codelineno-64-26"></a>    <span style="color: #F8F8F2">increase_balance(state,</span> <span style="color: #F8F8F2">whistleblower_index,</span> <span style="color: #F8F8F2">Gwei(whistleblower_reward</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">proposer_reward))</span>
</code></pre></div></td></tr></table></div>
<h2 id="genesis">Genesis<a class="headerlink" href="#genesis" title="Permanent link">&para;</a></h2>
<p>Before the Ethereum beacon chain genesis has been triggered, and for every
Ethereum proof-of-work block, let
<code>candidate_state = initialize_beacon_state_from_eth1(eth1_block_hash, eth1_timestamp, deposits)</code>
where:</p>
<ul>
<li><code>eth1_block_hash</code> is the hash of the Ethereum proof-of-work block</li>
<li><code>eth1_timestamp</code> is the Unix timestamp corresponding to <code>eth1_block_hash</code></li>
<li><code>deposits</code> is the sequence of all deposits, ordered chronologically, up to
  (and including) the block with hash <code>eth1_block_hash</code></li>
</ul>
<p>Proof-of-work blocks must only be considered once they are at least
<code>SECONDS_PER_ETH1_BLOCK * ETH1_FOLLOW_DISTANCE</code> seconds old (i.e.
<code>eth1_timestamp + SECONDS_PER_ETH1_BLOCK * ETH1_FOLLOW_DISTANCE &lt;= current_unix_time</code>).
Due to this constraint, if
<code>GENESIS_DELAY &lt; SECONDS_PER_ETH1_BLOCK * ETH1_FOLLOW_DISTANCE</code>, then the
<code>genesis_time</code> can happen before the time/state is first known. Values should be
configured to avoid this case.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-24">24</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-25">25</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-26">26</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-27">27</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-28">28</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-29">29</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-30">30</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-31">31</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-32">32</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-33">33</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-34">34</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-35">35</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-36">36</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-37">37</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-65-38">38</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">initialize_beacon_state_from_eth1</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a>    <span style="color: #F8F8F2">eth1_block_hash:</span> <span style="color: #F8F8F2">Hash32,</span> <span style="color: #F8F8F2">eth1_timestamp:</span> <span style="color: #F8F8F2">uint64,</span> <span style="color: #F8F8F2">deposits:</span> <span style="color: #F8F8F2">Sequence[Deposit]</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">BeaconState:</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a>    <span style="color: #F8F8F2">fork</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Fork(</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a>        <span style="color: #F8F8F2">previous_version</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">GENESIS_FORK_VERSION,</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a>        <span style="color: #F8F8F2">current_version</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">GENESIS_FORK_VERSION,</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a>        <span style="color: #F8F8F2">epoch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">GENESIS_EPOCH,</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a>    <span style="color: #F8F8F2">state</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">BeaconState(</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a>        <span style="color: #F8F8F2">genesis_time</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">eth1_timestamp</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">GENESIS_DELAY,</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a>        <span style="color: #F8F8F2">fork</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">fork,</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a>        <span style="color: #F8F8F2">eth1_data</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">Eth1Data(block_hash</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">eth1_block_hash,</span> <span style="color: #F8F8F2">deposit_count</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">uint64(len(deposits))),</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a>        <span style="color: #F8F8F2">latest_block_header</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">BeaconBlockHeader(body_root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">hash_tree_root(BeaconBlockBody())),</span>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a>        <span style="color: #F8F8F2">randao_mixes</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">[eth1_block_hash]</span>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a>        <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">EPOCHS_PER_HISTORICAL_VECTOR,</span>  <span style="color: #959077"># Seed RANDAO with Eth1 entropy</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a>    <span style="color: #959077"># Process deposits</span>
<a id="__codelineno-65-19" name="__codelineno-65-19"></a>    <span style="color: #F8F8F2">leaves</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">list(map(</span><span style="color: #66D9EF">lambda</span> <span style="color: #F8F8F2">deposit:</span> <span style="color: #F8F8F2">deposit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data,</span> <span style="color: #F8F8F2">deposits))</span>
<a id="__codelineno-65-20" name="__codelineno-65-20"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">deposit</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(deposits):</span>
<a id="__codelineno-65-21" name="__codelineno-65-21"></a>        <span style="color: #F8F8F2">deposit_data_list</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">List[DepositData,</span> <span style="color: #AE81FF">2</span><span style="color: #FF4689">**</span><span style="color: #F8F8F2">DEPOSIT_CONTRACT_TREE_DEPTH](</span><span style="color: #FF4689">*</span><span style="color: #F8F8F2">leaves[:</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">])</span>
<a id="__codelineno-65-22" name="__codelineno-65-22"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">deposit_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash_tree_root(deposit_data_list)</span>
<a id="__codelineno-65-23" name="__codelineno-65-23"></a>        <span style="color: #F8F8F2">process_deposit(state,</span> <span style="color: #F8F8F2">deposit)</span>
<a id="__codelineno-65-24" name="__codelineno-65-24"></a>
<a id="__codelineno-65-25" name="__codelineno-65-25"></a>    <span style="color: #959077"># Process activations</span>
<a id="__codelineno-65-26" name="__codelineno-65-26"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators):</span>
<a id="__codelineno-65-27" name="__codelineno-65-27"></a>        <span style="color: #F8F8F2">balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">balances[index]</span>
<a id="__codelineno-65-28" name="__codelineno-65-28"></a>        <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">min(</span>
<a id="__codelineno-65-29" name="__codelineno-65-29"></a>            <span style="color: #F8F8F2">balance</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">balance</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EFFECTIVE_BALANCE_INCREMENT,</span> <span style="color: #F8F8F2">MAX_EFFECTIVE_BALANCE</span>
<a id="__codelineno-65-30" name="__codelineno-65-30"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-65-31" name="__codelineno-65-31"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">MAX_EFFECTIVE_BALANCE:</span>
<a id="__codelineno-65-32" name="__codelineno-65-32"></a>            <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_eligibility_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">GENESIS_EPOCH</span>
<a id="__codelineno-65-33" name="__codelineno-65-33"></a>            <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">GENESIS_EPOCH</span>
<a id="__codelineno-65-34" name="__codelineno-65-34"></a>
<a id="__codelineno-65-35" name="__codelineno-65-35"></a>    <span style="color: #959077"># Set genesis validators root for domain separation and chain versioning</span>
<a id="__codelineno-65-36" name="__codelineno-65-36"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">genesis_validators_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash_tree_root(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators)</span>
<a id="__codelineno-65-37" name="__codelineno-65-37"></a>
<a id="__codelineno-65-38" name="__codelineno-65-38"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">state</span>
</code></pre></div></td></tr></table></div>
<p><em>Note</em>: The ETH1 block with <code>eth1_timestamp</code> meeting the minimum genesis active
validator count criteria can also occur before <code>MIN_GENESIS_TIME</code>.</p>
<h3 id="genesis-state">Genesis state<a class="headerlink" href="#genesis-state" title="Permanent link">&para;</a></h3>
<p>Let <code>genesis_state = candidate_state</code> whenever
<code>is_valid_genesis_state(candidate_state) is True</code> for the first time.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-66-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-66-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-66-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-66-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-66-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-66-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_valid_genesis_state</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">genesis_time</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">MIN_GENESIS_TIME:</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a>        <span style="color: #66D9EF">return</span> <span style="color: #66D9EF">False</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">len(get_active_validator_indices(state,</span> <span style="color: #F8F8F2">GENESIS_EPOCH))</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">MIN_GENESIS_ACTIVE_VALIDATOR_COUNT:</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a>        <span style="color: #66D9EF">return</span> <span style="color: #66D9EF">False</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #66D9EF">True</span>
</code></pre></div></td></tr></table></div>
<h3 id="genesis-block">Genesis block<a class="headerlink" href="#genesis-block" title="Permanent link">&para;</a></h3>
<p>Let <code>genesis_block = BeaconBlock(state_root=hash_tree_root(genesis_state))</code>.</p>
<h2 id="beacon-chain-state-transition-function">Beacon chain state transition function<a class="headerlink" href="#beacon-chain-state-transition-function" title="Permanent link">&para;</a></h2>
<p>The post-state corresponding to a pre-state <code>state</code> and a signed block
<code>signed_block</code> is defined as <code>state_transition(state, signed_block)</code>. State
transitions that trigger an unhandled exception (e.g. a failed <code>assert</code> or an
out-of-range list access) are considered invalid. State transitions that cause a
<code>uint64</code> overflow or underflow are also considered invalid.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-67-14">14</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">state_transition</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">signed_block:</span> <span style="color: #F8F8F2">SignedBeaconBlock,</span> <span style="color: #F8F8F2">validate_result:</span> <span style="color: #F8F8F2">bool</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">True</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a>    <span style="color: #F8F8F2">block</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">signed_block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a>    <span style="color: #959077"># Process slots (including those with no blocks) since block</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a>    <span style="color: #F8F8F2">process_slots(state,</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot)</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a>    <span style="color: #959077"># Verify signature</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">validate_result:</span>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a>        <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">verify_block_signature(state,</span> <span style="color: #F8F8F2">signed_block)</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a>    <span style="color: #959077"># Process block</span>
<a id="__codelineno-67-11" name="__codelineno-67-11"></a>    <span style="color: #F8F8F2">process_block(state,</span> <span style="color: #F8F8F2">block)</span>
<a id="__codelineno-67-12" name="__codelineno-67-12"></a>    <span style="color: #959077"># Verify state root</span>
<a id="__codelineno-67-13" name="__codelineno-67-13"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">validate_result:</span>
<a id="__codelineno-67-14" name="__codelineno-67-14"></a>        <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">state_root</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">hash_tree_root(state)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-68-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-68-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-68-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-68-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-68-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-68-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">verify_block_signature</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">signed_block:</span> <span style="color: #F8F8F2">SignedBeaconBlock)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a>    <span style="color: #F8F8F2">proposer</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[signed_block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index]</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a>        <span style="color: #F8F8F2">signed_block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message,</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_BEACON_PROPOSER)</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Verify(proposer</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">pubkey,</span> <span style="color: #F8F8F2">signing_root,</span> <span style="color: #F8F8F2">signed_block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signature)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-69-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_slots</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">slot</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a>    <span style="color: #66D9EF">while</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">slot:</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a>        <span style="color: #F8F8F2">process_slot(state)</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a>        <span style="color: #959077"># Process epoch on the start slot of the next epoch</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH</span> <span style="color: #FF4689">==</span> <span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a>            <span style="color: #F8F8F2">process_epoch(state)</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Slot(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-70-10">10</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_slot</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a>    <span style="color: #959077"># Cache state root</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a>    <span style="color: #F8F8F2">previous_state_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash_tree_root(state)</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">state_roots[state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT]</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">previous_state_root</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a>    <span style="color: #959077"># Cache latest block header state root</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">latest_block_header</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">state_root</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">Bytes32():</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">latest_block_header</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">state_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">previous_state_root</span>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a>    <span style="color: #959077"># Cache block root</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a>    <span style="color: #F8F8F2">previous_block_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">hash_tree_root(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">latest_block_header)</span>
<a id="__codelineno-70-10" name="__codelineno-70-10"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">block_roots[state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">SLOTS_PER_HISTORICAL_ROOT]</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">previous_block_root</span>
</code></pre></div></td></tr></table></div>
<h3 id="epoch-processing">Epoch processing<a class="headerlink" href="#epoch-processing" title="Permanent link">&para;</a></h3>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-71-11">11</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_epoch</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a>    <span style="color: #F8F8F2">process_justification_and_finalization(state)</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a>    <span style="color: #F8F8F2">process_rewards_and_penalties(state)</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a>    <span style="color: #F8F8F2">process_registry_updates(state)</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a>    <span style="color: #F8F8F2">process_slashings(state)</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a>    <span style="color: #F8F8F2">process_eth1_data_reset(state)</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a>    <span style="color: #F8F8F2">process_effective_balance_updates(state)</span>
<a id="__codelineno-71-8" name="__codelineno-71-8"></a>    <span style="color: #F8F8F2">process_slashings_reset(state)</span>
<a id="__codelineno-71-9" name="__codelineno-71-9"></a>    <span style="color: #F8F8F2">process_randao_mixes_reset(state)</span>
<a id="__codelineno-71-10" name="__codelineno-71-10"></a>    <span style="color: #F8F8F2">process_historical_roots_update(state)</span>
<a id="__codelineno-71-11" name="__codelineno-71-11"></a>    <span style="color: #F8F8F2">process_participation_record_updates(state)</span>
</code></pre></div></td></tr></table></div>
<h4 id="helper-functions_1">Helper functions<a class="headerlink" href="#helper-functions_1" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-72-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_matching_source_attestations</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Sequence[PendingAttestation]:</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">(get_previous_epoch(state),</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_epoch_attestations</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a>        <span style="color: #66D9EF">else</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">previous_epoch_attestations</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-73-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_matching_target_attestations</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Sequence[PendingAttestation]:</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a>        <span style="color: #F8F8F2">a</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">a</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">get_matching_source_attestations(state,</span> <span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">a</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">root</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">get_block_root(state,</span> <span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a>    <span style="color: #F8F8F2">]</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-74-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_matching_head_attestations</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Sequence[PendingAttestation]:</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a>        <span style="color: #F8F8F2">a</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">a</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">get_matching_target_attestations(state,</span> <span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">a</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">beacon_block_root</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">get_block_root_at_slot(state,</span> <span style="color: #F8F8F2">a</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot)</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a>    <span style="color: #F8F8F2">]</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-75-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-75-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-75-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-75-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-75-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-75-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-75-7">7</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_unslashed_attesting_indices</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attestations:</span> <span style="color: #F8F8F2">Sequence[PendingAttestation]</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Set[ValidatorIndex]:</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a>    <span style="color: #F8F8F2">output:</span> <span style="color: #F8F8F2">Set[ValidatorIndex]</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">set()</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">a</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">attestations:</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a>        <span style="color: #F8F8F2">output</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">output</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">union(get_attesting_indices(state,</span> <span style="color: #F8F8F2">a))</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">set(filter(</span><span style="color: #66D9EF">lambda</span> <span style="color: #F8F8F2">index:</span> <span style="color: #FF4689">not</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index]</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashed,</span> <span style="color: #F8F8F2">output))</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-76-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-76-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-76-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-76-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-76-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-76-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_attesting_balance</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attestations:</span> <span style="color: #F8F8F2">Sequence[PendingAttestation])</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Gwei:</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span style="color: #E6DB74">    Return the combined effective balance of the set of unslashed validators participating in ``attestations``.</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span style="color: #E6DB74">    Note: ``get_total_balance`` returns ``EFFECTIVE_BALANCE_INCREMENT`` Gwei minimum to avoid divisions by zero.</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_total_balance(state,</span> <span style="color: #F8F8F2">get_unslashed_attesting_indices(state,</span> <span style="color: #F8F8F2">attestations))</span>
</code></pre></div></td></tr></table></div>
<h4 id="justification-and-finalization">Justification and finalization<a class="headerlink" href="#justification-and-finalization" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-77-13">13</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_justification_and_finalization</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a>    <span style="color: #959077"># Initial FFG checkpoint values have a `0x00` stub for `root`.</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a>    <span style="color: #959077"># Skip FFG updates in the first two epochs to avoid corner cases that might result in modifying this stub.</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">get_current_epoch(state)</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">GENESIS_EPOCH</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a>        <span style="color: #66D9EF">return</span>
<a id="__codelineno-77-6" name="__codelineno-77-6"></a>    <span style="color: #F8F8F2">previous_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_matching_target_attestations(state,</span> <span style="color: #F8F8F2">get_previous_epoch(state))</span>
<a id="__codelineno-77-7" name="__codelineno-77-7"></a>    <span style="color: #F8F8F2">current_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_matching_target_attestations(state,</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
<a id="__codelineno-77-8" name="__codelineno-77-8"></a>    <span style="color: #F8F8F2">total_active_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_total_active_balance(state)</span>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a>    <span style="color: #F8F8F2">previous_target_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_attesting_balance(state,</span> <span style="color: #F8F8F2">previous_attestations)</span>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a>    <span style="color: #F8F8F2">current_target_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_attesting_balance(state,</span> <span style="color: #F8F8F2">current_attestations)</span>
<a id="__codelineno-77-11" name="__codelineno-77-11"></a>    <span style="color: #F8F8F2">weigh_justification_and_finalization(</span>
<a id="__codelineno-77-12" name="__codelineno-77-12"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">total_active_balance,</span> <span style="color: #F8F8F2">previous_target_balance,</span> <span style="color: #F8F8F2">current_target_balance</span>
<a id="__codelineno-77-13" name="__codelineno-77-13"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-24">24</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-25">25</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-26">26</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-27">27</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-28">28</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-29">29</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-30">30</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-31">31</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-32">32</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-33">33</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-34">34</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-35">35</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-36">36</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-37">37</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-38">38</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-39">39</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-78-40">40</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">weigh_justification_and_finalization</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>    <span style="color: #F8F8F2">total_active_balance:</span> <span style="color: #F8F8F2">Gwei,</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a>    <span style="color: #F8F8F2">previous_epoch_target_balance:</span> <span style="color: #F8F8F2">Gwei,</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a>    <span style="color: #F8F8F2">current_epoch_target_balance:</span> <span style="color: #F8F8F2">Gwei,</span>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a>    <span style="color: #F8F8F2">previous_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_previous_epoch(state)</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a>    <span style="color: #F8F8F2">current_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a>    <span style="color: #F8F8F2">old_previous_justified_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">previous_justified_checkpoint</span>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a>    <span style="color: #F8F8F2">old_current_justified_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_justified_checkpoint</span>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a>    <span style="color: #959077"># Process justifications</span>
<a id="__codelineno-78-13" name="__codelineno-78-13"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">previous_justified_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_justified_checkpoint</span>
<a id="__codelineno-78-14" name="__codelineno-78-14"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">justification_bits[</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">:]</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">justification_bits[:</span> <span style="color: #F8F8F2">JUSTIFICATION_BITS_LENGTH</span> <span style="color: #FF4689">-</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span>
<a id="__codelineno-78-15" name="__codelineno-78-15"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">justification_bits[</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">]</span> <span style="color: #FF4689">=</span> <span style="color: #AE81FF">0b0</span>
<a id="__codelineno-78-16" name="__codelineno-78-16"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">previous_epoch_target_balance</span> <span style="color: #FF4689">*</span> <span style="color: #AE81FF">3</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">total_active_balance</span> <span style="color: #FF4689">*</span> <span style="color: #AE81FF">2</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-78-17" name="__codelineno-78-17"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_justified_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Checkpoint(</span>
<a id="__codelineno-78-18" name="__codelineno-78-18"></a>            <span style="color: #F8F8F2">epoch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">previous_epoch,</span> <span style="color: #F8F8F2">root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">get_block_root(state,</span> <span style="color: #F8F8F2">previous_epoch)</span>
<a id="__codelineno-78-19" name="__codelineno-78-19"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-78-20" name="__codelineno-78-20"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">justification_bits[</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span> <span style="color: #FF4689">=</span> <span style="color: #AE81FF">0b1</span>
<a id="__codelineno-78-21" name="__codelineno-78-21"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">current_epoch_target_balance</span> <span style="color: #FF4689">*</span> <span style="color: #AE81FF">3</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">total_active_balance</span> <span style="color: #FF4689">*</span> <span style="color: #AE81FF">2</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-78-22" name="__codelineno-78-22"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_justified_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Checkpoint(</span>
<a id="__codelineno-78-23" name="__codelineno-78-23"></a>            <span style="color: #F8F8F2">epoch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">current_epoch,</span> <span style="color: #F8F8F2">root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">get_block_root(state,</span> <span style="color: #F8F8F2">current_epoch)</span>
<a id="__codelineno-78-24" name="__codelineno-78-24"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-78-25" name="__codelineno-78-25"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">justification_bits[</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">]</span> <span style="color: #FF4689">=</span> <span style="color: #AE81FF">0b1</span>
<a id="__codelineno-78-26" name="__codelineno-78-26"></a>
<a id="__codelineno-78-27" name="__codelineno-78-27"></a>    <span style="color: #959077"># Process finalizations</span>
<a id="__codelineno-78-28" name="__codelineno-78-28"></a>    <span style="color: #F8F8F2">bits</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">justification_bits</span>
<a id="__codelineno-78-29" name="__codelineno-78-29"></a>    <span style="color: #959077"># The 2nd/3rd/4th most recent epochs are justified, the 2nd using the 4th as source</span>
<a id="__codelineno-78-30" name="__codelineno-78-30"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">all(bits[</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">:</span><span style="color: #AE81FF">4</span><span style="color: #F8F8F2">])</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">old_previous_justified_checkpoint</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">3</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">current_epoch:</span>
<a id="__codelineno-78-31" name="__codelineno-78-31"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">finalized_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">old_previous_justified_checkpoint</span>
<a id="__codelineno-78-32" name="__codelineno-78-32"></a>    <span style="color: #959077"># The 2nd/3rd most recent epochs are justified, the 2nd using the 3rd as source</span>
<a id="__codelineno-78-33" name="__codelineno-78-33"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">all(bits[</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">:</span><span style="color: #AE81FF">3</span><span style="color: #F8F8F2">])</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">old_previous_justified_checkpoint</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">2</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">current_epoch:</span>
<a id="__codelineno-78-34" name="__codelineno-78-34"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">finalized_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">old_previous_justified_checkpoint</span>
<a id="__codelineno-78-35" name="__codelineno-78-35"></a>    <span style="color: #959077"># The 1st/2nd/3rd most recent epochs are justified, the 1st using the 3rd as source</span>
<a id="__codelineno-78-36" name="__codelineno-78-36"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">all(bits[</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span><span style="color: #AE81FF">3</span><span style="color: #F8F8F2">])</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">old_current_justified_checkpoint</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">2</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">current_epoch:</span>
<a id="__codelineno-78-37" name="__codelineno-78-37"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">finalized_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">old_current_justified_checkpoint</span>
<a id="__codelineno-78-38" name="__codelineno-78-38"></a>    <span style="color: #959077"># The 1st/2nd most recent epochs are justified, the 1st using the 2nd as source</span>
<a id="__codelineno-78-39" name="__codelineno-78-39"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">all(bits[</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span><span style="color: #AE81FF">2</span><span style="color: #F8F8F2">])</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">old_current_justified_checkpoint</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">current_epoch:</span>
<a id="__codelineno-78-40" name="__codelineno-78-40"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">finalized_checkpoint</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">old_current_justified_checkpoint</span>
</code></pre></div></td></tr></table></div>
<h4 id="rewards-and-penalties_1">Rewards and penalties<a class="headerlink" href="#rewards-and-penalties_1" title="Permanent link">&para;</a></h4>
<h5 id="helpers">Helpers<a class="headerlink" href="#helpers" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-79-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_base_reward</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">ValidatorIndex)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Gwei:</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a>    <span style="color: #F8F8F2">total_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_total_active_balance(state)</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a>    <span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index]</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Gwei(</span>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a>        <span style="color: #F8F8F2">effective_balance</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a>        <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">BASE_REWARD_FACTOR</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a>        <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">integer_squareroot(total_balance)</span>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a>        <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">BASE_REWARDS_PER_EPOCH</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-80-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-80-2">2</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_proposer_reward</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attesting_index:</span> <span style="color: #F8F8F2">ValidatorIndex)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Gwei:</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Gwei(get_base_reward(state,</span> <span style="color: #F8F8F2">attesting_index)</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">PROPOSER_REWARD_QUOTIENT)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-81-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-81-2">2</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_finality_delay</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_previous_epoch(state)</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">finalized_checkpoint</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-82-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-82-2">2</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_in_inactivity_leak</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_finality_delay(state)</span> <span style="color: #FF4689">&gt;</span> <span style="color: #F8F8F2">MIN_EPOCHS_TO_INACTIVITY_PENALTY</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-83-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_eligible_validator_indices</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Sequence[ValidatorIndex]:</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a>    <span style="color: #F8F8F2">previous_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_previous_epoch(state)</span>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a>        <span style="color: #F8F8F2">ValidatorIndex(index)</span>
<a id="__codelineno-83-5" name="__codelineno-83-5"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">v</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators)</span>
<a id="__codelineno-83-6" name="__codelineno-83-6"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">is_active_validator(v,</span> <span style="color: #F8F8F2">previous_epoch)</span>
<a id="__codelineno-83-7" name="__codelineno-83-7"></a>        <span style="color: #FF4689">or</span> <span style="color: #F8F8F2">(v</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashed</span> <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">previous_epoch</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">v</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">withdrawable_epoch)</span>
<a id="__codelineno-83-8" name="__codelineno-83-8"></a>    <span style="color: #F8F8F2">]</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-84-24">24</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_attestation_component_deltas</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attestations:</span> <span style="color: #F8F8F2">Sequence[PendingAttestation]</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Tuple[Sequence[Gwei],</span> <span style="color: #F8F8F2">Sequence[Gwei]]:</span>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><span style="color: #E6DB74">    Helper with shared logic for use by get source, target, and head deltas functions</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a>    <span style="color: #F8F8F2">rewards</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[Gwei(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)]</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators)</span>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a>    <span style="color: #F8F8F2">penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[Gwei(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)]</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators)</span>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a>    <span style="color: #F8F8F2">total_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_total_active_balance(state)</span>
<a id="__codelineno-84-10" name="__codelineno-84-10"></a>    <span style="color: #F8F8F2">unslashed_attesting_indices</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_unslashed_attesting_indices(state,</span> <span style="color: #F8F8F2">attestations)</span>
<a id="__codelineno-84-11" name="__codelineno-84-11"></a>    <span style="color: #F8F8F2">attesting_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_total_balance(state,</span> <span style="color: #F8F8F2">unslashed_attesting_indices)</span>
<a id="__codelineno-84-12" name="__codelineno-84-12"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">get_eligible_validator_indices(state):</span>
<a id="__codelineno-84-13" name="__codelineno-84-13"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">unslashed_attesting_indices:</span>
<a id="__codelineno-84-14" name="__codelineno-84-14"></a>            <span style="color: #F8F8F2">increment</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">EFFECTIVE_BALANCE_INCREMENT</span>  <span style="color: #959077"># Factored out from balance totals to avoid uint64 overflow</span>
<a id="__codelineno-84-15" name="__codelineno-84-15"></a>            <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">is_in_inactivity_leak(state):</span>
<a id="__codelineno-84-16" name="__codelineno-84-16"></a>                <span style="color: #959077"># Since full base reward will be canceled out by inactivity penalty deltas,</span>
<a id="__codelineno-84-17" name="__codelineno-84-17"></a>                <span style="color: #959077"># optimal participation receives full base reward compensation here.</span>
<a id="__codelineno-84-18" name="__codelineno-84-18"></a>                <span style="color: #F8F8F2">rewards[index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">get_base_reward(state,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-84-19" name="__codelineno-84-19"></a>            <span style="color: #66D9EF">else</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-84-20" name="__codelineno-84-20"></a>                <span style="color: #F8F8F2">reward_numerator</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_base_reward(state,</span> <span style="color: #F8F8F2">index)</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">(attesting_balance</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">increment)</span>
<a id="__codelineno-84-21" name="__codelineno-84-21"></a>                <span style="color: #F8F8F2">rewards[index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">reward_numerator</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">(total_balance</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">increment)</span>
<a id="__codelineno-84-22" name="__codelineno-84-22"></a>        <span style="color: #66D9EF">else</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-84-23" name="__codelineno-84-23"></a>            <span style="color: #F8F8F2">penalties[index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">get_base_reward(state,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-84-24" name="__codelineno-84-24"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">rewards,</span> <span style="color: #F8F8F2">penalties</span>
</code></pre></div></td></tr></table></div>
<h5 id="components-of-attestation-deltas">Components of attestation deltas<a class="headerlink" href="#components-of-attestation-deltas" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-85-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_source_deltas</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Tuple[Sequence[Gwei],</span> <span style="color: #F8F8F2">Sequence[Gwei]]:</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a><span style="color: #E6DB74">    Return attester micro-rewards/penalties for source-vote for each validator.</span>
<a id="__codelineno-85-4" name="__codelineno-85-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-85-5" name="__codelineno-85-5"></a>    <span style="color: #F8F8F2">matching_source_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_matching_source_attestations(</span>
<a id="__codelineno-85-6" name="__codelineno-85-6"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">get_previous_epoch(state)</span>
<a id="__codelineno-85-7" name="__codelineno-85-7"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-85-8" name="__codelineno-85-8"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_attestation_component_deltas(state,</span> <span style="color: #F8F8F2">matching_source_attestations)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-86-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_target_deltas</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Tuple[Sequence[Gwei],</span> <span style="color: #F8F8F2">Sequence[Gwei]]:</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a><span style="color: #E6DB74">    Return attester micro-rewards/penalties for target-vote for each validator.</span>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-86-5" name="__codelineno-86-5"></a>    <span style="color: #F8F8F2">matching_target_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_matching_target_attestations(</span>
<a id="__codelineno-86-6" name="__codelineno-86-6"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">get_previous_epoch(state)</span>
<a id="__codelineno-86-7" name="__codelineno-86-7"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-86-8" name="__codelineno-86-8"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_attestation_component_deltas(state,</span> <span style="color: #F8F8F2">matching_target_attestations)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-87-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-87-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-87-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-87-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-87-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-87-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_head_deltas</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Tuple[Sequence[Gwei],</span> <span style="color: #F8F8F2">Sequence[Gwei]]:</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a><span style="color: #E6DB74">    Return attester micro-rewards/penalties for head-vote for each validator.</span>
<a id="__codelineno-87-4" name="__codelineno-87-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-87-5" name="__codelineno-87-5"></a>    <span style="color: #F8F8F2">matching_head_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_matching_head_attestations(state,</span> <span style="color: #F8F8F2">get_previous_epoch(state))</span>
<a id="__codelineno-87-6" name="__codelineno-87-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_attestation_component_deltas(state,</span> <span style="color: #F8F8F2">matching_head_attestations)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-88-22">22</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_inclusion_delay_deltas</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Tuple[Sequence[Gwei],</span> <span style="color: #F8F8F2">Sequence[Gwei]]:</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span style="color: #E6DB74">    Return proposer and inclusion delay micro-rewards/penalties for each validator.</span>
<a id="__codelineno-88-4" name="__codelineno-88-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-88-5" name="__codelineno-88-5"></a>    <span style="color: #F8F8F2">rewards</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[Gwei(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">_</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators))]</span>
<a id="__codelineno-88-6" name="__codelineno-88-6"></a>    <span style="color: #F8F8F2">matching_source_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_matching_source_attestations(</span>
<a id="__codelineno-88-7" name="__codelineno-88-7"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">get_previous_epoch(state)</span>
<a id="__codelineno-88-8" name="__codelineno-88-8"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-88-9" name="__codelineno-88-9"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">get_unslashed_attesting_indices(state,</span> <span style="color: #F8F8F2">matching_source_attestations):</span>
<a id="__codelineno-88-10" name="__codelineno-88-10"></a>        <span style="color: #F8F8F2">attestation</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">min(</span>
<a id="__codelineno-88-11" name="__codelineno-88-11"></a>            <span style="color: #F8F8F2">[a</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">a</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">matching_source_attestations</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">get_attesting_indices(state,</span> <span style="color: #F8F8F2">a)],</span>
<a id="__codelineno-88-12" name="__codelineno-88-12"></a>            <span style="color: #F8F8F2">key</span><span style="color: #FF4689">=</span><span style="color: #66D9EF">lambda</span> <span style="color: #F8F8F2">a:</span> <span style="color: #F8F8F2">a</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">inclusion_delay,</span>
<a id="__codelineno-88-13" name="__codelineno-88-13"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-88-14" name="__codelineno-88-14"></a>        <span style="color: #F8F8F2">rewards[attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">get_proposer_reward(state,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-88-15" name="__codelineno-88-15"></a>        <span style="color: #F8F8F2">max_attester_reward</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Gwei(</span>
<a id="__codelineno-88-16" name="__codelineno-88-16"></a>            <span style="color: #F8F8F2">get_base_reward(state,</span> <span style="color: #F8F8F2">index)</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">get_proposer_reward(state,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-88-17" name="__codelineno-88-17"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-88-18" name="__codelineno-88-18"></a>        <span style="color: #F8F8F2">rewards[index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">Gwei(max_attester_reward</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">inclusion_delay)</span>
<a id="__codelineno-88-19" name="__codelineno-88-19"></a>
<a id="__codelineno-88-20" name="__codelineno-88-20"></a>    <span style="color: #959077"># No penalties associated with inclusion delay</span>
<a id="__codelineno-88-21" name="__codelineno-88-21"></a>    <span style="color: #F8F8F2">penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[Gwei(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">_</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators))]</span>
<a id="__codelineno-88-22" name="__codelineno-88-22"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">rewards,</span> <span style="color: #F8F8F2">penalties</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-24">24</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-25">25</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-26">26</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-89-27">27</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_inactivity_penalty_deltas</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Tuple[Sequence[Gwei],</span> <span style="color: #F8F8F2">Sequence[Gwei]]:</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a><span style="color: #E6DB74">    Return inactivity reward/penalty deltas for each validator.</span>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a>    <span style="color: #F8F8F2">penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[Gwei(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">_</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators))]</span>
<a id="__codelineno-89-6" name="__codelineno-89-6"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">is_in_inactivity_leak(state):</span>
<a id="__codelineno-89-7" name="__codelineno-89-7"></a>        <span style="color: #F8F8F2">matching_target_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_matching_target_attestations(</span>
<a id="__codelineno-89-8" name="__codelineno-89-8"></a>            <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">get_previous_epoch(state)</span>
<a id="__codelineno-89-9" name="__codelineno-89-9"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-89-10" name="__codelineno-89-10"></a>        <span style="color: #F8F8F2">matching_target_attesting_indices</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_unslashed_attesting_indices(</span>
<a id="__codelineno-89-11" name="__codelineno-89-11"></a>            <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">matching_target_attestations</span>
<a id="__codelineno-89-12" name="__codelineno-89-12"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-89-13" name="__codelineno-89-13"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">get_eligible_validator_indices(state):</span>
<a id="__codelineno-89-14" name="__codelineno-89-14"></a>            <span style="color: #959077"># If validator is performing optimally this cancels all rewards for a neutral balance</span>
<a id="__codelineno-89-15" name="__codelineno-89-15"></a>            <span style="color: #F8F8F2">base_reward</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_base_reward(state,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-89-16" name="__codelineno-89-16"></a>            <span style="color: #F8F8F2">penalties[index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">Gwei(</span>
<a id="__codelineno-89-17" name="__codelineno-89-17"></a>                <span style="color: #F8F8F2">BASE_REWARDS_PER_EPOCH</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">base_reward</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">get_proposer_reward(state,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-89-18" name="__codelineno-89-18"></a>            <span style="color: #F8F8F2">)</span>
<a id="__codelineno-89-19" name="__codelineno-89-19"></a>            <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">not</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">matching_target_attesting_indices:</span>
<a id="__codelineno-89-20" name="__codelineno-89-20"></a>                <span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index]</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span>
<a id="__codelineno-89-21" name="__codelineno-89-21"></a>                <span style="color: #F8F8F2">penalties[index]</span> <span style="color: #FF4689">+=</span> <span style="color: #F8F8F2">Gwei(</span>
<a id="__codelineno-89-22" name="__codelineno-89-22"></a>                    <span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">get_finality_delay(state)</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">INACTIVITY_PENALTY_QUOTIENT</span>
<a id="__codelineno-89-23" name="__codelineno-89-23"></a>                <span style="color: #F8F8F2">)</span>
<a id="__codelineno-89-24" name="__codelineno-89-24"></a>
<a id="__codelineno-89-25" name="__codelineno-89-25"></a>    <span style="color: #959077"># No rewards associated with inactivity penalties</span>
<a id="__codelineno-89-26" name="__codelineno-89-26"></a>    <span style="color: #F8F8F2">rewards</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[Gwei(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">_</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators))]</span>
<a id="__codelineno-89-27" name="__codelineno-89-27"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">rewards,</span> <span style="color: #F8F8F2">penalties</span>
</code></pre></div></td></tr></table></div>
<h5 id="get_attestation_deltas"><code>get_attestation_deltas</code><a class="headerlink" href="#get_attestation_deltas" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-90-21">21</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_attestation_deltas</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Tuple[Sequence[Gwei],</span> <span style="color: #F8F8F2">Sequence[Gwei]]:</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a><span style="color: #E6DB74">    Return attestation reward/penalty deltas for each validator.</span>
<a id="__codelineno-90-4" name="__codelineno-90-4"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-90-5" name="__codelineno-90-5"></a>    <span style="color: #F8F8F2">source_rewards,</span> <span style="color: #F8F8F2">source_penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_source_deltas(state)</span>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a>    <span style="color: #F8F8F2">target_rewards,</span> <span style="color: #F8F8F2">target_penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_target_deltas(state)</span>
<a id="__codelineno-90-7" name="__codelineno-90-7"></a>    <span style="color: #F8F8F2">head_rewards,</span> <span style="color: #F8F8F2">head_penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_head_deltas(state)</span>
<a id="__codelineno-90-8" name="__codelineno-90-8"></a>    <span style="color: #F8F8F2">inclusion_delay_rewards,</span> <span style="color: #F8F8F2">_</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_inclusion_delay_deltas(state)</span>
<a id="__codelineno-90-9" name="__codelineno-90-9"></a>    <span style="color: #F8F8F2">_,</span> <span style="color: #F8F8F2">inactivity_penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_inactivity_penalty_deltas(state)</span>
<a id="__codelineno-90-10" name="__codelineno-90-10"></a>
<a id="__codelineno-90-11" name="__codelineno-90-11"></a>    <span style="color: #F8F8F2">rewards</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-90-12" name="__codelineno-90-12"></a>        <span style="color: #F8F8F2">source_rewards[i]</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">target_rewards[i]</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">head_rewards[i]</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">inclusion_delay_rewards[i]</span>
<a id="__codelineno-90-13" name="__codelineno-90-13"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">i</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators))</span>
<a id="__codelineno-90-14" name="__codelineno-90-14"></a>    <span style="color: #F8F8F2">]</span>
<a id="__codelineno-90-15" name="__codelineno-90-15"></a>
<a id="__codelineno-90-16" name="__codelineno-90-16"></a>    <span style="color: #F8F8F2">penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-90-17" name="__codelineno-90-17"></a>        <span style="color: #F8F8F2">source_penalties[i]</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">target_penalties[i]</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">head_penalties[i]</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">inactivity_penalties[i]</span>
<a id="__codelineno-90-18" name="__codelineno-90-18"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">i</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators))</span>
<a id="__codelineno-90-19" name="__codelineno-90-19"></a>    <span style="color: #F8F8F2">]</span>
<a id="__codelineno-90-20" name="__codelineno-90-20"></a>
<a id="__codelineno-90-21" name="__codelineno-90-21"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">rewards,</span> <span style="color: #F8F8F2">penalties</span>
</code></pre></div></td></tr></table></div>
<h5 id="process_rewards_and_penalties"><code>process_rewards_and_penalties</code><a class="headerlink" href="#process_rewards_and_penalties" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-91-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_rewards_and_penalties</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a>    <span style="color: #959077"># No rewards are applied at the end of `GENESIS_EPOCH` because rewards are for work done in the previous epoch</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">get_current_epoch(state)</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">GENESIS_EPOCH:</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a>        <span style="color: #66D9EF">return</span>
<a id="__codelineno-91-5" name="__codelineno-91-5"></a>
<a id="__codelineno-91-6" name="__codelineno-91-6"></a>    <span style="color: #F8F8F2">rewards,</span> <span style="color: #F8F8F2">penalties</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_attestation_deltas(state)</span>
<a id="__codelineno-91-7" name="__codelineno-91-7"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(len(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators)):</span>
<a id="__codelineno-91-8" name="__codelineno-91-8"></a>        <span style="color: #F8F8F2">increase_balance(state,</span> <span style="color: #F8F8F2">ValidatorIndex(index),</span> <span style="color: #F8F8F2">rewards[index])</span>
<a id="__codelineno-91-9" name="__codelineno-91-9"></a>        <span style="color: #F8F8F2">decrease_balance(state,</span> <span style="color: #F8F8F2">ValidatorIndex(index),</span> <span style="color: #F8F8F2">penalties[index])</span>
</code></pre></div></td></tr></table></div>
<h4 id="registry-updates">Registry updates<a class="headerlink" href="#registry-updates" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-24">24</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-25">25</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-92-26">26</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_registry_updates</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a>    <span style="color: #959077"># Process activation eligibility and ejections</span>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators):</span>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">is_eligible_for_activation_queue(validator):</span>
<a id="__codelineno-92-5" name="__codelineno-92-5"></a>            <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_eligibility_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span>
<a id="__codelineno-92-6" name="__codelineno-92-6"></a>
<a id="__codelineno-92-7" name="__codelineno-92-7"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-92-8" name="__codelineno-92-8"></a>            <span style="color: #F8F8F2">is_active_validator(validator,</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
<a id="__codelineno-92-9" name="__codelineno-92-9"></a>            <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">EJECTION_BALANCE</span>
<a id="__codelineno-92-10" name="__codelineno-92-10"></a>        <span style="color: #F8F8F2">):</span>
<a id="__codelineno-92-11" name="__codelineno-92-11"></a>            <span style="color: #F8F8F2">initiate_validator_exit(state,</span> <span style="color: #F8F8F2">ValidatorIndex(index))</span>
<a id="__codelineno-92-12" name="__codelineno-92-12"></a>
<a id="__codelineno-92-13" name="__codelineno-92-13"></a>    <span style="color: #959077"># Queue validators eligible for activation and not yet dequeued for activation</span>
<a id="__codelineno-92-14" name="__codelineno-92-14"></a>    <span style="color: #F8F8F2">activation_queue</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">sorted(</span>
<a id="__codelineno-92-15" name="__codelineno-92-15"></a>        <span style="color: #F8F8F2">[</span>
<a id="__codelineno-92-16" name="__codelineno-92-16"></a>            <span style="color: #F8F8F2">index</span>
<a id="__codelineno-92-17" name="__codelineno-92-17"></a>            <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators)</span>
<a id="__codelineno-92-18" name="__codelineno-92-18"></a>            <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">is_eligible_for_activation(state,</span> <span style="color: #F8F8F2">validator)</span>
<a id="__codelineno-92-19" name="__codelineno-92-19"></a>        <span style="color: #F8F8F2">],</span>
<a id="__codelineno-92-20" name="__codelineno-92-20"></a>        <span style="color: #959077"># Order by the sequence of activation_eligibility_epoch setting and then index</span>
<a id="__codelineno-92-21" name="__codelineno-92-21"></a>        <span style="color: #F8F8F2">key</span><span style="color: #FF4689">=</span><span style="color: #66D9EF">lambda</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index]</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_eligibility_epoch,</span> <span style="color: #F8F8F2">index),</span>
<a id="__codelineno-92-22" name="__codelineno-92-22"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-92-23" name="__codelineno-92-23"></a>    <span style="color: #959077"># Dequeued validators for activation up to churn limit</span>
<a id="__codelineno-92-24" name="__codelineno-92-24"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">activation_queue[:</span> <span style="color: #F8F8F2">get_validator_churn_limit(state)]:</span>
<a id="__codelineno-92-25" name="__codelineno-92-25"></a>        <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index]</span>
<a id="__codelineno-92-26" name="__codelineno-92-26"></a>        <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_activation_exit_epoch(get_current_epoch(state))</span>
</code></pre></div></td></tr></table></div>
<h4 id="slashings">Slashings<a class="headerlink" href="#slashings" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-93-17">17</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_slashings</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a>    <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-93-3" name="__codelineno-93-3"></a>    <span style="color: #F8F8F2">total_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_total_active_balance(state)</span>
<a id="__codelineno-93-4" name="__codelineno-93-4"></a>    <span style="color: #F8F8F2">adjusted_total_slashing_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">min(</span>
<a id="__codelineno-93-5" name="__codelineno-93-5"></a>        <span style="color: #F8F8F2">sum(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashings)</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">PROPORTIONAL_SLASHING_MULTIPLIER,</span> <span style="color: #F8F8F2">total_balance</span>
<a id="__codelineno-93-6" name="__codelineno-93-6"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-93-7" name="__codelineno-93-7"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators):</span>
<a id="__codelineno-93-8" name="__codelineno-93-8"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-93-9" name="__codelineno-93-9"></a>            <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashed</span>
<a id="__codelineno-93-10" name="__codelineno-93-10"></a>            <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">EPOCHS_PER_SLASHINGS_VECTOR</span> <span style="color: #FF4689">//</span> <span style="color: #AE81FF">2</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">withdrawable_epoch</span>
<a id="__codelineno-93-11" name="__codelineno-93-11"></a>        <span style="color: #F8F8F2">):</span>
<a id="__codelineno-93-12" name="__codelineno-93-12"></a>            <span style="color: #F8F8F2">increment</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">EFFECTIVE_BALANCE_INCREMENT</span>  <span style="color: #959077"># Factored out from penalty numerator to avoid uint64 overflow</span>
<a id="__codelineno-93-13" name="__codelineno-93-13"></a>            <span style="color: #F8F8F2">penalty_numerator</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-93-14" name="__codelineno-93-14"></a>                <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">increment</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">adjusted_total_slashing_balance</span>
<a id="__codelineno-93-15" name="__codelineno-93-15"></a>            <span style="color: #F8F8F2">)</span>
<a id="__codelineno-93-16" name="__codelineno-93-16"></a>            <span style="color: #F8F8F2">penalty</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">penalty_numerator</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">total_balance</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">increment</span>
<a id="__codelineno-93-17" name="__codelineno-93-17"></a>            <span style="color: #F8F8F2">decrease_balance(state,</span> <span style="color: #F8F8F2">ValidatorIndex(index),</span> <span style="color: #F8F8F2">penalty)</span>
</code></pre></div></td></tr></table></div>
<h4 id="eth1-data-votes-updates">Eth1 data votes updates<a class="headerlink" href="#eth1-data-votes-updates" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-94-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-94-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-94-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-94-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-94-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_eth1_data_reset</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a>    <span style="color: #F8F8F2">next_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Epoch(get_current_epoch(state)</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-94-3" name="__codelineno-94-3"></a>    <span style="color: #959077"># Reset eth1 data votes</span>
<a id="__codelineno-94-4" name="__codelineno-94-4"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">next_epoch</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EPOCHS_PER_ETH1_VOTING_PERIOD</span> <span style="color: #FF4689">==</span> <span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-94-5" name="__codelineno-94-5"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data_votes</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[]</span>
</code></pre></div></td></tr></table></div>
<h4 id="effective-balances-updates">Effective balances updates<a class="headerlink" href="#effective-balances-updates" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-95-14">14</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_effective_balance_updates</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a>    <span style="color: #959077"># Update effective balances with hysteresis</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">enumerate(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators):</span>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a>        <span style="color: #F8F8F2">balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">balances[index]</span>
<a id="__codelineno-95-5" name="__codelineno-95-5"></a>        <span style="color: #F8F8F2">HYSTERESIS_INCREMENT</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">uint64(EFFECTIVE_BALANCE_INCREMENT</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">HYSTERESIS_QUOTIENT)</span>
<a id="__codelineno-95-6" name="__codelineno-95-6"></a>        <span style="color: #F8F8F2">DOWNWARD_THRESHOLD</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">HYSTERESIS_INCREMENT</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">HYSTERESIS_DOWNWARD_MULTIPLIER</span>
<a id="__codelineno-95-7" name="__codelineno-95-7"></a>        <span style="color: #F8F8F2">UPWARD_THRESHOLD</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">HYSTERESIS_INCREMENT</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">HYSTERESIS_UPWARD_MULTIPLIER</span>
<a id="__codelineno-95-8" name="__codelineno-95-8"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-95-9" name="__codelineno-95-9"></a>            <span style="color: #F8F8F2">balance</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">DOWNWARD_THRESHOLD</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span>
<a id="__codelineno-95-10" name="__codelineno-95-10"></a>            <span style="color: #FF4689">or</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">UPWARD_THRESHOLD</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">balance</span>
<a id="__codelineno-95-11" name="__codelineno-95-11"></a>        <span style="color: #F8F8F2">):</span>
<a id="__codelineno-95-12" name="__codelineno-95-12"></a>            <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">min(</span>
<a id="__codelineno-95-13" name="__codelineno-95-13"></a>                <span style="color: #F8F8F2">balance</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">balance</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EFFECTIVE_BALANCE_INCREMENT,</span> <span style="color: #F8F8F2">MAX_EFFECTIVE_BALANCE</span>
<a id="__codelineno-95-14" name="__codelineno-95-14"></a>            <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="slashings-balances-updates">Slashings balances updates<a class="headerlink" href="#slashings-balances-updates" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-96-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-96-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-96-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-96-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_slashings_reset</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a>    <span style="color: #F8F8F2">next_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Epoch(get_current_epoch(state)</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a>    <span style="color: #959077"># Reset slashings</span>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashings[next_epoch</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EPOCHS_PER_SLASHINGS_VECTOR]</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Gwei(</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="randao-mixes-updates">Randao mixes updates<a class="headerlink" href="#randao-mixes-updates" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-97-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-97-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-97-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-97-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-97-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-97-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-97-7">7</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_randao_mixes_reset</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a>    <span style="color: #F8F8F2">current_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-97-3" name="__codelineno-97-3"></a>    <span style="color: #F8F8F2">next_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Epoch(current_epoch</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-97-4" name="__codelineno-97-4"></a>    <span style="color: #959077"># Set randao mix</span>
<a id="__codelineno-97-5" name="__codelineno-97-5"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">randao_mixes[next_epoch</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EPOCHS_PER_HISTORICAL_VECTOR]</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_randao_mix(</span>
<a id="__codelineno-97-6" name="__codelineno-97-6"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">current_epoch</span>
<a id="__codelineno-97-7" name="__codelineno-97-7"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="historical-roots-updates">Historical roots updates<a class="headerlink" href="#historical-roots-updates" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-98-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_historical_roots_update</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a>    <span style="color: #959077"># Set historical root accumulator</span>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a>    <span style="color: #F8F8F2">next_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Epoch(get_current_epoch(state)</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">next_epoch</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">(SLOTS_PER_HISTORICAL_ROOT</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH)</span> <span style="color: #FF4689">==</span> <span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a>        <span style="color: #F8F8F2">historical_batch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">HistoricalBatch(</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a>            <span style="color: #F8F8F2">block_roots</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">block_roots,</span> <span style="color: #F8F8F2">state_roots</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">state_roots</span>
<a id="__codelineno-98-7" name="__codelineno-98-7"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-98-8" name="__codelineno-98-8"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">historical_roots</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">append(hash_tree_root(historical_batch))</span>
</code></pre></div></td></tr></table></div>
<h4 id="participation-records-rotation">Participation records rotation<a class="headerlink" href="#participation-records-rotation" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-99-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-99-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-99-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-99-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_participation_record_updates</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a>    <span style="color: #959077"># Rotate current/previous epoch attestations</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">previous_epoch_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_epoch_attestations</span>
<a id="__codelineno-99-4" name="__codelineno-99-4"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_epoch_attestations</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[]</span>
</code></pre></div></td></tr></table></div>
<h3 id="block-processing">Block processing<a class="headerlink" href="#block-processing" title="Permanent link">&para;</a></h3>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-100-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-100-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-100-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-100-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-100-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_block</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">block:</span> <span style="color: #F8F8F2">BeaconBlock)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a>    <span style="color: #F8F8F2">process_block_header(state,</span> <span style="color: #F8F8F2">block)</span>
<a id="__codelineno-100-3" name="__codelineno-100-3"></a>    <span style="color: #F8F8F2">process_randao(state,</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">body)</span>
<a id="__codelineno-100-4" name="__codelineno-100-4"></a>    <span style="color: #F8F8F2">process_eth1_data(state,</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">body)</span>
<a id="__codelineno-100-5" name="__codelineno-100-5"></a>    <span style="color: #F8F8F2">process_operations(state,</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">body)</span>
</code></pre></div></td></tr></table></div>
<h4 id="block-header">Block header<a class="headerlink" href="#block-header" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-101-21">21</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_block_header</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">block:</span> <span style="color: #F8F8F2">BeaconBlock)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a>    <span style="color: #959077"># Verify that the slots match</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a>    <span style="color: #959077"># Verify that the block is newer than latest block header</span>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">&gt;</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">latest_block_header</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span>
<a id="__codelineno-101-6" name="__codelineno-101-6"></a>    <span style="color: #959077"># Verify that proposer index is the correct index</span>
<a id="__codelineno-101-7" name="__codelineno-101-7"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">get_beacon_proposer_index(state)</span>
<a id="__codelineno-101-8" name="__codelineno-101-8"></a>    <span style="color: #959077"># Verify that the parent matches</span>
<a id="__codelineno-101-9" name="__codelineno-101-9"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">parent_root</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">hash_tree_root(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">latest_block_header)</span>
<a id="__codelineno-101-10" name="__codelineno-101-10"></a>    <span style="color: #959077"># Cache current block as the new latest block</span>
<a id="__codelineno-101-11" name="__codelineno-101-11"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">latest_block_header</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">BeaconBlockHeader(</span>
<a id="__codelineno-101-12" name="__codelineno-101-12"></a>        <span style="color: #F8F8F2">slot</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot,</span>
<a id="__codelineno-101-13" name="__codelineno-101-13"></a>        <span style="color: #F8F8F2">proposer_index</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index,</span>
<a id="__codelineno-101-14" name="__codelineno-101-14"></a>        <span style="color: #F8F8F2">parent_root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">parent_root,</span>
<a id="__codelineno-101-15" name="__codelineno-101-15"></a>        <span style="color: #F8F8F2">state_root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">Bytes32(),</span>  <span style="color: #959077"># Overwritten in the next process_slot call</span>
<a id="__codelineno-101-16" name="__codelineno-101-16"></a>        <span style="color: #F8F8F2">body_root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">hash_tree_root(block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">body),</span>
<a id="__codelineno-101-17" name="__codelineno-101-17"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-101-18" name="__codelineno-101-18"></a>
<a id="__codelineno-101-19" name="__codelineno-101-19"></a>    <span style="color: #959077"># Verify proposer is not slashed</span>
<a id="__codelineno-101-20" name="__codelineno-101-20"></a>    <span style="color: #F8F8F2">proposer</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index]</span>
<a id="__codelineno-101-21" name="__codelineno-101-21"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #FF4689">not</span> <span style="color: #F8F8F2">proposer</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slashed</span>
</code></pre></div></td></tr></table></div>
<h4 id="randao">RANDAO<a class="headerlink" href="#randao" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-102-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_randao</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">body:</span> <span style="color: #F8F8F2">BeaconBlockBody)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a>    <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_current_epoch(state)</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a>    <span style="color: #959077"># Verify RANDAO reveal</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a>    <span style="color: #F8F8F2">proposer</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[get_beacon_proposer_index(state)]</span>
<a id="__codelineno-102-5" name="__codelineno-102-5"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(epoch,</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_RANDAO))</span>
<a id="__codelineno-102-6" name="__codelineno-102-6"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Verify(proposer</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">pubkey,</span> <span style="color: #F8F8F2">signing_root,</span> <span style="color: #F8F8F2">body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">randao_reveal)</span>
<a id="__codelineno-102-7" name="__codelineno-102-7"></a>    <span style="color: #959077"># Mix in RANDAO reveal</span>
<a id="__codelineno-102-8" name="__codelineno-102-8"></a>    <span style="color: #F8F8F2">mix</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">xor(get_randao_mix(state,</span> <span style="color: #F8F8F2">epoch),</span> <span style="color: #F8F8F2">hash(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">randao_reveal))</span>
<a id="__codelineno-102-9" name="__codelineno-102-9"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">randao_mixes[epoch</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EPOCHS_PER_HISTORICAL_VECTOR]</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">mix</span>
</code></pre></div></td></tr></table></div>
<h4 id="eth1-data">Eth1 data<a class="headerlink" href="#eth1-data" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-103-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-103-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-103-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-103-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-103-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-103-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-103-7">7</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_eth1_data</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">body:</span> <span style="color: #F8F8F2">BeaconBlockBody)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data_votes</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">append(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data)</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data_votes</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">count(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data)</span> <span style="color: #FF4689">*</span> <span style="color: #AE81FF">2</span>
<a id="__codelineno-103-5" name="__codelineno-103-5"></a>        <span style="color: #FF4689">&gt;</span> <span style="color: #F8F8F2">EPOCHS_PER_ETH1_VOTING_PERIOD</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH</span>
<a id="__codelineno-103-6" name="__codelineno-103-6"></a>    <span style="color: #F8F8F2">):</span>
<a id="__codelineno-103-7" name="__codelineno-103-7"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data</span>
</code></pre></div></td></tr></table></div>
<h4 id="operations">Operations<a class="headerlink" href="#operations" title="Permanent link">&para;</a></h4>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-104-15">15</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_operations</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">body:</span> <span style="color: #F8F8F2">BeaconBlockBody)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a>    <span style="color: #959077"># Verify that outstanding deposits are processed up to the maximum number of deposits</span>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">len(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">deposits)</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">min(</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a>        <span style="color: #F8F8F2">MAX_DEPOSITS,</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">deposit_count</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_deposit_index</span>
<a id="__codelineno-104-5" name="__codelineno-104-5"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-104-6" name="__codelineno-104-6"></a>
<a id="__codelineno-104-7" name="__codelineno-104-7"></a>    <span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">for_ops</span><span style="color: #F8F8F2">(operations:</span> <span style="color: #F8F8F2">Sequence[Any],</span> <span style="color: #F8F8F2">fn:</span> <span style="color: #F8F8F2">Callable[[BeaconState,</span> <span style="color: #F8F8F2">Any],</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">])</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-104-8" name="__codelineno-104-8"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">operation</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">operations:</span>
<a id="__codelineno-104-9" name="__codelineno-104-9"></a>            <span style="color: #F8F8F2">fn(state,</span> <span style="color: #F8F8F2">operation)</span>
<a id="__codelineno-104-10" name="__codelineno-104-10"></a>
<a id="__codelineno-104-11" name="__codelineno-104-11"></a>    <span style="color: #F8F8F2">for_ops(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_slashings,</span> <span style="color: #F8F8F2">process_proposer_slashing)</span>
<a id="__codelineno-104-12" name="__codelineno-104-12"></a>    <span style="color: #F8F8F2">for_ops(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">attester_slashings,</span> <span style="color: #F8F8F2">process_attester_slashing)</span>
<a id="__codelineno-104-13" name="__codelineno-104-13"></a>    <span style="color: #F8F8F2">for_ops(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">attestations,</span> <span style="color: #F8F8F2">process_attestation)</span>
<a id="__codelineno-104-14" name="__codelineno-104-14"></a>    <span style="color: #F8F8F2">for_ops(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">deposits,</span> <span style="color: #F8F8F2">process_deposit)</span>
<a id="__codelineno-104-15" name="__codelineno-104-15"></a>    <span style="color: #F8F8F2">for_ops(body</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">voluntary_exits,</span> <span style="color: #F8F8F2">process_voluntary_exit)</span>
</code></pre></div></td></tr></table></div>
<h5 id="proposer-slashings">Proposer slashings<a class="headerlink" href="#proposer-slashings" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-105-22">22</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_proposer_slashing</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">proposer_slashing:</span> <span style="color: #F8F8F2">ProposerSlashing)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a>    <span style="color: #F8F8F2">header_1</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">proposer_slashing</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signed_header_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message</span>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a>    <span style="color: #F8F8F2">header_2</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">proposer_slashing</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signed_header_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message</span>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a>
<a id="__codelineno-105-5" name="__codelineno-105-5"></a>    <span style="color: #959077"># Verify header slots match</span>
<a id="__codelineno-105-6" name="__codelineno-105-6"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">header_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">header_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span>
<a id="__codelineno-105-7" name="__codelineno-105-7"></a>    <span style="color: #959077"># Verify header proposer indices match</span>
<a id="__codelineno-105-8" name="__codelineno-105-8"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">header_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">header_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index</span>
<a id="__codelineno-105-9" name="__codelineno-105-9"></a>    <span style="color: #959077"># Verify the headers are different</span>
<a id="__codelineno-105-10" name="__codelineno-105-10"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">header_1</span> <span style="color: #FF4689">!=</span> <span style="color: #F8F8F2">header_2</span>
<a id="__codelineno-105-11" name="__codelineno-105-11"></a>    <span style="color: #959077"># Verify the proposer is slashable</span>
<a id="__codelineno-105-12" name="__codelineno-105-12"></a>    <span style="color: #F8F8F2">proposer</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[header_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index]</span>
<a id="__codelineno-105-13" name="__codelineno-105-13"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">is_slashable_validator(proposer,</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
<a id="__codelineno-105-14" name="__codelineno-105-14"></a>    <span style="color: #959077"># Verify signatures</span>
<a id="__codelineno-105-15" name="__codelineno-105-15"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">signed_header</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">(proposer_slashing</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signed_header_1,</span> <span style="color: #F8F8F2">proposer_slashing</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signed_header_2):</span>
<a id="__codelineno-105-16" name="__codelineno-105-16"></a>        <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(</span>
<a id="__codelineno-105-17" name="__codelineno-105-17"></a>            <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">DOMAIN_BEACON_PROPOSER,</span> <span style="color: #F8F8F2">compute_epoch_at_slot(signed_header</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot)</span>
<a id="__codelineno-105-18" name="__codelineno-105-18"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-105-19" name="__codelineno-105-19"></a>        <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(signed_header</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-105-20" name="__codelineno-105-20"></a>        <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Verify(proposer</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">pubkey,</span> <span style="color: #F8F8F2">signing_root,</span> <span style="color: #F8F8F2">signed_header</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signature)</span>
<a id="__codelineno-105-21" name="__codelineno-105-21"></a>
<a id="__codelineno-105-22" name="__codelineno-105-22"></a>    <span style="color: #F8F8F2">slash_validator(state,</span> <span style="color: #F8F8F2">header_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proposer_index)</span>
</code></pre></div></td></tr></table></div>
<h5 id="attester-slashings">Attester slashings<a class="headerlink" href="#attester-slashings" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-106-14">14</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_attester_slashing</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attester_slashing:</span> <span style="color: #F8F8F2">AttesterSlashing)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a>    <span style="color: #F8F8F2">attestation_1</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">attester_slashing</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">attestation_1</span>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a>    <span style="color: #F8F8F2">attestation_2</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">attester_slashing</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">attestation_2</span>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">is_slashable_attestation_data(attestation_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data,</span> <span style="color: #F8F8F2">attestation_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data)</span>
<a id="__codelineno-106-5" name="__codelineno-106-5"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">is_valid_indexed_attestation(state,</span> <span style="color: #F8F8F2">attestation_1)</span>
<a id="__codelineno-106-6" name="__codelineno-106-6"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">is_valid_indexed_attestation(state,</span> <span style="color: #F8F8F2">attestation_2)</span>
<a id="__codelineno-106-7" name="__codelineno-106-7"></a>
<a id="__codelineno-106-8" name="__codelineno-106-8"></a>    <span style="color: #F8F8F2">slashed_any</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">False</span>
<a id="__codelineno-106-9" name="__codelineno-106-9"></a>    <span style="color: #F8F8F2">indices</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">set(attestation_1</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">attesting_indices)</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">intersection(attestation_2</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">attesting_indices)</span>
<a id="__codelineno-106-10" name="__codelineno-106-10"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">sorted(indices):</span>
<a id="__codelineno-106-11" name="__codelineno-106-11"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">is_slashable_validator(state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[index],</span> <span style="color: #F8F8F2">get_current_epoch(state)):</span>
<a id="__codelineno-106-12" name="__codelineno-106-12"></a>            <span style="color: #F8F8F2">slash_validator(state,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-106-13" name="__codelineno-106-13"></a>            <span style="color: #F8F8F2">slashed_any</span> <span style="color: #FF4689">=</span> <span style="color: #66D9EF">True</span>
<a id="__codelineno-106-14" name="__codelineno-106-14"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">slashed_any</span>
</code></pre></div></td></tr></table></div>
<h5 id="attestations">Attestations<a class="headerlink" href="#attestations" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-24">24</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-25">25</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-107-26">26</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_attestation</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attestation:</span> <span style="color: #F8F8F2">Attestation)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a>    <span style="color: #F8F8F2">data</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">(get_previous_epoch(state),</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">compute_epoch_at_slot(data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot)</span>
<a id="__codelineno-107-5" name="__codelineno-107-5"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">MIN_ATTESTATION_INCLUSION_DELAY</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH</span>
<a id="__codelineno-107-6" name="__codelineno-107-6"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">index</span> <span style="color: #FF4689">&lt;</span> <span style="color: #F8F8F2">get_committee_count_per_slot(state,</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-107-7" name="__codelineno-107-7"></a>
<a id="__codelineno-107-8" name="__codelineno-107-8"></a>    <span style="color: #F8F8F2">committee</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_beacon_committee(state,</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot,</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">index)</span>
<a id="__codelineno-107-9" name="__codelineno-107-9"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">len(attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">aggregation_bits)</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">len(committee)</span>
<a id="__codelineno-107-10" name="__codelineno-107-10"></a>
<a id="__codelineno-107-11" name="__codelineno-107-11"></a>    <span style="color: #F8F8F2">pending_attestation</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">PendingAttestation(</span>
<a id="__codelineno-107-12" name="__codelineno-107-12"></a>        <span style="color: #F8F8F2">data</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">data,</span>
<a id="__codelineno-107-13" name="__codelineno-107-13"></a>        <span style="color: #F8F8F2">aggregation_bits</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">aggregation_bits,</span>
<a id="__codelineno-107-14" name="__codelineno-107-14"></a>        <span style="color: #F8F8F2">inclusion_delay</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot,</span>
<a id="__codelineno-107-15" name="__codelineno-107-15"></a>        <span style="color: #F8F8F2">proposer_index</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">get_beacon_proposer_index(state),</span>
<a id="__codelineno-107-16" name="__codelineno-107-16"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-107-17" name="__codelineno-107-17"></a>
<a id="__codelineno-107-18" name="__codelineno-107-18"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">get_current_epoch(state):</span>
<a id="__codelineno-107-19" name="__codelineno-107-19"></a>        <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">source</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_justified_checkpoint</span>
<a id="__codelineno-107-20" name="__codelineno-107-20"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">current_epoch_attestations</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">append(pending_attestation)</span>
<a id="__codelineno-107-21" name="__codelineno-107-21"></a>    <span style="color: #66D9EF">else</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-107-22" name="__codelineno-107-22"></a>        <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">source</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">previous_justified_checkpoint</span>
<a id="__codelineno-107-23" name="__codelineno-107-23"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">previous_epoch_attestations</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">append(pending_attestation)</span>
<a id="__codelineno-107-24" name="__codelineno-107-24"></a>
<a id="__codelineno-107-25" name="__codelineno-107-25"></a>    <span style="color: #959077"># Verify signature</span>
<a id="__codelineno-107-26" name="__codelineno-107-26"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">is_valid_indexed_attestation(state,</span> <span style="color: #F8F8F2">get_indexed_attestation(state,</span> <span style="color: #F8F8F2">attestation))</span>
</code></pre></div></td></tr></table></div>
<h5 id="deposits">Deposits<a class="headerlink" href="#deposits" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-108-15">15</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_validator_from_deposit</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a>    <span style="color: #F8F8F2">pubkey:</span> <span style="color: #F8F8F2">BLSPubkey,</span> <span style="color: #F8F8F2">withdrawal_credentials:</span> <span style="color: #F8F8F2">Bytes32,</span> <span style="color: #F8F8F2">amount:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Validator:</span>
<a id="__codelineno-108-4" name="__codelineno-108-4"></a>    <span style="color: #F8F8F2">effective_balance</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">min(amount</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">amount</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">EFFECTIVE_BALANCE_INCREMENT,</span> <span style="color: #F8F8F2">MAX_EFFECTIVE_BALANCE)</span>
<a id="__codelineno-108-5" name="__codelineno-108-5"></a>
<a id="__codelineno-108-6" name="__codelineno-108-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">Validator(</span>
<a id="__codelineno-108-7" name="__codelineno-108-7"></a>        <span style="color: #F8F8F2">pubkey</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">pubkey,</span>
<a id="__codelineno-108-8" name="__codelineno-108-8"></a>        <span style="color: #F8F8F2">withdrawal_credentials</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">withdrawal_credentials,</span>
<a id="__codelineno-108-9" name="__codelineno-108-9"></a>        <span style="color: #F8F8F2">effective_balance</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">effective_balance,</span>
<a id="__codelineno-108-10" name="__codelineno-108-10"></a>        <span style="color: #F8F8F2">slashed</span><span style="color: #FF4689">=</span><span style="color: #66D9EF">False</span><span style="color: #F8F8F2">,</span>
<a id="__codelineno-108-11" name="__codelineno-108-11"></a>        <span style="color: #F8F8F2">activation_eligibility_epoch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">FAR_FUTURE_EPOCH,</span>
<a id="__codelineno-108-12" name="__codelineno-108-12"></a>        <span style="color: #F8F8F2">activation_epoch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">FAR_FUTURE_EPOCH,</span>
<a id="__codelineno-108-13" name="__codelineno-108-13"></a>        <span style="color: #F8F8F2">exit_epoch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">FAR_FUTURE_EPOCH,</span>
<a id="__codelineno-108-14" name="__codelineno-108-14"></a>        <span style="color: #F8F8F2">withdrawable_epoch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">FAR_FUTURE_EPOCH,</span>
<a id="__codelineno-108-15" name="__codelineno-108-15"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-109-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-109-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-109-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-109-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-109-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">add_validator_to_registry</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">pubkey:</span> <span style="color: #F8F8F2">BLSPubkey,</span> <span style="color: #F8F8F2">withdrawal_credentials:</span> <span style="color: #F8F8F2">Bytes32,</span> <span style="color: #F8F8F2">amount:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">append(get_validator_from_deposit(pubkey,</span> <span style="color: #F8F8F2">withdrawal_credentials,</span> <span style="color: #F8F8F2">amount))</span>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">balances</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">append(amount)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-110-24">24</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">apply_deposit</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a>    <span style="color: #F8F8F2">pubkey:</span> <span style="color: #F8F8F2">BLSPubkey,</span>
<a id="__codelineno-110-4" name="__codelineno-110-4"></a>    <span style="color: #F8F8F2">withdrawal_credentials:</span> <span style="color: #F8F8F2">Bytes32,</span>
<a id="__codelineno-110-5" name="__codelineno-110-5"></a>    <span style="color: #F8F8F2">amount:</span> <span style="color: #F8F8F2">uint64,</span>
<a id="__codelineno-110-6" name="__codelineno-110-6"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature,</span>
<a id="__codelineno-110-7" name="__codelineno-110-7"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-110-8" name="__codelineno-110-8"></a>    <span style="color: #F8F8F2">validator_pubkeys</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[v</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">pubkey</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">v</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators]</span>
<a id="__codelineno-110-9" name="__codelineno-110-9"></a>    <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">pubkey</span> <span style="color: #FF4689">not</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">validator_pubkeys:</span>
<a id="__codelineno-110-10" name="__codelineno-110-10"></a>        <span style="color: #959077"># Verify the deposit signature (proof of possession) which is not checked by the deposit contract</span>
<a id="__codelineno-110-11" name="__codelineno-110-11"></a>        <span style="color: #F8F8F2">deposit_message</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">DepositMessage(</span>
<a id="__codelineno-110-12" name="__codelineno-110-12"></a>            <span style="color: #F8F8F2">pubkey</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">pubkey,</span>
<a id="__codelineno-110-13" name="__codelineno-110-13"></a>            <span style="color: #F8F8F2">withdrawal_credentials</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">withdrawal_credentials,</span>
<a id="__codelineno-110-14" name="__codelineno-110-14"></a>            <span style="color: #F8F8F2">amount</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">amount,</span>
<a id="__codelineno-110-15" name="__codelineno-110-15"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-110-16" name="__codelineno-110-16"></a>        <span style="color: #959077"># Fork-agnostic domain since deposits are valid across forks</span>
<a id="__codelineno-110-17" name="__codelineno-110-17"></a>        <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_domain(DOMAIN_DEPOSIT)</span>
<a id="__codelineno-110-18" name="__codelineno-110-18"></a>        <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(deposit_message,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-110-19" name="__codelineno-110-19"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Verify(pubkey,</span> <span style="color: #F8F8F2">signing_root,</span> <span style="color: #F8F8F2">signature):</span>
<a id="__codelineno-110-20" name="__codelineno-110-20"></a>            <span style="color: #F8F8F2">add_validator_to_registry(state,</span> <span style="color: #F8F8F2">pubkey,</span> <span style="color: #F8F8F2">withdrawal_credentials,</span> <span style="color: #F8F8F2">amount)</span>
<a id="__codelineno-110-21" name="__codelineno-110-21"></a>    <span style="color: #66D9EF">else</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-110-22" name="__codelineno-110-22"></a>        <span style="color: #959077"># Increase balance by deposit amount</span>
<a id="__codelineno-110-23" name="__codelineno-110-23"></a>        <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">ValidatorIndex(validator_pubkeys</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">index(pubkey))</span>
<a id="__codelineno-110-24" name="__codelineno-110-24"></a>        <span style="color: #F8F8F2">increase_balance(state,</span> <span style="color: #F8F8F2">index,</span> <span style="color: #F8F8F2">amount)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-111-21">21</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_deposit</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">deposit:</span> <span style="color: #F8F8F2">Deposit)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a>    <span style="color: #959077"># Verify the Merkle branch</span>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">is_valid_merkle_branch(</span>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a>        <span style="color: #F8F8F2">leaf</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">hash_tree_root(deposit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data),</span>
<a id="__codelineno-111-5" name="__codelineno-111-5"></a>        <span style="color: #F8F8F2">branch</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">deposit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">proof,</span>
<a id="__codelineno-111-6" name="__codelineno-111-6"></a>        <span style="color: #959077"># Add 1 for the List length mix-in</span>
<a id="__codelineno-111-7" name="__codelineno-111-7"></a>        <span style="color: #F8F8F2">depth</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">DEPOSIT_CONTRACT_TREE_DEPTH</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">,</span>
<a id="__codelineno-111-8" name="__codelineno-111-8"></a>        <span style="color: #F8F8F2">index</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_deposit_index,</span>
<a id="__codelineno-111-9" name="__codelineno-111-9"></a>        <span style="color: #F8F8F2">root</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">deposit_root,</span>
<a id="__codelineno-111-10" name="__codelineno-111-10"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-111-11" name="__codelineno-111-11"></a>
<a id="__codelineno-111-12" name="__codelineno-111-12"></a>    <span style="color: #959077"># Deposits must be processed in order</span>
<a id="__codelineno-111-13" name="__codelineno-111-13"></a>    <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_deposit_index</span> <span style="color: #FF4689">+=</span> <span style="color: #AE81FF">1</span>
<a id="__codelineno-111-14" name="__codelineno-111-14"></a>
<a id="__codelineno-111-15" name="__codelineno-111-15"></a>    <span style="color: #F8F8F2">apply_deposit(</span>
<a id="__codelineno-111-16" name="__codelineno-111-16"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">state,</span>
<a id="__codelineno-111-17" name="__codelineno-111-17"></a>        <span style="color: #F8F8F2">pubkey</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">deposit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">pubkey,</span>
<a id="__codelineno-111-18" name="__codelineno-111-18"></a>        <span style="color: #F8F8F2">withdrawal_credentials</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">deposit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">withdrawal_credentials,</span>
<a id="__codelineno-111-19" name="__codelineno-111-19"></a>        <span style="color: #F8F8F2">amount</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">deposit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">amount,</span>
<a id="__codelineno-111-20" name="__codelineno-111-20"></a>        <span style="color: #F8F8F2">signature</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">deposit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signature,</span>
<a id="__codelineno-111-21" name="__codelineno-111-21"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h5 id="voluntary-exits">Voluntary exits<a class="headerlink" href="#voluntary-exits" title="Permanent link">&para;</a></h5>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-112-17">17</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">process_voluntary_exit</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">signed_voluntary_exit:</span> <span style="color: #F8F8F2">SignedVoluntaryExit)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #66D9EF">None</span><span style="color: #F8F8F2">:</span>
<a id="__codelineno-112-2" name="__codelineno-112-2"></a>    <span style="color: #F8F8F2">voluntary_exit</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">signed_voluntary_exit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">message</span>
<a id="__codelineno-112-3" name="__codelineno-112-3"></a>    <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[voluntary_exit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validator_index]</span>
<a id="__codelineno-112-4" name="__codelineno-112-4"></a>    <span style="color: #959077"># Verify the validator is active</span>
<a id="__codelineno-112-5" name="__codelineno-112-5"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">is_active_validator(validator,</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
<a id="__codelineno-112-6" name="__codelineno-112-6"></a>    <span style="color: #959077"># Verify exit has not been initiated</span>
<a id="__codelineno-112-7" name="__codelineno-112-7"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">exit_epoch</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">FAR_FUTURE_EPOCH</span>
<a id="__codelineno-112-8" name="__codelineno-112-8"></a>    <span style="color: #959077"># Exits must specify an epoch when they become valid; they are not valid before then</span>
<a id="__codelineno-112-9" name="__codelineno-112-9"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">get_current_epoch(state)</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">voluntary_exit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch</span>
<a id="__codelineno-112-10" name="__codelineno-112-10"></a>    <span style="color: #959077"># Verify the validator has been active long enough</span>
<a id="__codelineno-112-11" name="__codelineno-112-11"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">get_current_epoch(state)</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">activation_epoch</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">SHARD_COMMITTEE_PERIOD</span>
<a id="__codelineno-112-12" name="__codelineno-112-12"></a>    <span style="color: #959077"># Verify signature</span>
<a id="__codelineno-112-13" name="__codelineno-112-13"></a>    <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_VOLUNTARY_EXIT,</span> <span style="color: #F8F8F2">voluntary_exit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-112-14" name="__codelineno-112-14"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(voluntary_exit,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-112-15" name="__codelineno-112-15"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Verify(validator</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">pubkey,</span> <span style="color: #F8F8F2">signing_root,</span> <span style="color: #F8F8F2">signed_voluntary_exit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signature)</span>
<a id="__codelineno-112-16" name="__codelineno-112-16"></a>    <span style="color: #959077"># Initiate exit</span>
<a id="__codelineno-112-17" name="__codelineno-112-17"></a>    <span style="color: #F8F8F2">initiate_validator_exit(state,</span> <span style="color: #F8F8F2">voluntary_exit</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validator_index)</span>
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ethereum/consensus-specs" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "search"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>