
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ethereum.github.io/consensus-specs/specs/phase0/validator/">
      
      
        <link rel="prev" href="../p2p-interface/">
      
      
        <link rel="next" href="../weak-subjectivity/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Validator - Ethereum Consensus Specs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#phase-0-honest-validator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Ethereum Consensus Specs" class="md-header__button md-logo" aria-label="Ethereum Consensus Specs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ethereum Consensus Specs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Validator
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../beacon-chain/" class="md-tabs__link">
          
  
  
  Specs

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../docs/new-feature/" class="md-tabs__link">
          
  
  
  Docs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../fork_choice/safe-block/" class="md-tabs__link">
          
  
  
  Fork choice

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../light-client/" class="md-tabs__link">
          
  
  
  Light client

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ssz/merkle-proofs/" class="md-tabs__link">
          
  
  
  Ssz

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../sync/optimistic/" class="md-tabs__link">
          
  
  
  Sync

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Ethereum Consensus Specs" class="md-nav__button md-logo" aria-label="Ethereum Consensus Specs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ethereum Consensus Specs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ethereum Proof-of-Stake Consensus Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Specs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Specs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Phase0
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Phase0
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deposit-contract/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deposit Contract
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constants" class="md-nav__link">
    <span class="md-ellipsis">
      Constants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Time parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    <span class="md-ellipsis">
      Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eth1block" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregateandproof" class="md-nav__link">
    <span class="md-ellipsis">
      AggregateAndProof
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signedaggregateandproof" class="md-nav__link">
    <span class="md-ellipsis">
      SignedAggregateAndProof
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#becoming-a-validator" class="md-nav__link">
    <span class="md-ellipsis">
      Becoming a validator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Becoming a validator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bls-public-key" class="md-nav__link">
    <span class="md-ellipsis">
      BLS public key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withdrawal-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Withdrawal credentials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Withdrawal credentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bls_withdrawal_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      BLS_WITHDRAWAL_PREFIX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1_address_withdrawal_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      ETH1_ADDRESS_WITHDRAWAL_PREFIX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-deposit" class="md-nav__link">
    <span class="md-ellipsis">
      Submit deposit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-deposit" class="md-nav__link">
    <span class="md-ellipsis">
      Process deposit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator-index" class="md-nav__link">
    <span class="md-ellipsis">
      Validator index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation" class="md-nav__link">
    <span class="md-ellipsis">
      Activation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validator-assignments" class="md-nav__link">
    <span class="md-ellipsis">
      Validator assignments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validator assignments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lookahead" class="md-nav__link">
    <span class="md-ellipsis">
      Lookahead
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beacon-chain-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon chain responsibilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon chain responsibilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block-proposal" class="md-nav__link">
    <span class="md-ellipsis">
      Block proposal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Block proposal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparing-for-a-beaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing for a BeaconBlock
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparing for a BeaconBlock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slot" class="md-nav__link">
    <span class="md-ellipsis">
      Slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proposer-index" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parent-root" class="md-nav__link">
    <span class="md-ellipsis">
      Parent root
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructing-the-beaconblockbody" class="md-nav__link">
    <span class="md-ellipsis">
      Constructing the BeaconBlockBody
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constructing the BeaconBlockBody">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#randao-reveal" class="md-nav__link">
    <span class="md-ellipsis">
      Randao reveal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1-data" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1 Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Eth1 Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_eth1_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_eth1_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proposer-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attester-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Attester slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestations" class="md-nav__link">
    <span class="md-ellipsis">
      Attestations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deposits" class="md-nav__link">
    <span class="md-ellipsis">
      Deposits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voluntary-exits" class="md-nav__link">
    <span class="md-ellipsis">
      Voluntary exits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packaging-into-a-signedbeaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging into a SignedBeaconBlock
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Packaging into a SignedBeaconBlock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-root" class="md-nav__link">
    <span class="md-ellipsis">
      State root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature" class="md-nav__link">
    <span class="md-ellipsis">
      Signature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attesting" class="md-nav__link">
    <span class="md-ellipsis">
      Attesting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attesting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attestation-data" class="md-nav__link">
    <span class="md-ellipsis">
      Attestation data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attestation data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    <span class="md-ellipsis">
      General
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lmd-ghost-vote" class="md-nav__link">
    <span class="md-ellipsis">
      LMD GHOST vote
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ffg-vote" class="md-nav__link">
    <span class="md-ellipsis">
      FFG vote
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct-attestation" class="md-nav__link">
    <span class="md-ellipsis">
      Construct attestation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Construct attestation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation-bits" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregation bits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-signature" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate signature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcast-attestation" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcast attestation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestation-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      Attestation aggregation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attestation aggregation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregation selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct-aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      Construct aggregate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Construct aggregate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation-bits_1" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregation bits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-signature_1" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate signature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcast-aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcast aggregate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-avoid-slashing" class="md-nav__link">
    <span class="md-ellipsis">
      How to avoid slashing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to avoid slashing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposer-slashing" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer slashing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attester-slashing" class="md-nav__link">
    <span class="md-ellipsis">
      Attester slashing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protection-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Protection best practices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../weak-subjectivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Weak Subjectivity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Altair
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Altair
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/bls/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BLS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_2_6" id="__nav_2_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_6">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/full-node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Full Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/light-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bellatrix
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Bellatrix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Capella
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Capella
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_6" >
        
          
          <label class="md-nav__link" for="__nav_2_4_6" id="__nav_2_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4_6">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/full-node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Full Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deneb
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Deneb
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/polynomial-commitments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Polynomial Commitments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_7" >
        
          
          <label class="md-nav__link" for="__nav_2_5_7" id="__nav_2_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_7">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/full-node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Full Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Electra
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Electra
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/weak-subjectivity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Weak Subjectivity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6_6" id="__nav_2_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light Client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6_6">
            <span class="md-nav__icon md-icon"></span>
            Light Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/light-client/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/light-client/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../electra/light-client/sync-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync Protocol
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fulu
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Fulu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/das-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DAS Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/polynomial-commitments-sampling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Polynomial Commitments Sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fulu/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Gloas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Gloas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/beacon-chain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Beacon Chain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Builder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/fork-choice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/fork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/p2p-interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gloas/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/new-feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to add a new feature proposal in consensus-specs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Procedure
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fork choice
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Fork choice
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../fork_choice/safe-block/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork Choice -- Safe Block
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fork Choice -- Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Fork Choice -- Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    phase0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bellatrix/fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bellatrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    capella
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/fork-choice" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    deneb
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Light client
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Light client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../light-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../altair/light-client/sync-protocol" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Altair
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capella/light-client/sync-protocol" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Capella
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deneb/light-client/sync-protocol" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deneb
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ssz
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Ssz
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ssz/merkle-proofs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Merkle proof formats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ssz/simple-serialize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SimpleSerialize (SSZ)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sync
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Sync
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sync/optimistic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimistic Sync
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constants" class="md-nav__link">
    <span class="md-ellipsis">
      Constants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    <span class="md-ellipsis">
      Misc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Time parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers" class="md-nav__link">
    <span class="md-ellipsis">
      Containers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Containers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#eth1block" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregateandproof" class="md-nav__link">
    <span class="md-ellipsis">
      AggregateAndProof
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signedaggregateandproof" class="md-nav__link">
    <span class="md-ellipsis">
      SignedAggregateAndProof
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#becoming-a-validator" class="md-nav__link">
    <span class="md-ellipsis">
      Becoming a validator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Becoming a validator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bls-public-key" class="md-nav__link">
    <span class="md-ellipsis">
      BLS public key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#withdrawal-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Withdrawal credentials
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Withdrawal credentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bls_withdrawal_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      BLS_WITHDRAWAL_PREFIX
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1_address_withdrawal_prefix" class="md-nav__link">
    <span class="md-ellipsis">
      ETH1_ADDRESS_WITHDRAWAL_PREFIX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-deposit" class="md-nav__link">
    <span class="md-ellipsis">
      Submit deposit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-deposit" class="md-nav__link">
    <span class="md-ellipsis">
      Process deposit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validator-index" class="md-nav__link">
    <span class="md-ellipsis">
      Validator index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation" class="md-nav__link">
    <span class="md-ellipsis">
      Activation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validator-assignments" class="md-nav__link">
    <span class="md-ellipsis">
      Validator assignments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validator assignments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lookahead" class="md-nav__link">
    <span class="md-ellipsis">
      Lookahead
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beacon-chain-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      Beacon chain responsibilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Beacon chain responsibilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block-proposal" class="md-nav__link">
    <span class="md-ellipsis">
      Block proposal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Block proposal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparing-for-a-beaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing for a BeaconBlock
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparing for a BeaconBlock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slot" class="md-nav__link">
    <span class="md-ellipsis">
      Slot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proposer-index" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parent-root" class="md-nav__link">
    <span class="md-ellipsis">
      Parent root
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constructing-the-beaconblockbody" class="md-nav__link">
    <span class="md-ellipsis">
      Constructing the BeaconBlockBody
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constructing the BeaconBlockBody">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#randao-reveal" class="md-nav__link">
    <span class="md-ellipsis">
      Randao reveal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eth1-data" class="md-nav__link">
    <span class="md-ellipsis">
      Eth1 Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Eth1 Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_eth1_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_eth1_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proposer-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attester-slashings" class="md-nav__link">
    <span class="md-ellipsis">
      Attester slashings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestations" class="md-nav__link">
    <span class="md-ellipsis">
      Attestations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deposits" class="md-nav__link">
    <span class="md-ellipsis">
      Deposits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voluntary-exits" class="md-nav__link">
    <span class="md-ellipsis">
      Voluntary exits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packaging-into-a-signedbeaconblock" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging into a SignedBeaconBlock
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Packaging into a SignedBeaconBlock">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-root" class="md-nav__link">
    <span class="md-ellipsis">
      State root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signature" class="md-nav__link">
    <span class="md-ellipsis">
      Signature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attesting" class="md-nav__link">
    <span class="md-ellipsis">
      Attesting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attesting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attestation-data" class="md-nav__link">
    <span class="md-ellipsis">
      Attestation data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attestation data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    <span class="md-ellipsis">
      General
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lmd-ghost-vote" class="md-nav__link">
    <span class="md-ellipsis">
      LMD GHOST vote
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ffg-vote" class="md-nav__link">
    <span class="md-ellipsis">
      FFG vote
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct-attestation" class="md-nav__link">
    <span class="md-ellipsis">
      Construct attestation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Construct attestation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation-bits" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregation bits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-signature" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate signature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcast-attestation" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcast attestation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attestation-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      Attestation aggregation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attestation aggregation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregation selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct-aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      Construct aggregate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Construct aggregate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data_1" class="md-nav__link">
    <span class="md-ellipsis">
      Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation-bits_1" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregation bits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-signature_1" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate signature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcast-aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcast aggregate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-avoid-slashing" class="md-nav__link">
    <span class="md-ellipsis">
      How to avoid slashing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to avoid slashing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposer-slashing" class="md-nav__link">
    <span class="md-ellipsis">
      Proposer slashing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attester-slashing" class="md-nav__link">
    <span class="md-ellipsis">
      Attester slashing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protection-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Protection best practices
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="phase-0-honest-validator">Phase 0 -- Honest Validator<a class="headerlink" href="#phase-0-honest-validator" title="Permanent link">&para;</a></h1>
<p>This is an accompanying document to
<a href="../beacon-chain/">Phase 0 -- The Beacon Chain</a>, which describes the expected
actions of a "validator" participating in the Ethereum proof-of-stake protocol.</p>
<!-- mdformat-toc start --slug=github --no-anchors --maxlevel=6 --minlevel=2 -->

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#constants">Constants</a></li>
<li><a href="#misc">Misc</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#time-parameters">Time parameters</a></li>
<li><a href="#containers">Containers</a></li>
<li><a href="#eth1block"><code>Eth1Block</code></a></li>
<li><a href="#aggregateandproof"><code>AggregateAndProof</code></a></li>
<li><a href="#signedaggregateandproof"><code>SignedAggregateAndProof</code></a></li>
<li><a href="#becoming-a-validator">Becoming a validator</a></li>
<li><a href="#initialization">Initialization</a><ul>
<li><a href="#bls-public-key">BLS public key</a></li>
<li><a href="#withdrawal-credentials">Withdrawal credentials</a></li>
<li><a href="#bls_withdrawal_prefix"><code>BLS_WITHDRAWAL_PREFIX</code></a></li>
<li><a href="#eth1_address_withdrawal_prefix"><code>ETH1_ADDRESS_WITHDRAWAL_PREFIX</code></a></li>
</ul>
</li>
<li><a href="#submit-deposit">Submit deposit</a></li>
<li><a href="#process-deposit">Process deposit</a></li>
<li><a href="#validator-index">Validator index</a></li>
<li><a href="#activation">Activation</a></li>
<li><a href="#validator-assignments">Validator assignments</a></li>
<li><a href="#lookahead">Lookahead</a></li>
<li><a href="#beacon-chain-responsibilities">Beacon chain responsibilities</a></li>
<li><a href="#block-proposal">Block proposal</a><ul>
<li><a href="#preparing-for-a-beaconblock">Preparing for a <code>BeaconBlock</code></a></li>
<li><a href="#slot">Slot</a></li>
<li><a href="#proposer-index">Proposer index</a></li>
<li><a href="#parent-root">Parent root</a></li>
<li><a href="#constructing-the-beaconblockbody">Constructing the <code>BeaconBlockBody</code></a></li>
<li><a href="#randao-reveal">Randao reveal</a></li>
<li><a href="#eth1-data">Eth1 Data</a><ul>
<li><a href="#get_eth1_data"><code>get_eth1_data</code></a></li>
</ul>
</li>
<li><a href="#proposer-slashings">Proposer slashings</a></li>
<li><a href="#attester-slashings">Attester slashings</a></li>
<li><a href="#attestations">Attestations</a></li>
<li><a href="#deposits">Deposits</a></li>
<li><a href="#voluntary-exits">Voluntary exits</a></li>
<li><a href="#packaging-into-a-signedbeaconblock">Packaging into a <code>SignedBeaconBlock</code></a></li>
<li><a href="#state-root">State root</a></li>
<li><a href="#signature">Signature</a></li>
</ul>
</li>
<li><a href="#attesting">Attesting</a><ul>
<li><a href="#attestation-data">Attestation data</a></li>
<li><a href="#general">General</a></li>
<li><a href="#lmd-ghost-vote">LMD GHOST vote</a></li>
<li><a href="#ffg-vote">FFG vote</a></li>
<li><a href="#construct-attestation">Construct attestation</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#aggregation-bits">Aggregation bits</a></li>
<li><a href="#aggregate-signature">Aggregate signature</a></li>
<li><a href="#broadcast-attestation">Broadcast attestation</a></li>
</ul>
</li>
<li><a href="#attestation-aggregation">Attestation aggregation</a><ul>
<li><a href="#aggregation-selection">Aggregation selection</a></li>
<li><a href="#construct-aggregate">Construct aggregate</a></li>
<li><a href="#data-1">Data</a></li>
<li><a href="#aggregation-bits-1">Aggregation bits</a></li>
<li><a href="#aggregate-signature-1">Aggregate signature</a></li>
<li><a href="#broadcast-aggregate">Broadcast aggregate</a></li>
</ul>
</li>
<li><a href="#how-to-avoid-slashing">How to avoid slashing</a></li>
<li><a href="#proposer-slashing">Proposer slashing</a></li>
<li><a href="#attester-slashing">Attester slashing</a></li>
<li><a href="#protection-best-practices">Protection best practices</a></li>
</ul>
<!-- mdformat-toc end -->

<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This document represents the expected behavior of an "honest validator" with
respect to Phase 0 of the Ethereum proof-of-stake protocol. This document does
not distinguish between a "node" (i.e. the functionality of following and
reading the beacon chain) and a "validator client" (i.e. the functionality of
actively participating in consensus). The separation of concerns between these
(potentially) two pieces of software is left as a design decision that is out of
scope.</p>
<p>A validator is an entity that participates in the consensus of the Ethereum
proof-of-stake protocol. This is an optional role for users in which they can
post ETH as collateral and verify and attest to the validity of blocks to seek
financial returns in exchange for building and securing the protocol. This is
similar to proof-of-work networks in which miners provide collateral in the form
of hardware/hash-power to seek returns in exchange for building and securing the
protocol.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>All terminology, constants, functions, and protocol mechanics defined in the
<a href="../beacon-chain/">Phase 0 -- The Beacon Chain</a> and
<a href="../deposit-contract/">Phase 0 -- Deposit Contract</a> doc are requisite for this
document and used throughout. Please see the Phase 0 doc before continuing and
use as a reference throughout.</p>
<h2 id="constants">Constants<a class="headerlink" href="#constants" title="Permanent link">&para;</a></h2>
<h3 id="misc">Misc<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th style="text-align: center;">Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>TARGET_AGGREGATORS_PER_COMMITTEE</code></td>
<td><code>2**4</code> (= 16)</td>
<td style="text-align: center;">validators</td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<h3 id="time-parameters">Time parameters<a class="headerlink" href="#time-parameters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th style="text-align: center;">Unit</th>
<th style="text-align: center;">Duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ATTESTATION_DUE_BPS</code></td>
<td><code>uint64(3333)</code></td>
<td style="text-align: center;">basis points</td>
<td style="text-align: center;">~33% of <code>SLOT_DURATION_MS</code></td>
</tr>
<tr>
<td><code>AGGREGATE_DUE_BPS</code></td>
<td><code>uint64(6667)</code></td>
<td style="text-align: center;">basis points</td>
<td style="text-align: center;">~67% of <code>SLOT_DURATION_MS</code></td>
</tr>
</tbody>
</table>
<h2 id="containers">Containers<a class="headerlink" href="#containers" title="Permanent link">&para;</a></h2>
<h3 id="eth1block"><code>Eth1Block</code><a class="headerlink" href="#eth1block" title="Permanent link">&para;</a></h3>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-0-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">Eth1Block</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span style="color: #F8F8F2">timestamp:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span style="color: #F8F8F2">deposit_root:</span> <span style="color: #F8F8F2">Root</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span style="color: #F8F8F2">deposit_count:</span> <span style="color: #F8F8F2">uint64</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span style="color: #959077"># All other eth1 block fields</span>
</code></pre></div></td></tr></table></div>
<h3 id="aggregateandproof"><code>AggregateAndProof</code><a class="headerlink" href="#aggregateandproof" title="Permanent link">&para;</a></h3>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-1-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-1-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-1-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-1-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">AggregateAndProof</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span style="color: #F8F8F2">aggregator_index:</span> <span style="color: #F8F8F2">ValidatorIndex</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span style="color: #F8F8F2">aggregate:</span> <span style="color: #F8F8F2">Attestation</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>    <span style="color: #F8F8F2">selection_proof:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h3 id="signedaggregateandproof"><code>SignedAggregateAndProof</code><a class="headerlink" href="#signedaggregateandproof" title="Permanent link">&para;</a></h3>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-2-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-2-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span style="color: #66D9EF">class</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">SignedAggregateAndProof</span><span style="color: #F8F8F2">(Container):</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span style="color: #F8F8F2">message:</span> <span style="color: #F8F8F2">AggregateAndProof</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span style="color: #F8F8F2">signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
</code></pre></div></td></tr></table></div>
<h2 id="becoming-a-validator">Becoming a validator<a class="headerlink" href="#becoming-a-validator" title="Permanent link">&para;</a></h2>
<h3 id="initialization">Initialization<a class="headerlink" href="#initialization" title="Permanent link">&para;</a></h3>
<p>A validator must initialize many parameters locally before submitting a deposit
and joining the validator registry.</p>
<h4 id="bls-public-key">BLS public key<a class="headerlink" href="#bls-public-key" title="Permanent link">&para;</a></h4>
<p>Validator public keys are <a href="../beacon-chain/#bls-signatures">G1 points</a> on the
<a href="https://z.cash/blog/new-snark-curve">BLS12-381 curve</a>. A private key,
<code>privkey</code>, must be securely generated along with the resultant <code>pubkey</code>. This
<code>privkey</code> must be "hot", that is, constantly available to sign data throughout
the lifetime of the validator.</p>
<h4 id="withdrawal-credentials">Withdrawal credentials<a class="headerlink" href="#withdrawal-credentials" title="Permanent link">&para;</a></h4>
<p>The <code>withdrawal_credentials</code> field constrains validator withdrawals. The first
byte of this 32-byte field is a withdrawal prefix which defines the semantics of
the remaining 31 bytes.</p>
<p>The following withdrawal prefixes are currently supported.</p>
<h5 id="bls_withdrawal_prefix"><code>BLS_WITHDRAWAL_PREFIX</code><a class="headerlink" href="#bls_withdrawal_prefix" title="Permanent link">&para;</a></h5>
<p>Withdrawal credentials with the BLS withdrawal prefix allow a BLS key pair
<code>(bls_withdrawal_privkey, bls_withdrawal_pubkey)</code> to trigger withdrawals. The
<code>withdrawal_credentials</code> field must be such that:</p>
<ul>
<li><code>withdrawal_credentials[:1] == BLS_WITHDRAWAL_PREFIX</code></li>
<li><code>withdrawal_credentials[1:] == hash(bls_withdrawal_pubkey)[1:]</code></li>
</ul>
<p><em>Note</em>: The <code>bls_withdrawal_privkey</code> is not required for validating and can be
kept in cold storage.</p>
<h5 id="eth1_address_withdrawal_prefix"><code>ETH1_ADDRESS_WITHDRAWAL_PREFIX</code><a class="headerlink" href="#eth1_address_withdrawal_prefix" title="Permanent link">&para;</a></h5>
<p>Withdrawal credentials with the Eth1 address withdrawal prefix specify a 20-byte
Eth1 address <code>eth1_withdrawal_address</code> as the recipient for all withdrawals. The
<code>eth1_withdrawal_address</code> can be the address of either an externally owned
account or of a contract.</p>
<p>The <code>withdrawal_credentials</code> field must be such that:</p>
<ul>
<li><code>withdrawal_credentials[:1] == ETH1_ADDRESS_WITHDRAWAL_PREFIX</code></li>
<li><code>withdrawal_credentials[1:12] == b'\x00' * 11</code></li>
<li><code>withdrawal_credentials[12:] == eth1_withdrawal_address</code></li>
</ul>
<p>After the merge of the current Ethereum execution layer into the Beacon Chain,
withdrawals to <code>eth1_withdrawal_address</code> will simply be increases to the
account's ETH balance that do <strong>NOT</strong> trigger any EVM execution.</p>
<h3 id="submit-deposit">Submit deposit<a class="headerlink" href="#submit-deposit" title="Permanent link">&para;</a></h3>
<p>In Phase 0, all incoming validator deposits originate from the Ethereum
proof-of-work chain defined by <code>DEPOSIT_CHAIN_ID</code> and <code>DEPOSIT_NETWORK_ID</code>.
Deposits are made to the <a href="../deposit-contract/">deposit contract</a> located at
<code>DEPOSIT_CONTRACT_ADDRESS</code>.</p>
<p>To submit a deposit:</p>
<ul>
<li>Pack the validator's <a href="#initialization">initialization parameters</a> into
  <code>deposit_data</code>, a <a href="../beacon-chain/#depositdata"><code>DepositData</code></a> SSZ object.</li>
<li>Let <code>amount</code> be the amount in Gwei to be deposited by the validator where
  <code>amount &gt;= MIN_DEPOSIT_AMOUNT</code>.</li>
<li>Set <code>deposit_data.pubkey</code> to validator's <code>pubkey</code>.</li>
<li>Set <code>deposit_data.withdrawal_credentials</code> to <code>withdrawal_credentials</code>.</li>
<li>Set <code>deposit_data.amount</code> to <code>amount</code>.</li>
<li>Let <code>deposit_message</code> be a <code>DepositMessage</code> with all the <code>DepositData</code>
  contents except the <code>signature</code>.</li>
<li>Let <code>signature</code> be the result of <code>bls.Sign</code> of the
  <code>compute_signing_root(deposit_message, domain)</code> with
  <code>domain=compute_domain(DOMAIN_DEPOSIT)</code>. (<em>Warning</em>: Deposits <em>must</em> be signed
  with <code>GENESIS_FORK_VERSION</code>, calling <code>compute_domain</code> without a second
  argument defaults to the correct version).</li>
<li>Let <code>deposit_data_root</code> be <code>hash_tree_root(deposit_data)</code>.</li>
<li>Send a transaction on the Ethereum proof-of-work chain to
  <code>DEPOSIT_CONTRACT_ADDRESS</code> executing
  <code>def deposit(pubkey: bytes[48], withdrawal_credentials: bytes[32], signature: bytes[96], deposit_data_root: bytes32)</code>
  along with a deposit of <code>amount</code> Gwei.</li>
</ul>
<p><em>Note</em>: Deposits made for the same <code>pubkey</code> are treated as for the same
validator. A singular <code>Validator</code> will be added to <code>state.validators</code> with each
additional deposit amount added to the validator's balance. A validator can only
be activated when total deposits for the validator pubkey meet or exceed
<code>MAX_EFFECTIVE_BALANCE</code>.</p>
<h3 id="process-deposit">Process deposit<a class="headerlink" href="#process-deposit" title="Permanent link">&para;</a></h3>
<p>Deposits cannot be processed into the beacon chain until the proof-of-work block
in which they were deposited or any of its descendants is added to the beacon
chain <code>state.eth1_data</code>. This takes <em>a minimum</em> of <code>ETH1_FOLLOW_DISTANCE</code> Eth1
blocks (~8 hours) plus <code>EPOCHS_PER_ETH1_VOTING_PERIOD</code> epochs (~6.8 hours). Once
the requisite proof-of-work block data is added, the deposit will normally be
added to a beacon chain block and processed into the <code>state.validators</code> within
an epoch or two. The validator is then in a queue to be activated.</p>
<h3 id="validator-index">Validator index<a class="headerlink" href="#validator-index" title="Permanent link">&para;</a></h3>
<p>Once a validator has been processed and added to the beacon state's
<code>validators</code>, the validator's <code>validator_index</code> is defined by the index into the
registry at which the <a href="../beacon-chain/#validator"><code>ValidatorRecord</code></a> contains
the <code>pubkey</code> specified in the validator's deposit. A validator's
<code>validator_index</code> is guaranteed to not change from the time of initial deposit
until the validator exits and fully withdraws. This <code>validator_index</code> is used
throughout the specification to dictate validator roles and responsibilities at
any point and should be stored locally.</p>
<h3 id="activation">Activation<a class="headerlink" href="#activation" title="Permanent link">&para;</a></h3>
<p>In normal operation, the validator is quickly activated, at which point the
validator is added to the shuffling and begins validation after an additional
<code>MAX_SEED_LOOKAHEAD</code> epochs (25.6 minutes).</p>
<p>The function <a href="../beacon-chain/#is_active_validator"><code>is_active_validator</code></a> can
be used to check if a validator is active during a given epoch. Usage is as
follows:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-3-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">check_if_validator_active</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">validator_index:</span> <span style="color: #F8F8F2">ValidatorIndex)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span style="color: #F8F8F2">validator</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">validators[validator_index]</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">is_active_validator(validator,</span> <span style="color: #F8F8F2">get_current_epoch(state))</span>
</code></pre></div></td></tr></table></div>
<p>Once a validator is activated, the validator is assigned
<a href="#beacon-chain-responsibilities">responsibilities</a> until exited.</p>
<p><em>Note</em>: There is a maximum validator churn per finalized epoch, so the delay
until activation is variable depending upon finality, total active validator
balance, and the number of validators in the queue to be activated.</p>
<h2 id="validator-assignments">Validator assignments<a class="headerlink" href="#validator-assignments" title="Permanent link">&para;</a></h2>
<p>A validator can get committee assignments for a given epoch using the following
helper via <code>get_committee_assignment(state, epoch, validator_index)</code> where
<code>epoch &lt;= next_epoch</code>.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-4-22">22</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_committee_assignment</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">epoch:</span> <span style="color: #F8F8F2">Epoch,</span> <span style="color: #F8F8F2">validator_index:</span> <span style="color: #F8F8F2">ValidatorIndex</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Optional[Tuple[Sequence[ValidatorIndex],</span> <span style="color: #F8F8F2">CommitteeIndex,</span> <span style="color: #F8F8F2">Slot]]:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span style="color: #E6DB74">    Return the committee assignment in the ``epoch`` for ``validator_index``.</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span style="color: #E6DB74">    ``assignment`` returned is a tuple of the following form:</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span style="color: #E6DB74">        * ``assignment[0]`` is the list of validators in the committee</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span style="color: #E6DB74">        * ``assignment[1]`` is the index to which the committee is assigned</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span style="color: #E6DB74">        * ``assignment[2]`` is the slot at which the committee is assigned</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span style="color: #E6DB74">    Return None if no assignment.</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>    <span style="color: #F8F8F2">next_epoch</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Epoch(get_current_epoch(state)</span> <span style="color: #FF4689">+</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>    <span style="color: #66D9EF">assert</span> <span style="color: #F8F8F2">epoch</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">next_epoch</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span style="color: #F8F8F2">start_slot</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_start_slot_at_epoch(epoch)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span style="color: #F8F8F2">committee_count_per_slot</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_committee_count_per_slot(state,</span> <span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>    <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(start_slot,</span> <span style="color: #F8F8F2">start_slot</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH):</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">range(committee_count_per_slot):</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>            <span style="color: #F8F8F2">committee</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_beacon_committee(state,</span> <span style="color: #F8F8F2">Slot(slot),</span> <span style="color: #F8F8F2">CommitteeIndex(index))</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>            <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">validator_index</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">committee:</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>                <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">committee,</span> <span style="color: #F8F8F2">CommitteeIndex(index),</span> <span style="color: #F8F8F2">Slot(slot)</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>    <span style="color: #66D9EF">return</span> <span style="color: #66D9EF">None</span>
</code></pre></div></td></tr></table></div>
<p>A validator can use the following function to see if they are supposed to
propose during a slot. This function can only be run with a <code>state</code> of the slot
in question. Proposer selection is only stable within the context of the current
epoch.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-5-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-5-2">2</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_proposer</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">validator_index:</span> <span style="color: #F8F8F2">ValidatorIndex)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">get_beacon_proposer_index(state)</span> <span style="color: #FF4689">==</span> <span style="color: #F8F8F2">validator_index</span>
</code></pre></div></td></tr></table></div>
<p><em>Note</em>: To see if a validator is assigned to propose during the slot, the beacon
state must be in the epoch in question. At the epoch boundaries, the validator
must run an epoch transition into the epoch to successfully check the proposal
assignment of the first slot.</p>
<p><em>Note</em>: <code>BeaconBlock</code> proposal is distinct from beacon committee assignment, and
in a given epoch each responsibility might occur at a different slot.</p>
<h3 id="lookahead">Lookahead<a class="headerlink" href="#lookahead" title="Permanent link">&para;</a></h3>
<p>The beacon chain shufflings are designed to provide a minimum of 1 epoch
lookahead on the validator's upcoming committee assignments for attesting
dictated by the shuffling and slot. Note that this lookahead does not apply to
proposing, which must be checked during the epoch in question.</p>
<p><code>get_committee_assignment</code> should be called at the start of each epoch to get
the assignment for the next epoch (<code>current_epoch + 1</code>). A validator should plan
for future assignments by noting their assigned attestation slot and joining the
committee index attestation subnet related to their committee assignment.</p>
<p>Specifically a validator should:</p>
<ul>
<li>Call
  <code>_, committee_index, _ = get_committee_assignment(state, next_epoch, validator_index)</code>
  when checking for next epoch assignments.</li>
<li>Calculate the committees per slot for the next epoch:
  <code>committees_per_slot = get_committee_count_per_slot(state, next_epoch)</code></li>
<li>Calculate the subnet index:
  <code>subnet_id = compute_subnet_for_attestation(committees_per_slot, slot, committee_index)</code></li>
<li>Find peers of the pubsub topic <code>beacon_attestation_{subnet_id}</code>.</li>
<li>If an <em>insufficient</em> number of current peers are subscribed to the topic,
    the validator must discover new peers on this topic. Via the discovery
    protocol, find peers with an ENR containing the <code>attnets</code> entry such that
    <code>ENR["attnets"][subnet_id] == True</code>. Then validate that the peers are still
    persisted on the desired topic by requesting <code>GetMetaData</code> and checking the
    resulting <code>attnets</code> field.</li>
<li>If the validator is assigned to be an aggregator for the slot (see
    <code>is_aggregator()</code>), then subscribe to the topic.</li>
</ul>
<p><em>Note</em>: If the validator is <em>not</em> assigned to be an aggregator, the validator
only needs sufficient number of peers on the topic to be able to publish
messages. The validator does not need to <em>subscribe</em> and listen to all messages
on the topic.</p>
<h2 id="beacon-chain-responsibilities">Beacon chain responsibilities<a class="headerlink" href="#beacon-chain-responsibilities" title="Permanent link">&para;</a></h2>
<p>A validator has two primary responsibilities to the beacon chain:
<a href="#block-proposal">proposing blocks</a> and <a href="#attesting">creating attestations</a>.
Proposals happen infrequently, whereas attestations should be created once per
epoch.</p>
<h3 id="block-proposal">Block proposal<a class="headerlink" href="#block-proposal" title="Permanent link">&para;</a></h3>
<p>A validator is expected to propose a
<a href="../beacon-chain/#signedbeaconblock"><code>SignedBeaconBlock</code></a> at the beginning of
any <code>slot</code> during which <code>is_proposer(state, validator_index)</code> returns <code>True</code>.</p>
<p>To propose, the validator selects a <code>BeaconBlock</code>, <code>parent</code> using this process:</p>
<ol>
<li>Compute fork choice's view of the head at the start of <code>slot</code>, after running
   <code>on_tick</code> and applying any queued attestations from <code>slot - 1</code>. Set
   <code>head_root = get_head(store)</code>.</li>
<li>Compute the <em>proposer head</em>, which is the head upon which the proposer SHOULD
   build in order to incentivise timely block propagation by other validators.
   Set <code>parent_root = get_proposer_head(store, head_root, slot)</code>. A proposer may
   set <code>parent_root == head_root</code> if proposer re-orgs are not implemented or
   have been disabled.</li>
<li>Let <code>parent</code> be the block with <code>parent_root</code>.</li>
</ol>
<p>The validator creates, signs, and broadcasts a <code>block</code> that is a child of
<code>parent</code> and satisfies a valid
<a href="../beacon-chain/#beacon-chain-state-transition-function">beacon chain state transition</a>.
Note that the parent's slot must be strictly less than the slot of the block
about to be proposed, i.e. <code>parent.slot &lt; slot</code>.</p>
<p>There is one proposer per slot, so if there are N active validators any
individual validator will on average be assigned to propose once per N slots
(e.g. at 312,500 validators = 10 million ETH, that's once per ~6 weeks).</p>
<p><em>Note</em>: In this section, <code>state</code> is the state of the slot for the block proposal
<em>without</em> the block yet applied. That is, <code>state</code> is the <code>previous_state</code>
processed through any empty slots up to the assigned slot using
<code>process_slots(previous_state, slot)</code>.</p>
<h4 id="preparing-for-a-beaconblock">Preparing for a <code>BeaconBlock</code><a class="headerlink" href="#preparing-for-a-beaconblock" title="Permanent link">&para;</a></h4>
<p>To construct a <code>BeaconBlockBody</code>, a <code>block</code> (<code>BeaconBlock</code>) is defined with the
necessary context for a block proposal:</p>
<h5 id="slot">Slot<a class="headerlink" href="#slot" title="Permanent link">&para;</a></h5>
<p>Set <code>block.slot = slot</code> where <code>slot</code> is the current slot at which the validator
has been selected to propose. The <code>parent</code> selected must satisfy that
<code>parent.slot &lt; block.slot</code>.</p>
<p><em>Note</em>: There might be "skipped" slots between the <code>parent</code> and <code>block</code>. These
skipped slots are processed in the state transition function without per-block
processing.</p>
<h5 id="proposer-index">Proposer index<a class="headerlink" href="#proposer-index" title="Permanent link">&para;</a></h5>
<p>Set <code>block.proposer_index = validator_index</code> where <code>validator_index</code> is the
validator chosen to propose at this slot. The private key mapping to
<code>state.validators[validator_index].pubkey</code> is used to sign the block.</p>
<h5 id="parent-root">Parent root<a class="headerlink" href="#parent-root" title="Permanent link">&para;</a></h5>
<p>Set <code>block.parent_root = hash_tree_root(parent)</code>.</p>
<h4 id="constructing-the-beaconblockbody">Constructing the <code>BeaconBlockBody</code><a class="headerlink" href="#constructing-the-beaconblockbody" title="Permanent link">&para;</a></h4>
<h5 id="randao-reveal">Randao reveal<a class="headerlink" href="#randao-reveal" title="Permanent link">&para;</a></h5>
<p>Set <code>block.body.randao_reveal = epoch_signature</code> where <code>epoch_signature</code> is
obtained from:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-6-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_epoch_signature</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">block:</span> <span style="color: #F8F8F2">BeaconBlock,</span> <span style="color: #F8F8F2">privkey:</span> <span style="color: #F8F8F2">int)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">BLSSignature:</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_RANDAO,</span> <span style="color: #F8F8F2">compute_epoch_at_slot(block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot))</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(compute_epoch_at_slot(block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot),</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Sign(privkey,</span> <span style="color: #F8F8F2">signing_root)</span>
</code></pre></div></td></tr></table></div>
<h5 id="eth1-data">Eth1 Data<a class="headerlink" href="#eth1-data" title="Permanent link">&para;</a></h5>
<p>The <code>block.body.eth1_data</code> field is for block proposers to vote on recent Eth1
data. This recent data contains an Eth1 block hash as well as the associated
deposit root (as calculated by the <code>get_deposit_root()</code> method of the deposit
contract) and deposit count after execution of the corresponding Eth1 block. If
over half of the block proposers in the current Eth1 voting period vote for the
same <code>eth1_data</code> then <code>state.eth1_data</code> updates immediately allowing new
deposits to be processed. Each deposit in <code>block.body.deposits</code> must verify
against <code>state.eth1_data.eth1_deposit_root</code>.</p>
<h6 id="get_eth1_data"><code>get_eth1_data</code><a class="headerlink" href="#get_eth1_data" title="Permanent link">&para;</a></h6>
<p>Let <code>Eth1Block</code> be an abstract object representing Eth1 blocks with the
<code>timestamp</code> and deposit contract data available.</p>
<p>Let <code>get_eth1_data(block: Eth1Block) -&gt; Eth1Data</code> be the function that returns
the Eth1 data for a given Eth1 block.</p>
<p>An honest block proposer sets
<code>block.body.eth1_data = get_eth1_vote(state, eth1_chain)</code> where:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-7-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">voting_period_start_time</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">uint64:</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span style="color: #F8F8F2">eth1_voting_period_start_slot</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">Slot(</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">-</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">(EPOCHS_PER_ETH1_VOTING_PERIOD</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">compute_time_at_slot(state,</span> <span style="color: #F8F8F2">eth1_voting_period_start_slot)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-8-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_candidate_block</span><span style="color: #F8F8F2">(block:</span> <span style="color: #F8F8F2">Eth1Block,</span> <span style="color: #F8F8F2">period_start:</span> <span style="color: #F8F8F2">uint64)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>        <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">timestamp</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">SECONDS_PER_ETH1_BLOCK</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">ETH1_FOLLOW_DISTANCE</span> <span style="color: #FF4689">&lt;=</span> <span style="color: #F8F8F2">period_start</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>        <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">timestamp</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">SECONDS_PER_ETH1_BLOCK</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">ETH1_FOLLOW_DISTANCE</span> <span style="color: #FF4689">*</span> <span style="color: #AE81FF">2</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">period_start</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-11">11</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-12">12</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-13">13</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-14">14</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-15">15</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-16">16</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-17">17</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-18">18</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-19">19</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-20">20</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-21">21</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-22">22</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-23">23</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-24">24</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-25">25</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-26">26</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-27">27</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-28">28</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-29">29</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-30">30</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-31">31</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-9-32">32</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_eth1_vote</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">eth1_chain:</span> <span style="color: #F8F8F2">Sequence[Eth1Block])</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Eth1Data:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span style="color: #F8F8F2">period_start</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">voting_period_start_time(state)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>    <span style="color: #959077"># `eth1_chain` abstractly represents all blocks in the eth1 chain sorted by ascending block height</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>    <span style="color: #F8F8F2">votes_to_consider</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>        <span style="color: #F8F8F2">get_eth1_data(block)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>        <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">block</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">eth1_chain</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>        <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>            <span style="color: #F8F8F2">is_candidate_block(block,</span> <span style="color: #F8F8F2">period_start)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>            <span style="color: #959077"># Ensure cannot move back to earlier deposit contract states</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>            <span style="color: #FF4689">and</span> <span style="color: #F8F8F2">get_eth1_data(block)</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">deposit_count</span> <span style="color: #FF4689">&gt;=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">deposit_count</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>        <span style="color: #F8F8F2">)</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>    <span style="color: #F8F8F2">]</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>    <span style="color: #959077"># Valid votes already cast during this period</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>    <span style="color: #F8F8F2">valid_votes</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[vote</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">vote</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data_votes</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">vote</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">votes_to_consider]</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>    <span style="color: #959077"># Default vote on latest eth1 block data in the period range unless eth1 chain is not live</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>    <span style="color: #959077"># Non-substantive casting for linter</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a>    <span style="color: #F8F8F2">state_eth1_data:</span> <span style="color: #F8F8F2">Eth1Data</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">eth1_data</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>    <span style="color: #F8F8F2">default_vote</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a>        <span style="color: #F8F8F2">votes_to_consider[len(votes_to_consider)</span> <span style="color: #FF4689">-</span> <span style="color: #AE81FF">1</span><span style="color: #F8F8F2">]</span> <span style="color: #66D9EF">if</span> <span style="color: #F8F8F2">any(votes_to_consider)</span> <span style="color: #66D9EF">else</span> <span style="color: #F8F8F2">state_eth1_data</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">max(</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>        <span style="color: #F8F8F2">valid_votes,</span>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a>        <span style="color: #959077"># Tiebreak by smallest distance</span>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a>        <span style="color: #F8F8F2">key</span><span style="color: #FF4689">=</span><span style="color: #66D9EF">lambda</span> <span style="color: #F8F8F2">v:</span> <span style="color: #F8F8F2">(</span>
<a id="__codelineno-9-28" name="__codelineno-9-28"></a>            <span style="color: #F8F8F2">valid_votes</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">count(v),</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a>            <span style="color: #FF4689">-</span><span style="color: #F8F8F2">valid_votes</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">index(v),</span>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a>        <span style="color: #F8F8F2">),</span>
<a id="__codelineno-9-31" name="__codelineno-9-31"></a>        <span style="color: #F8F8F2">default</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">default_vote,</span>
<a id="__codelineno-9-32" name="__codelineno-9-32"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<h5 id="proposer-slashings">Proposer slashings<a class="headerlink" href="#proposer-slashings" title="Permanent link">&para;</a></h5>
<p>Up to <code>MAX_PROPOSER_SLASHINGS</code>,
<a href="../beacon-chain/#proposerslashing"><code>ProposerSlashing</code></a> objects can be included
in the <code>block</code>. The proposer slashings must satisfy the verification conditions
found in <a href="../beacon-chain/#proposer-slashings">proposer slashings processing</a>.
The validator receives a small "whistleblower" reward for each proposer slashing
found and included.</p>
<h5 id="attester-slashings">Attester slashings<a class="headerlink" href="#attester-slashings" title="Permanent link">&para;</a></h5>
<p>Up to <code>MAX_ATTESTER_SLASHINGS</code>,
<a href="../beacon-chain/#attesterslashing"><code>AttesterSlashing</code></a> objects can be included
in the <code>block</code>. The attester slashings must satisfy the verification conditions
found in <a href="../beacon-chain/#attester-slashings">attester slashings processing</a>.
The validator receives a small "whistleblower" reward for each attester slashing
found and included.</p>
<h5 id="attestations">Attestations<a class="headerlink" href="#attestations" title="Permanent link">&para;</a></h5>
<p>Up to <code>MAX_ATTESTATIONS</code>, aggregate attestations can be included in the <code>block</code>.
The attestations added must satisfy the verification conditions found in
<a href="../beacon-chain/#attestations">attestation processing</a>. To maximize profit,
the validator should attempt to gather aggregate attestations that include
singular attestations from the largest number of validators whose signatures
from the same epoch have not previously been added on chain.</p>
<h5 id="deposits">Deposits<a class="headerlink" href="#deposits" title="Permanent link">&para;</a></h5>
<p>If there are any unprocessed deposits for the existing <code>state.eth1_data</code> (i.e.
<code>state.eth1_data.deposit_count &gt; state.eth1_deposit_index</code>), then pending
deposits <em>must</em> be added to the block. The expected number of deposits is
exactly <code>min(MAX_DEPOSITS, eth1_data.deposit_count - state.eth1_deposit_index)</code>.
These <a href="../beacon-chain/#deposit"><code>deposits</code></a> are constructed from the <code>Deposit</code>
logs from the <a href="../deposit-contract/">deposit contract</a> and must be processed in
sequential order. The deposits included in the <code>block</code> must satisfy the
verification conditions found in
<a href="../beacon-chain/#deposits">deposits processing</a>.</p>
<p>The <code>proof</code> for each deposit must be constructed against the deposit root
contained in <code>state.eth1_data</code> rather than the deposit root at the time the
deposit was initially logged from the proof-of-work chain. This entails storing
a full deposit merkle tree locally and computing updated proofs against the
<code>eth1_data.deposit_root</code> as needed. See
<a href="https://github.com/ethereum/research/blob/master/spec_pythonizer/utils/merkle_minimal.py"><code>minimal_merkle.py</code></a>
for a sample implementation.</p>
<h5 id="voluntary-exits">Voluntary exits<a class="headerlink" href="#voluntary-exits" title="Permanent link">&para;</a></h5>
<p>Up to <code>MAX_VOLUNTARY_EXITS</code>, <a href="../beacon-chain/#voluntaryexit"><code>VoluntaryExit</code></a>
objects can be included in the <code>block</code>. The exits must satisfy the verification
conditions found in <a href="../beacon-chain/#voluntary-exits">exits processing</a>.</p>
<p><em>Note</em>: If a slashing for a validator is included in the same block as a
voluntary exit, the voluntary exit will fail and cause the block to be invalid
due to the slashing being processed first. Implementers must take heed of this
operation interaction when packing blocks.</p>
<h4 id="packaging-into-a-signedbeaconblock">Packaging into a <code>SignedBeaconBlock</code><a class="headerlink" href="#packaging-into-a-signedbeaconblock" title="Permanent link">&para;</a></h4>
<h5 id="state-root">State root<a class="headerlink" href="#state-root" title="Permanent link">&para;</a></h5>
<p>Set <code>block.state_root = hash_tree_root(state)</code> of the resulting <code>state</code> of the
<code>parent -&gt; block</code> state transition.</p>
<p><em>Note</em>: To calculate <code>state_root</code>, the validator should first run the state
transition function on an unsigned <code>block</code> containing a stub for the
<code>state_root</code>. It is useful to be able to run a state transition function
(working on a copy of the state) that does <em>not</em> validate signatures or state
root for this purpose:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-10-5">5</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_new_state_root</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">block:</span> <span style="color: #F8F8F2">BeaconBlock)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">Root:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span style="color: #F8F8F2">temp_state:</span> <span style="color: #F8F8F2">BeaconState</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">state</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">copy()</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span style="color: #F8F8F2">signed_block</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">SignedBeaconBlock(message</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">block)</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span style="color: #F8F8F2">state_transition(temp_state,</span> <span style="color: #F8F8F2">signed_block,</span> <span style="color: #F8F8F2">validate_result</span><span style="color: #FF4689">=</span><span style="color: #66D9EF">False</span><span style="color: #F8F8F2">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">hash_tree_root(temp_state)</span>
</code></pre></div></td></tr></table></div>
<h5 id="signature">Signature<a class="headerlink" href="#signature" title="Permanent link">&para;</a></h5>
<p><code>signed_block = SignedBeaconBlock(message=block, signature=block_signature)</code>,
where <code>block_signature</code> is obtained from:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-11-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_block_signature</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">block:</span> <span style="color: #F8F8F2">BeaconBlock,</span> <span style="color: #F8F8F2">privkey:</span> <span style="color: #F8F8F2">int)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">BLSSignature:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_BEACON_PROPOSER,</span> <span style="color: #F8F8F2">compute_epoch_at_slot(block</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot))</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(block,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Sign(privkey,</span> <span style="color: #F8F8F2">signing_root)</span>
</code></pre></div></td></tr></table></div>
<h3 id="attesting">Attesting<a class="headerlink" href="#attesting" title="Permanent link">&para;</a></h3>
<p>A validator is expected to create, sign, and broadcast an attestation during
each epoch. The <code>committee</code>, assigned <code>index</code>, and assigned <code>slot</code> for which the
validator performs this role during an epoch are defined by
<code>get_committee_assignment(state, epoch, validator_index)</code>.</p>
<p>A validator should create and broadcast the <code>attestation</code> to the associated
attestation subnet when either (a) the validator has received a valid block from
the expected block proposer for the assigned <code>slot</code> or (b)
<code>get_slot_component_duration_ms(ATTESTATION_DUE_BPS)</code> milliseconds has
transpired since the start of the slot -- whichever comes first.</p>
<p><em>Note</em>: Although attestations during <code>GENESIS_EPOCH</code> do not count toward FFG
finality, these initial attestations do give weight to the fork choice, are
rewarded, and should be made.</p>
<h4 id="attestation-data">Attestation data<a class="headerlink" href="#attestation-data" title="Permanent link">&para;</a></h4>
<p>First, the validator should construct <code>attestation_data</code>, an
<a href="../beacon-chain/#attestationdata"><code>AttestationData</code></a> object based upon the
state at the assigned slot.</p>
<ul>
<li>Let <code>head_block</code> be the result of running the fork choice during the assigned
  slot.</li>
<li>Let <code>head_state</code> be the state of <code>head_block</code> processed through any empty
  slots up to the assigned slot using <code>process_slots(state, slot)</code>.</li>
</ul>
<h5 id="general">General<a class="headerlink" href="#general" title="Permanent link">&para;</a></h5>
<ul>
<li>Set <code>attestation_data.slot = slot</code> where <code>slot</code> is the assigned slot.</li>
<li>Set <code>attestation_data.index = index</code> where <code>index</code> is the index associated
  with the validator's committee.</li>
</ul>
<h5 id="lmd-ghost-vote">LMD GHOST vote<a class="headerlink" href="#lmd-ghost-vote" title="Permanent link">&para;</a></h5>
<p>Set <code>attestation_data.beacon_block_root = hash_tree_root(head_block)</code>.</p>
<h5 id="ffg-vote">FFG vote<a class="headerlink" href="#ffg-vote" title="Permanent link">&para;</a></h5>
<ul>
<li>Set <code>attestation_data.source = head_state.current_justified_checkpoint</code>.</li>
<li>Set
  <code>attestation_data.target = Checkpoint(epoch=get_current_epoch(head_state), root=epoch_boundary_block_root)</code>
  where <code>epoch_boundary_block_root</code> is the root of block at the most recent
  epoch boundary.</li>
</ul>
<p><em>Note</em>: <code>epoch_boundary_block_root</code> can be looked up in the state using:</p>
<ul>
<li>Let <code>start_slot = compute_start_slot_at_epoch(get_current_epoch(head_state))</code>.</li>
<li>Let
  <code>epoch_boundary_block_root = hash_tree_root(head_block) if start_slot == head_state.slot else get_block_root(state, get_current_epoch(head_state))</code>.</li>
</ul>
<h4 id="construct-attestation">Construct attestation<a class="headerlink" href="#construct-attestation" title="Permanent link">&para;</a></h4>
<p>Next, the validator creates <code>attestation</code>, an
<a href="../beacon-chain/#attestation"><code>Attestation</code></a> object.</p>
<h5 id="data">Data<a class="headerlink" href="#data" title="Permanent link">&para;</a></h5>
<p>Set <code>attestation.data = attestation_data</code> where <code>attestation_data</code> is the
<code>AttestationData</code> object defined in the previous section,
<a href="#attestation-data">attestation data</a>.</p>
<h5 id="aggregation-bits">Aggregation bits<a class="headerlink" href="#aggregation-bits" title="Permanent link">&para;</a></h5>
<ul>
<li>Let <code>attestation.aggregation_bits</code> be a
  <code>Bitlist[MAX_VALIDATORS_PER_COMMITTEE]</code> of length <code>len(committee)</code>, where the
  bit of the index of the validator in the <code>committee</code> is set to <code>0b1</code>.</li>
</ul>
<p><em>Note</em>: Calling <code>get_attesting_indices(state, attestation)</code> should return a list
of length equal to 1, containing <code>validator_index</code>.</p>
<h5 id="aggregate-signature">Aggregate signature<a class="headerlink" href="#aggregate-signature" title="Permanent link">&para;</a></h5>
<p>Set <code>attestation.signature = attestation_signature</code> where
<code>attestation_signature</code> is obtained from:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-12-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_attestation_signature</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">attestation_data:</span> <span style="color: #F8F8F2">AttestationData,</span> <span style="color: #F8F8F2">privkey:</span> <span style="color: #F8F8F2">int</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">BLSSignature:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>    <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_BEACON_ATTESTER,</span> <span style="color: #F8F8F2">attestation_data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">target</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">epoch)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(attestation_data,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Sign(privkey,</span> <span style="color: #F8F8F2">signing_root)</span>
</code></pre></div></td></tr></table></div>
<h4 id="broadcast-attestation">Broadcast attestation<a class="headerlink" href="#broadcast-attestation" title="Permanent link">&para;</a></h4>
<p>Finally, the validator broadcasts <code>attestation</code> to the associated attestation
subnet, the <code>beacon_attestation_{subnet_id}</code> pubsub topic.</p>
<p>The <code>subnet_id</code> for the <code>attestation</code> is calculated with:</p>
<ul>
<li>Let
  <code>committees_per_slot = get_committee_count_per_slot(state, attestation.data.target.epoch)</code>.</li>
<li>Let
  <code>subnet_id = compute_subnet_for_attestation(committees_per_slot, attestation.data.slot, attestation.data.index)</code>.</li>
</ul>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-1"> 1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-2"> 2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-3"> 3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-4"> 4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-5"> 5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-6"> 6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-7"> 7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-8"> 8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-9"> 9</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-10">10</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-13-11">11</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">compute_subnet_for_attestation</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span style="color: #F8F8F2">committees_per_slot:</span> <span style="color: #F8F8F2">uint64,</span> <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot,</span> <span style="color: #F8F8F2">committee_index:</span> <span style="color: #F8F8F2">CommitteeIndex</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">SubnetID:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">&quot;&quot;&quot;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span style="color: #E6DB74">    Compute the correct subnet for an attestation for Phase 0.</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span style="color: #E6DB74">    Note, this mimics expected future behavior where attestations will be mapped to their shard subnet.</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span style="color: #E6DB74">    &quot;&quot;&quot;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>    <span style="color: #F8F8F2">slots_since_epoch_start</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">uint64(slot</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">SLOTS_PER_EPOCH)</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span style="color: #F8F8F2">committees_since_epoch_start</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">committees_per_slot</span> <span style="color: #FF4689">*</span> <span style="color: #F8F8F2">slots_since_epoch_start</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">SubnetID((committees_since_epoch_start</span> <span style="color: #FF4689">+</span> <span style="color: #F8F8F2">committee_index)</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">ATTESTATION_SUBNET_COUNT)</span>
</code></pre></div></td></tr></table></div>
<h3 id="attestation-aggregation">Attestation aggregation<a class="headerlink" href="#attestation-aggregation" title="Permanent link">&para;</a></h3>
<p>Some validators are selected to locally aggregate attestations with a similar
<code>attestation_data</code> to their constructed <code>attestation</code> for the assigned <code>slot</code>.</p>
<h4 id="aggregation-selection">Aggregation selection<a class="headerlink" href="#aggregation-selection" title="Permanent link">&para;</a></h4>
<p>A validator is selected to aggregate based upon the return value of
<code>is_aggregator()</code>.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-14-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-14-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-14-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-14-4">4</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_slot_signature</span><span style="color: #F8F8F2">(state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot,</span> <span style="color: #F8F8F2">privkey:</span> <span style="color: #F8F8F2">int)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">BLSSignature:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(state,</span> <span style="color: #F8F8F2">DOMAIN_SELECTION_PROOF,</span> <span style="color: #F8F8F2">compute_epoch_at_slot(slot))</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(slot,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Sign(privkey,</span> <span style="color: #F8F8F2">signing_root)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-15-6">6</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">is_aggregator</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">slot:</span> <span style="color: #F8F8F2">Slot,</span> <span style="color: #F8F8F2">index:</span> <span style="color: #F8F8F2">CommitteeIndex,</span> <span style="color: #F8F8F2">slot_signature:</span> <span style="color: #F8F8F2">BLSSignature</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">bool:</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>    <span style="color: #F8F8F2">committee</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_beacon_committee(state,</span> <span style="color: #F8F8F2">slot,</span> <span style="color: #F8F8F2">index)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span style="color: #F8F8F2">modulo</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">max(</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">,</span> <span style="color: #F8F8F2">len(committee)</span> <span style="color: #FF4689">//</span> <span style="color: #F8F8F2">TARGET_AGGREGATORS_PER_COMMITTEE)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bytes_to_uint64(hash(slot_signature)[</span><span style="color: #AE81FF">0</span><span style="color: #F8F8F2">:</span><span style="color: #AE81FF">8</span><span style="color: #F8F8F2">])</span> <span style="color: #FF4689">%</span> <span style="color: #F8F8F2">modulo</span> <span style="color: #FF4689">==</span> <span style="color: #AE81FF">0</span>
</code></pre></div></td></tr></table></div>
<h4 id="construct-aggregate">Construct aggregate<a class="headerlink" href="#construct-aggregate" title="Permanent link">&para;</a></h4>
<p>If the validator is selected to aggregate (<code>is_aggregator()</code>), they construct an
aggregate attestation via the following.</p>
<p>Collect <code>attestations</code> seen via gossip during the <code>slot</code> that have an equivalent
<code>attestation_data</code> to that constructed by the validator. If
<code>len(attestations) &gt; 0</code>, create an <code>aggregate_attestation: Attestation</code> with the
following fields.</p>
<h5 id="data_1">Data<a class="headerlink" href="#data_1" title="Permanent link">&para;</a></h5>
<p>Set <code>aggregate_attestation.data = attestation_data</code> where <code>attestation_data</code> is
the <code>AttestationData</code> object that is the same for each individual attestation
being aggregated.</p>
<h5 id="aggregation-bits_1">Aggregation bits<a class="headerlink" href="#aggregation-bits_1" title="Permanent link">&para;</a></h5>
<p>Let <code>aggregate_attestation.aggregation_bits</code> be a
<code>Bitlist[MAX_VALIDATORS_PER_COMMITTEE]</code> of length <code>len(committee)</code>, where each
bit set from each individual attestation is set to <code>0b1</code>.</p>
<h5 id="aggregate-signature_1">Aggregate signature<a class="headerlink" href="#aggregate-signature_1" title="Permanent link">&para;</a></h5>
<p>Set <code>aggregate_attestation.signature = aggregate_signature</code> where
<code>aggregate_signature</code> is obtained from:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-16-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-16-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-16-3">3</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_aggregate_signature</span><span style="color: #F8F8F2">(attestations:</span> <span style="color: #F8F8F2">Sequence[Attestation])</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">BLSSignature:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>    <span style="color: #F8F8F2">signatures</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">[attestation</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">signature</span> <span style="color: #66D9EF">for</span> <span style="color: #F8F8F2">attestation</span> <span style="color: #FF4689">in</span> <span style="color: #F8F8F2">attestations]</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Aggregate(signatures)</span>
</code></pre></div></td></tr></table></div>
<h4 id="broadcast-aggregate">Broadcast aggregate<a class="headerlink" href="#broadcast-aggregate" title="Permanent link">&para;</a></h4>
<p>If the validator is selected to aggregate (<code>is_aggregator</code>), then they broadcast
their best aggregate as a <code>SignedAggregateAndProof</code> to the global aggregate
channel (<code>beacon_aggregate_and_proof</code>)
<code>get_slot_component_duration_ms(AGGREGATE_DUE_BPS)</code> milliseconds into the slot.</p>
<p>Selection proofs are provided in <code>AggregateAndProof</code> to prove to the gossip
channel that the validator has been selected as an aggregator.</p>
<p><code>AggregateAndProof</code> messages are signed by the aggregator and broadcast inside
of <code>SignedAggregateAndProof</code> objects to prevent a class of DoS attacks and
message forgeries.</p>
<p>First,
<code>aggregate_and_proof = get_aggregate_and_proof(state, validator_index, aggregate_attestation, privkey)</code>
is constructed.</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-17-8">8</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_aggregate_and_proof</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">aggregator_index:</span> <span style="color: #F8F8F2">ValidatorIndex,</span> <span style="color: #F8F8F2">aggregate:</span> <span style="color: #F8F8F2">Attestation,</span> <span style="color: #F8F8F2">privkey:</span> <span style="color: #F8F8F2">int</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">AggregateAndProof:</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">AggregateAndProof(</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>        <span style="color: #F8F8F2">aggregator_index</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">aggregator_index,</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>        <span style="color: #F8F8F2">aggregate</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">aggregate,</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>        <span style="color: #F8F8F2">selection_proof</span><span style="color: #FF4689">=</span><span style="color: #F8F8F2">get_slot_signature(state,</span> <span style="color: #F8F8F2">aggregate</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot,</span> <span style="color: #F8F8F2">privkey),</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span style="color: #F8F8F2">)</span>
</code></pre></div></td></tr></table></div>
<p>Then
<code>signed_aggregate_and_proof = SignedAggregateAndProof(message=aggregate_and_proof, signature=signature)</code>
is constructed and broadcast. Where <code>signature</code> is obtained from:</p>
<div class="highlight" style="background: #272822"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-1">1</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-2">2</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-3">3</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-4">4</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-5">5</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-6">6</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-7">7</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-8">8</a></span>
<span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"><a href="#__codelineno-18-9">9</a></span></pre></div></td><td class="code"><div><pre style="line-height: 125%;"><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_aggregate_and_proof_signature</span><span style="color: #F8F8F2">(</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>    <span style="color: #F8F8F2">state:</span> <span style="color: #F8F8F2">BeaconState,</span> <span style="color: #F8F8F2">aggregate_and_proof:</span> <span style="color: #F8F8F2">AggregateAndProof,</span> <span style="color: #F8F8F2">privkey:</span> <span style="color: #F8F8F2">int</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span style="color: #F8F8F2">)</span> <span style="color: #FF4689">-&gt;</span> <span style="color: #F8F8F2">BLSSignature:</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>    <span style="color: #F8F8F2">aggregate</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">aggregate_and_proof</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">aggregate</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>    <span style="color: #F8F8F2">domain</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">get_domain(</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>        <span style="color: #F8F8F2">state,</span> <span style="color: #F8F8F2">DOMAIN_AGGREGATE_AND_PROOF,</span> <span style="color: #F8F8F2">compute_epoch_at_slot(aggregate</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">data</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">slot)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>    <span style="color: #F8F8F2">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>    <span style="color: #F8F8F2">signing_root</span> <span style="color: #FF4689">=</span> <span style="color: #F8F8F2">compute_signing_root(aggregate_and_proof,</span> <span style="color: #F8F8F2">domain)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>    <span style="color: #66D9EF">return</span> <span style="color: #F8F8F2">bls</span><span style="color: #FF4689">.</span><span style="color: #F8F8F2">Sign(privkey,</span> <span style="color: #F8F8F2">signing_root)</span>
</code></pre></div></td></tr></table></div>
<h2 id="how-to-avoid-slashing">How to avoid slashing<a class="headerlink" href="#how-to-avoid-slashing" title="Permanent link">&para;</a></h2>
<p>"Slashing" is the burning of some amount of validator funds and immediate
ejection from the active validator set. In Phase 0, there are two ways in which
funds can be slashed: <a href="#proposer-slashing">proposer slashing</a> and
<a href="#attester-slashing">attester slashing</a>. Although being slashed has serious
repercussions, it is simple enough to avoid being slashed all together by
remaining <em>consistent</em> with respect to the messages a validator has previously
signed.</p>
<p><em>Note</em>: Signed data must be within a sequential <code>Fork</code> context to conflict.
Messages cannot be slashed across diverging forks. If the previous fork version
is 1 and the chain splits into fork 2 and 102, messages from 1 can be slashable
against messages in forks 1, 2, and 102. Messages in 2 cannot be slashable
against messages in 102, and vice versa.</p>
<h3 id="proposer-slashing">Proposer slashing<a class="headerlink" href="#proposer-slashing" title="Permanent link">&para;</a></h3>
<p>To avoid "proposer slashings", a validator must not sign two conflicting
<a href="../beacon-chain/#beaconblock"><code>BeaconBlock</code></a> where conflicting is defined as
two distinct blocks within the same slot.</p>
<p><em>In Phase 0, as long as the validator does not sign two different beacon blocks
for the same slot, the validator is safe against proposer slashings.</em></p>
<p>Specifically, when signing a <code>BeaconBlock</code>, a validator should perform the
following steps in the following order:</p>
<ol>
<li>Save a record to hard disk that a beacon block has been signed for the
   <code>slot=block.slot</code>.</li>
<li>Generate and broadcast the block.</li>
</ol>
<p>If the software crashes at some point within this routine, then when the
validator comes back online, the hard disk has the record of the <em>potentially</em>
signed/broadcast block and can effectively avoid slashing.</p>
<h3 id="attester-slashing">Attester slashing<a class="headerlink" href="#attester-slashing" title="Permanent link">&para;</a></h3>
<p>To avoid "attester slashings", a validator must not sign two conflicting
<a href="../beacon-chain/#attestationdata"><code>AttestationData</code></a> objects, i.e. two
attestations that satisfy
<a href="../beacon-chain/#is_slashable_attestation_data"><code>is_slashable_attestation_data</code></a>.</p>
<p>Specifically, when signing an <code>Attestation</code>, a validator should perform the
following steps in the following order:</p>
<ol>
<li>Save a record to hard disk that an attestation has been signed for source
   (i.e. <code>attestation_data.source.epoch</code>) and target (i.e.
   <code>attestation_data.target.epoch</code>).</li>
<li>Generate and broadcast attestation.</li>
</ol>
<p>If the software crashes at some point within this routine, then when the
validator comes back online, the hard disk has the record of the <em>potentially</em>
signed/broadcast attestation and can effectively avoid slashing.</p>
<h2 id="protection-best-practices">Protection best practices<a class="headerlink" href="#protection-best-practices" title="Permanent link">&para;</a></h2>
<p>A validator client should be considered standalone and should consider the
beacon node as untrusted. This means that the validator client should protect:</p>
<ol>
<li>Private keys -- private keys should be protected from being exported
   accidentally or by an attacker.</li>
<li>Slashing -- before a validator client signs a message it should validate the
   data, check it against a local slashing database (do not sign a slashable
   attestation or block) and update its internal slashing database with the
   newly signed object.</li>
<li>Recovered validator -- Recovering a validator from a private key will result
   in an empty local slashing db. Best practice is to import (from a trusted
   source) that validator's attestation history. See
   <a href="https://github.com/ethereum/EIPs/pull/3076/files">EIP 3076</a> for a standard
   slashing interchange format.</li>
<li>Far future signing requests -- A validator client can be requested to sign a
   far into the future attestation, resulting in a valid non-slashable request.
   If the validator client signs this message, it will result in it blocking
   itself from attesting any other attestation until the beacon-chain reaches
   that far into the future epoch. This will result in an inactivity penalty and
   potential ejection due to low balance. A validator client should prevent
   itself from signing such requests by: a) keeping a local time clock if
   possible and following best practices to stop time server attacks and b)
   refusing to sign, by default, any message that has a large (&gt;6h) gap from the
   current slashing protection database indicated a time "jump" or a long
   offline event. The administrator can manually override this protection to
   restart the validator after a genuine long offline event.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ethereum/consensus-specs" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "search"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>